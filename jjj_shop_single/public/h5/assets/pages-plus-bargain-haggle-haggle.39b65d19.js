import{_ as a,o as s,c as t,w as e,b as i,n as l,d as r,t as o,u,e as c,g as n,j as d,z as p,B as _,N as g,q as f,f as h,F as k,r as m,i as b,k as y,h as C}from"./index-6e5c77a7.js";import{P as w}from"./uni-popup.f3f35788.js";import{C as R}from"./countdown.ae2f98a7.js";import{s as S}from"./mp-share.5df2fe0f.js";import{A as P}from"./app-share.6adf735f.js";/* empty css                                                                  */import"./share.0e953495.js";const v=a({components:{Popup:w,Rule:a({data:()=>({openRule:!1}),props:["isRule","setting"],watch:{isRule:function(a,s){a!=s&&(this.openRule=a)}},methods:{closeRule(){this.openRule=!1,this.$emit("close")}}},[["render",function(a,p,_,g,f,h){const k=n,m=d;return f.openRule?(s(),t(k,{key:0,class:"rule-detail-wrap"},{default:e((()=>[i(k,{class:l(["rule-bg",f.openRule?"active":""]),onClick:h.closeRule},null,8,["onClick","class"]),i(k,{class:"rule-content",onClick:p[0]||(p[0]=u((()=>{}),["stop"]))},{default:e((()=>[i(k,{class:"title pr"},{default:e((()=>[i(m,{class:""},{default:e((()=>[r("活動規則")])),_:1}),i(m,{class:"iconfont icon-guanbi",onClick:h.closeRule},null,8,["onClick"])])),_:1}),i(k,{class:"content"},{default:e((()=>[r(o(_.setting.bargain_rules),1)])),_:1})])),_:1})])),_:1})):c("",!0)}],["__scopeId","data-v-2ba677f1"]]),countdown:R,share:S,AppShare:P},data:()=>({loadding:!0,bargain_task_id:0,isRule:!1,countdownConfig:{startstamp:0,endstamp:0,type:"text",title:"剩餘："},task:{},product:{},active:{},setting:{},help_list:[],isMpShare:!1,is_creater:!1,is_cut:!1,submitting:!1,isPopup:!1,my_cut_money:0,isAppShare:!1,appParams:{title:"",summary:"",path:""},url:""}),onLoad(a){this.bargain_task_id=a.bargain_task_id,this.url=window.location.href},mounted(){},onShow(){this.submitting=!1,this.getData()},computed:{is_bargain:function(){return 0==this.is_cut},is_buy:function(){return 0===this.active.conditions&&1!=this.task.is_buy||1===this.active.conditions&&1==this.task.is_floor&&1!=this.task.is_buy}},onShareAppMessage(){return{title:"發現了一個好物，快來幫我砍一刀吧",path:"/pages/plus/bargain/haggle/haggle?"+this.getShareUrlParams({bargain_task_id:this.bargain_task_id})}},methods:{getData(){let a=this;a.loading=!0,p({title:"載入中"}),a._get("plus.bargain.task/detail",{bargain_task_id:a.bargain_task_id,url:a.url},(function(s){if(a.countdownConfig.startstamp=s.data.active.start_time,a.countdownConfig.endstamp=s.data.task.end_time,a.is_creater=s.data.is_creater,a.is_cut=s.data.is_cut,a.task=s.data.task,a.active=s.data.active,a.product=s.data.product,a.setting=s.data.setting,a.help_list=s.data.help_list,""!=a.url){let t={bargain_task_id:a.bargain_task_id};a.configWx(s.data.share.signPackage,s.data.share.shareParams,t)}a.loadding=!1,_()}))},bargainFunc(){let a=this;a.submitting=!0,a._post("plus.bargain.task/cut",{bargain_task_id:a.bargain_task_id},(function(s){a.my_cut_money=s.data.cut_money,a.isPopup=!0}))},hidePopupFunc(){this.isPopup=!1,this.getData(),this.submitting=!1},buyNow(){this.createdOrder()},openRule(){this.isRule=!0},closeRule(){this.isRule=!1},gotoHome(){g({url:"/pages/index/index"})},createdOrder(){let a=this,s=a.product.bargain_product_id,t=a.task.product_sku_id,e=a.task.bargain_product_sku_id;a.gotoPage("/pages/order/confirm-order?bargain_product_id="+s+"&product_sku_id="+t+"&bargain_product_sku_id="+e+"&order_type=bargain&bargain_task_id="+a.bargain_task_id)},shareFunc(){this.isMpShare=!0},closeShare(){this.isMpShare=!1},closeAppShare(a){this.isAppShare=!1},involvedFunc(){let a="pages/plus/bargain/detail/detail?bargain_product_id="+this.product.bargain_product_id;this.gotoPage(a)}}},[["render",function(a,u,p,_,g,w){const R=d,S=n,P=b,v=y("Countdown"),x=C,F=y("Rule"),A=y("share"),j=y("AppShare"),M=y("Popup");return g.loadding?c("",!0):(s(),t(S,{key:0,class:"haggle"},{default:e((()=>[i(S,{class:"goto-home d-c-c",onClick:w.gotoHome},{default:e((()=>[i(R,{class:"iconfont icon-Homehomepagemenu"})])),_:1},8,["onClick"]),i(S,{class:"haggle-content"},{default:e((()=>[i(S,{class:"rule red",onClick:w.openRule},{default:e((()=>[r("活動規則")])),_:1},8,["onClick"]),i(S,{class:"user d-c-c d-c"},{default:e((()=>[i(P,{src:g.task.user.avatarUrl,mode:"widthFix"},null,8,["src"]),i(R,{class:"gray6"},{default:e((()=>[r(o(g.task.user.nickName),1)])),_:1})])),_:1}),i(S,{class:"tip p-20-0 d-c-c f30"},{default:e((()=>[r("“拿好物好朋友幫，快去邀請吧”")])),_:1}),i(S,{class:"product d-s-c p20"},{default:e((()=>[i(S,{class:"pic"},{default:e((()=>[i(P,{src:g.product.product.image[0].file_path,mode:""},null,8,["src"])])),_:1}),i(S,{class:"info flex-1 ml30"},{default:e((()=>[i(S,{class:"text-ellipsis-2 f28"},{default:e((()=>[r(o(g.task.product_name),1)])),_:1}),i(S,null,{default:e((()=>[i(R,{class:"gray9"},{default:e((()=>[r("規格：")])),_:1}),i(R,null,{default:e((()=>[r(o(g.task.product_attr?g.task.product_attr:"無"),1)])),_:1})])),_:1}),i(S,{class:""},{default:e((()=>[i(R,{class:"gray9"},{default:e((()=>[r("砍到底價：")])),_:1}),i(R,{class:"red"},{default:e((()=>[r("￥"+o(g.task.bargain_price),1)])),_:1}),i(R,{class:"ml10 text-l-t gray9"},{default:e((()=>[r("￥"+o(g.task.product_price),1)])),_:1})])),_:1}),i(S,{class:""},{default:e((()=>[i(R,{class:"gray9"},{default:e((()=>[r("剩餘：")])),_:1}),i(R,null,{default:e((()=>[r(o(g.product.stock),1)])),_:1})])),_:1})])),_:1})])),_:1}),w.is_bargain?(s(),t(S,{key:0,class:"title-2 d-c-c p-30-0 f26"},{default:e((()=>[i(R,{class:"pr"},{default:e((()=>[r(o(g.is_creater?"先砍一刀試試運氣":"幫好友砍一刀"),1)])),_:1})])),_:1})):c("",!0),i(S,{class:"progress pr"},{default:e((()=>[i(S,{class:"progress-box"},{default:e((()=>[i(S,{class:"progress-box-active",style:f("width:"+g.task.bargain_rate+"%;")},null,8,["style"])])),_:1}),i(S,{class:"progressState",style:f("left:"+g.task.bargain_rate+"%;")},{default:e((()=>[r("已砍￥"+o(g.task.cut_money),1)])),_:1},8,["style"])])),_:1}),i(S,{class:"d-b-c gray9"},{default:e((()=>[i(R,null,{default:e((()=>[r("￥"+o(g.task.product_price),1)])),_:1}),i(R,{class:"f30 red fb"},{default:e((()=>[r("￥"+o(g.task.bargain_price),1)])),_:1})])),_:1}),0==g.task.status?(s(),t(S,{key:1,class:"ad-datetime p-30-0 d-c-c"},{default:e((()=>[i(v,{config:g.countdownConfig},null,8,["config"])])),_:1})):c("",!0),0==g.task.status||1==g.task.status?(s(),t(S,{key:2,class:"btns mt30"},{default:e((()=>[w.is_bargain?(s(),t(x,{key:0,type:"primary",disabled:g.submitting,onClick:w.bargainFunc},{default:e((()=>[r(o(g.is_creater?"我要砍價":"幫好友砍一刀"),1)])),_:1},8,["disabled","onClick"])):c("",!0),w.is_bargain||1==g.task.is_floor||1==g.task.is_buy?c("",!0):(s(),t(x,{key:1,type:"primary","open-type":"share",onClick:w.shareFunc},{default:e((()=>[r("邀請好友幫忙砍價")])),_:1},8,["onClick"])),!0===g.is_creater?(s(),h(k,{key:2},[w.is_buy&&0==g.active.conditions?(s(),t(x,{key:0,type:"primary",class:"mt20",onClick:w.buyNow},{default:e((()=>[0==g.task.is_floor?(s(),h(k,{key:0},[r("當前價購買")],64)):c("",!0),1==g.task.is_floor?(s(),h(k,{key:1},[r("砍價成功 立即購買")],64)):c("",!0)])),_:1},8,["onClick"])):c("",!0),w.is_buy&&1==g.active.conditions?(s(),t(x,{key:1,type:"primary",class:"mt20",onClick:w.buyNow},{default:e((()=>[r("砍價成功 立即購買")])),_:1},8,["onClick"])):c("",!0),1==g.task.is_buy?(s(),t(S,{key:2,class:"mt20 f34 red tc"},{default:e((()=>[r("砍價成功，已購買")])),_:1})):c("",!0)],64)):c("",!0),0==g.is_creater?(s(),t(x,{key:3,type:"primary",class:"buy-btn mt20",onClick:w.involvedFunc},{default:e((()=>[r("我要參與")])),_:1},8,["onClick"])):c("",!0)])),_:1})):c("",!0),i(S,{class:"help-list mt30"},{default:e((()=>[i(S,{class:"p-30-0 border-b fb f30"},{default:e((()=>[r("砍價記錄")])),_:1}),(s(!0),h(k,null,m(g.help_list,((a,u)=>(s(),t(S,{class:"d-b-c p-20-0 border-b-e",key:u},{default:e((()=>[i(S,{class:"user d-s-c"},{default:e((()=>[i(P,{src:a.user.avatarUrl,mode:"aspectFill"},null,8,["src"]),i(R,{class:"ml20"},{default:e((()=>[r(o(a.user.nickName),1)])),_:2},1024)])),_:2},1024),i(S,{class:l(["red",{fb:0==a.is_creater}])},{default:e((()=>[r("-"+o(a.cut_money),1)])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:1})])),_:1}),i(F,{isRule:g.isRule,setting:g.setting,onClose:w.closeRule},null,8,["isRule","setting","onClose"]),i(A,{isMpShare:g.isMpShare,onClose:w.closeShare},null,8,["isMpShare","onClose"]),i(j,{isAppShare:g.isAppShare,appParams:g.appParams,onClose:w.closeAppShare},null,8,["isAppShare","appParams","onClose"]),i(M,{show:g.isPopup,width:600,height:300,padding:0,onHidePopup:w.hidePopupFunc},{default:e((()=>[i(S,{class:"d-c-c d-c ww100 p-30-0"},{default:e((()=>[i(R,null,{default:e((()=>[r("本次砍掉")])),_:1}),i(S,{class:"pt10"},{default:e((()=>[r(" ￥ "),i(R,{class:"fb f34 red"},{default:e((()=>[r(o(g.my_cut_money),1)])),_:1})])),_:1}),i(S,{class:"pt30"},{default:e((()=>[i(x,{type:"primary",class:"btn-gray",style:{"border-radius":"200rpx"},onClick:w.hidePopupFunc},{default:e((()=>[r("關閉")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["show","onHidePopup"])])),_:1}))}],["__scopeId","data-v-0c6ba15d"]]);export{v as default};
