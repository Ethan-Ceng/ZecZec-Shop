import{_ as e,ai as s,a as o,J as t,z as a,B as l,a8 as n,A as d,a9 as i,aj as c,o as u,c as p,w as r,n as m,g as f,b as h,d as _,t as g,e as b,u as w,i as k,j as P,I as y,a2 as x,P as C,ak as I,h as M,k as U}from"./index-6e5c77a7.js";import{P as v}from"./uni-popup.f3f35788.js";import{U as V}from"./upload.182a2719.js";/* empty css                                                                  */const N=e({components:{Popup:v,Upload:V},data:()=>({userInfo:{},isPopup:!1,imageList:[],newName:"",type:"",isUpload:!1,mobileModel:{mobile:"",code:""},passwordModel:{mobile:"",code:"",password:"",repassword:""},is_send:!1,send_btn_txt:"獲取驗證碼",second:60,isPhone:!1,isPassword:!1,sms_open:!1}),onShow(){this.getData(),this.getCodeType()},methods:{clearStorage(){s()},getCodeType(){let e=this;e._post("index/loginSetting",{},(s=>{e.sms_open=s.data.setting.sms_open}))},maskPhone:e=>e&&11===e.length?e.replace(/(\d{3})\d{4}(\d{4})/,"$1***$2"):e,isPasswordOpen(){this.isPassword=!0,this.passwordModel={mobile:this.userInfo.mobile,code:"",password:"",repassword:""}},isPhoneOpen(){this.isPhone=!0,this.mobileModel={mobile:"",code:""}},changePassword(){let e=this,s=e.passwordModel;s.mobile?!e.sms_open||s.code?s.password?s.password.length<6?o({title:"請輸入6位以上的密碼",icon:"none"}):s.password==s.repassword?e._post("user.Useropen/changePassword",s,(s=>{t({title:"提示",content:"修改成功",success(){e.isPassword=!1,e.getData()}})})):o({title:"兩次密碼輸入不一致",icon:"none"}):o({title:"請輸入密碼",icon:"none"}):o({title:"請輸入驗證碼",icon:"none"}):o({title:"請輸入手機號",icon:"none"})},changePhone(){let e=this,s=e.mobileModel;!e.sms_open||s.code?e._post("user.Useropen/changeMobile",s,(s=>{t({title:"提示",content:"修改成功",success(){e.isPhone=!1,e.getData()}})})):o({title:"請輸入驗證碼",icon:"none"})},changeName(e){let s=this;"mobile"==e&&(s.oldmobile=s.userInfo.mobile),s.type=e,s.newName=s.userInfo[e],s.isPopup=!0},onChooseAvatar(e){console.log(e),this.uploadFile([e.detail.avatarUrl])},getData(){let e=this;a({title:"載入中"}),e._get("user.index/setting",{},(function(s){e.userInfo=s.data.userInfo,l()}))},gotoBind(){n({url:"/pages/user/modify-phone/modify-phone"})},changeAvatarUrl(){this.isUpload=!0},changeinput(e){this.newName=e.target.value},changeGender(e){this.userInfo.gender=e.detail.value},subName(e){let s=this;s.loading||("gender"!=s.type&&(s.newName=e.detail.value.newName),s.userInfo[s.type]=this.newName,s.update())},uploadFile:function(e){let s=this;s.imageList=[];let o=0,t=e.length,n={token:d("token"),app_id:s.getAppId()};a({title:"圖片上傳中"}),e.forEach((function(e,a){i({url:s.websiteUrl+"/index.php?s=/api/file.upload/image",filePath:e,name:"iFile",formData:n,success:function(e){let o="object"==typeof e.data?e.data:JSON.parse(e.data);1===o.code?s.imageList.push(o.data):s.showError(o.msg)},complete:function(){o++,t===o&&(l(),s.getImgsFunc(s.imageList))}})}))},getImgsFunc(e){if(e&&void 0!==e){let s=this;s.userInfo.avatarUrl=e[0].file_path,s.update(),s.isUpload=!1}},hidePopupFunc(){this.isPopup=!1},logout(){let e=this;e._post("/user.User/logOut",{},(s=>{c("token"),c("user_id"),e.gotoPage("/pages/index/index")}))},update(){let e=this;if(e.loading)return;a({title:"載入中"});let s=e.userInfo;e.loading=!0,e._post("user.user/updateInfo",s,(function(s){e.showSuccess("修改成功",(function(){e.loading=!1,e.isPopup=!1,l(),e.getData()}),(function(s){l(),e.loading=!1,e.isPopup=!1}))}))},sendCode(e){let s=this,t=this[e];if(!/^1(3|4|5|6|7|8|9)\d{9}$/.test(t.mobile))return void o({title:"手機有誤,請重填！",duration:2e3,icon:"none"});let a="login";"mobileModel"==e&&(a="register"),s._post("user.userweb/sendCode",{mobile:t.mobile,type:a},(e=>{1==e.code&&(o({title:"傳送成功"}),s.is_send=!0,s.changeMsg())}))},changeMsg(){this.second>0?(this.send_btn_txt=this.second+"秒",this.second--,setTimeout(this.changeMsg,1e3)):(this.send_btn_txt="獲取驗證碼",this.second=60,this.is_send=!1)},deleteAccount(){let e=this;t({title:"提示",content:"是否確認刪除賬號？刪除後您將無法用此賬號登入，此賬戶下的資料也將刪除",success:function(s){s.confirm&&e._post("user.user/deleteAccount",{},(s=>{e.showSuccess("刪除成功",(()=>{c("token"),c("user_id"),e.gotoPage("/pages/index/index")}))}),!1,(()=>{l()}))}})}}},[["render",function(e,s,o,t,a,l){const n=k,d=f,i=P,c=y,v=x,V=C,N=I,A=M,j=U("Upload");return u(),p(d,{class:m(["address-form o-h",e.theme()||""]),"data-theme":e.theme()},{default:r((()=>[h(d,{class:"avatar-box"},{default:r((()=>[h(d,{class:"info-image",onClick:l.changeAvatarUrl},{default:r((()=>[h(n,{class:"ava-image",src:a.userInfo.avatarUrl||"/static/login-default.png",mode:""},null,8,["src"]),h(d,{class:"icon iconfont icon-shangchuantupian_f"})])),_:1},8,["onClick"])])),_:1}),h(d,{class:"user-info bg-white f26"},{default:r((()=>[h(d,{class:"d-b-c"},{default:r((()=>[h(i,{class:"key-name"},{default:r((()=>[_("會員ID")])),_:1}),h(d,{class:"userinfo-text border-b"},{default:r((()=>[_(g(a.userInfo.user_id),1)])),_:1})])),_:1}),h(d,{class:"d-b-c"},{default:r((()=>[h(i,{class:"key-name"},{default:r((()=>[_("暱稱")])),_:1}),h(c,{class:"userinfo-input border-b",placeholder:"請輸入暱稱","placeholder-class":"gray9",type:"text",modelValue:a.userInfo.nickName,"onUpdate:modelValue":s[0]||(s[0]=e=>a.userInfo.nickName=e)},null,8,["modelValue"])])),_:1}),a.userInfo.mobile?(u(),p(d,{key:0,class:"d-b-c",onClick:l.isPhoneOpen},{default:r((()=>[h(i,{class:"key-name"},{default:r((()=>[_("手機")])),_:1}),h(d,{class:"d-s-c border-b flex-1"},{default:r((()=>[h(i,{class:"userinfo-text"},{default:r((()=>[_(g(l.maskPhone(a.userInfo.mobile)),1)])),_:1}),h(i,{class:"theme-notice dominant"},{default:r((()=>[_("修改")])),_:1})])),_:1})])),_:1},8,["onClick"])):b("",!0),h(d,{class:"d-b-c"},{default:r((()=>[h(d,{class:"key-name"},{default:r((()=>[_("性別")])),_:1}),h(N,{class:"userinfo-text border-b d-s-c",onChange:l.changeGender},{default:r((()=>[h(V,{class:"d-s-c make-item mr20"},{default:r((()=>[h(d,null,{default:r((()=>[h(v,{style:{transform:"scale(0.7)"},color:e.getThemeColor(),checked:1==a.userInfo.gender,value:1},null,8,["color","checked"])])),_:1}),h(d,{class:"f26 color-57"},{default:r((()=>[_("男")])),_:1})])),_:1}),h(V,{class:"d-s-c make-item"},{default:r((()=>[h(d,null,{default:r((()=>[h(v,{style:{transform:"scale(0.7)"},color:e.getThemeColor(),checked:0==a.userInfo.gender,value:0},null,8,["color","checked"])])),_:1}),h(d,{class:"f26 color-57"},{default:r((()=>[_("女")])),_:1})])),_:1})])),_:1},8,["onChange"])])),_:1}),a.userInfo.password?(u(),p(d,{key:1,class:"d-b-c",onClick:l.isPasswordOpen},{default:r((()=>[h(i,{class:"key-name"},{default:r((()=>[_("密碼")])),_:1}),h(d,{class:"userinfo-text d-b-c"},{default:r((()=>[h(i,{class:"gray9"},{default:r((()=>[_("已設定")])),_:1}),h(i,{class:"theme-notice dominant"},{default:r((()=>[_("修改")])),_:1})])),_:1})])),_:1},8,["onClick"])):b("",!0)])),_:1}),a.isPhone?(u(),p(d,{key:0,class:"pop-box"},{default:r((()=>[h(d,{class:"pop-bg",onClick:s[1]||(s[1]=w((e=>a.isPhone=!1),["stop"]))}),h(d,{class:"pop-content"},{default:r((()=>[h(d,{class:"icon iconfont icon-guanbi1 close-btn",onClick:s[2]||(s[2]=w((e=>a.isPhone=!1),["stop"]))}),h(d,{class:"pop-title"},{default:r((()=>[_("溫馨提示")])),_:1}),h(d,{class:"pop-dsc"},{default:r((()=>[_("獲取手機號作為使用者入會的唯一身份標識,請確定新手機號沒有繫結本平臺")])),_:1}),h(d,{class:"pop-formitem"},{default:r((()=>[h(c,{class:"flex-1 pop-formitem-input",type:"text",modelValue:a.mobileModel.mobile,"onUpdate:modelValue":s[3]||(s[3]=e=>a.mobileModel.mobile=e),placeholder:"請填寫手機號"},null,8,["modelValue"])])),_:1}),a.sms_open?(u(),p(d,{key:0,class:"pop-formitem"},{default:r((()=>[h(c,{class:"flex-1 pop-formitem-input",type:"number",modelValue:a.mobileModel.code,"onUpdate:modelValue":s[4]||(s[4]=e=>a.mobileModel.code=e),placeholder:"請填寫驗證碼"},null,8,["modelValue"]),h(A,{class:"get-code-btn",onClick:s[5]||(s[5]=w((e=>l.sendCode("mobileModel")),["stop"])),disabled:a.is_send},{default:r((()=>[_(g(a.send_btn_txt),1)])),_:1},8,["disabled"])])),_:1})):b("",!0),h(d,{class:"pop-sub-btn theme-btn",onClick:w(l.changePhone,["stop"])},{default:r((()=>[_("確定")])),_:1},8,["onClick"])])),_:1})])),_:1})):b("",!0),a.isPassword?(u(),p(d,{key:1,class:"pop-box"},{default:r((()=>[h(d,{class:"pop-bg",onClick:s[6]||(s[6]=w((e=>a.isPassword=!1),["stop"]))}),h(d,{class:"pop-content"},{default:r((()=>[h(d,{class:"icon iconfont icon-guanbi1 close-btn",onClick:s[7]||(s[7]=w((e=>a.isPassword=!1),["stop"]))}),h(d,{class:"pop-title"},{default:r((()=>[_("密碼修改")])),_:1}),h(d,{class:"pop-formitem"},{default:r((()=>[h(d,{class:"flex-1 pop-formitem-input"},{default:r((()=>[_(g(l.maskPhone(a.passwordModel.mobile)),1)])),_:1})])),_:1}),a.sms_open?(u(),p(d,{key:0,class:"pop-formitem"},{default:r((()=>[h(c,{class:"flex-1 pop-formitem-input",type:"number",modelValue:a.passwordModel.code,"onUpdate:modelValue":s[8]||(s[8]=e=>a.passwordModel.code=e),placeholder:"請填寫驗證碼"},null,8,["modelValue"]),h(A,{class:"get-code-btn",onClick:s[9]||(s[9]=w((e=>l.sendCode("passwordModel")),["stop"])),disabled:a.is_send},{default:r((()=>[_(g(a.send_btn_txt),1)])),_:1},8,["disabled"])])),_:1})):b("",!0),h(d,{class:"pop-formitem"},{default:r((()=>[h(c,{class:"flex-1 pop-formitem-input",type:"text",password:"",modelValue:a.passwordModel.password,"onUpdate:modelValue":s[10]||(s[10]=e=>a.passwordModel.password=e),placeholder:"請輸入密碼"},null,8,["modelValue"])])),_:1}),h(d,{class:"pop-formitem"},{default:r((()=>[h(c,{class:"flex-1 pop-formitem-input",type:"text",password:"",modelValue:a.passwordModel.repassword,"onUpdate:modelValue":s[11]||(s[11]=e=>a.passwordModel.repassword=e),placeholder:"請再次輸入密碼"},null,8,["modelValue"])])),_:1}),h(d,{class:"pop-sub-btn theme-btn",onClick:w(l.changePassword,["stop"])},{default:r((()=>[_("確定")])),_:1},8,["onClick"])])),_:1})])),_:1})):b("",!0),h(d,{class:"sub-btn theme-btn",onClick:l.update},{default:r((()=>[_("儲存")])),_:1},8,["onClick"]),h(d,{class:"setup-btn",onClick:s[12]||(s[12]=e=>l.logout())},{default:r((()=>[_("退出登入")])),_:1}),a.isUpload?(u(),p(j,{key:2,num:1,onGetImgs:l.getImgsFunc},null,8,["onGetImgs"])):b("",!0)])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-c1d016e9"]]);export{N as default};
