import{_ as s,a as t,o as e,c as o,w as i,b as a,d as c,t as l,f as r,r as p,F as u,e as d,n,u as _,g as h,i as m,j as f,h as k,S as w,I as g,D as S,z as y,R as b,B as v,Y as M,k as A,X as P}from"./index-6e5c77a7.js";import{j as x}from"./specSelect.07370fba.js";import{M as D}from"./Mpservice.14b0894b.js";import{s as C}from"./mp-share.5df2fe0f.js";import{A as j}from"./app-share.6adf735f.js";import{_ as F}from"./fenxiang.6373a85a.js";import"./uni-popup.f3f35788.js";/* empty css                                                                  */import"./share.0e953495.js";const V=s({components:{Spec:s({data:()=>({Visible:!1,form:{detail:{product_sku:{},show_sku:{},show_point_sku:{point_price:0}},show_sku:{sum:1}},stock:0,selectSpec:"",isAll:!1,is_change:!1,clock:!1}),props:["isPopup","productModel"],onLoad(){},mounted(){},computed:{isadd:function(){return this.form.show_sku.sum>=this.stock||this.form.show_sku.sum>=this.form.detail.limit_num},issub:function(){return this.form.show_sku.sum<=1}},watch:{isPopup:function(s,t){s!=t&&(this.Visible=s,this.isOpenSpec||(this.form=this.productModel,this.isOpenSpec=!0,this.initShowSku(),this.form.specData.spec_attr.forEach(((s,t)=>{this.selectAttr(t,0)}))),this.form.type=this.productModel.type,console.log(this.productModel))},"form.specData":{handler(s,t){let e="",o="";if(this.isAll=!0,s){for(let t=0;t<s.spec_attr.length;t++)null==this.form.productSpecArr[t]?(this.isAll=!1,e+=s.spec_attr[t].group_name+" "):s.spec_attr[t].spec_items.forEach((s=>{this.form.productSpecArr[t]==s.item_id&&(o+='"'+s.spec_value+'" ')}));this.isAll?o="已選: "+o:e="請選擇: "+e}this.selectSpec=this.isAll?o:e},deep:!0,immediate:!0}},methods:{closePopup(){this.$emit("close",this.form.specData,null)},confirmFunc(){null==this.form.specData||this.isAll?this.createdOrder():t({title:"請選擇規格",icon:"none",duration:2e3})},initShowSku(){this.form.show_sku.sku_image=this.form.detail.product.image[0].file_path,this.form.show_sku.point_price=this.form.detail.point_price,this.form.show_sku.product_sku_id=0,this.form.show_sku.line_price=this.form.detail.line_price,this.form.show_sku.point_stock=this.form.detail.stock,this.form.show_sku.point_product_sku_id=0,this.form.show_sku.point_num=this.form.detail.sku[0].point_num,this.form.show_sku.point_money=this.form.detail.sku[0].point_money,this.form.show_sku.product_sku_id=0,this.stock=this.form.detail.stock},selectAttr(s,t){let e=this,o=e.form.specData.spec_attr[s].spec_items,i=o[t];if(i.checked)i.checked=!1,e.form.productSpecArr[s]=null;else{for(let s=0;s<o.length;s++)o[s].checked=!1;i.checked=!0,e.form.productSpecArr[s]=i.item_id}x(e.form.specData.spec_attr,s,e.form.productSpecArr,e.form.productSku);let a=!0;for(let c=0;c<e.form.productSpecArr.length;c++){if(null==e.form.productSpecArr[c])return a=!1,void e.initShowSku()}a?e.updateSpecProduct():e.initShowSku()},updateSpecProduct(){let s=this,t=s.form.productSpecArr.join("_"),e=s.form.specData.spec_list.find((s=>s.spec_sku_id==t));if(e){if(s.clock=!1,"object"==typeof e){let t=s.form.detail.sku.find((s=>s.product_sku_id==e.product_sku_id));console.log(t),s.stock=t.point_stock,s.form.show_sku.sum>s.stock&&(s.form.show_sku.sum=s.stock>0?s.stock:1),s.form.show_sku.line_price=e.spec_form.product_price,s.form.show_sku.product_sku_id=e.spec_sku_id,s.form.show_sku.point_price=t.point_price,s.form.show_sku.point_product_sku_id=t.point_product_sku_id,s.form.show_sku.point_stock=t.point_stock,e.spec_form.image_id>0?s.form.show_sku.sku_image=e.spec_form.image_path:s.form.show_sku.sku_image=s.form.detail.product.image[0].file_path}}else s.clock=!0},createdOrder(){let s=this,t=s.form.detail.point_product_id,e=s.form.show_sku.sum,o=s.form.show_sku.product_sku_id,i=s.form.show_sku.point_product_sku_id;s.gotoPage("/pages/order/confirm-order?product_num="+e+"&point_product_id="+t+"&product_sku_id="+o+"&point_product_sku_id="+i+"&order_type=points")},add(){if(!(this.stock<=0))return this.form.show_sku.sum>=this.stock?(t({title:"數量超過了庫存",icon:"none",duration:2e3}),!1):this.form.show_sku.sum>=this.form.detail.limit_num?(t({title:"數量超過了限購數量",icon:"none",duration:2e3}),!1):void this.form.show_sku.sum++},sub(){if(!(this.stock<=0))return this.form.show_sku.sum<2?(t({title:"商品數量至少為1",icon:"none",duration:2e3}),!1):void this.form.show_sku.sum--}}},[["render",function(s,t,S,y,b,v){const M=h,A=m,P=f,x=k,D=w,C=g;return e(),o(M,{"data-theme":s.theme(),class:n(b.Visible?"product-popup open "+s.theme():"product-popup close "+s.theme()),onTouchmove:t[5]||(t[5]=_((()=>{}),["stop","prevent"])),onClick:v.closePopup},{default:i((()=>[a(M,{class:"popup-bg"}),a(M,{class:"main",onClick:t[4]||(t[4]=_((()=>{}),["stop"]))},{default:i((()=>[a(M,{class:"header"},{default:i((()=>[a(A,{src:b.form.show_sku.sku_image,mode:"aspectFit",class:"avt"},null,8,["src"]),a(M,{class:"price d-s-c"},{default:i((()=>[a(P,{class:"f24"},{default:i((()=>[c("所需"+l(s.points_name()),1)])),_:1}),a(P,{class:"num fb f34"},{default:i((()=>[c(l(b.form.show_sku.point_num),1)])),_:1}),a(P,null,{default:i((()=>[c("+")])),_:1}),a(P,{class:"old-price"},{default:i((()=>[c("¥"+l(b.form.show_sku.point_money),1)])),_:1})])),_:1}),a(M,{class:"stock"},{default:i((()=>[c("庫存："+l(b.form.show_sku.point_stock),1)])),_:1}),a(M,{class:"p-20-0 select_spec"},{default:i((()=>[c(l(b.selectSpec),1)])),_:1}),a(M,{class:"close-btn",onClick:v.closePopup},{default:i((()=>[a(P,{class:"icon iconfont icon-youshang"})])),_:1},8,["onClick"])])),_:1}),a(M,{class:"body"},{default:i((()=>[a(M,null,{default:i((()=>[null!=b.form.specData?(e(),o(D,{key:0,"scroll-y":"true",class:"specs mt20",style:{"max-height":"600rpx"}},{default:i((()=>[(e(!0),r(u,null,p(b.form.specData.spec_attr,((s,t)=>(e(),o(M,{class:"specs mt20",key:t},{default:i((()=>[a(M,{class:"specs-hd p-20-0"},{default:i((()=>[a(P,{class:"f24 gray9"},{default:i((()=>[c(l(s.group_name),1)])),_:2},1024),null==b.form.productSpecArr[t]?(e(),o(P,{key:0,class:"ml10 red"},{default:i((()=>[c("請選擇"+l(s.group_name),1)])),_:2},1024)):d("",!0)])),_:2},1024),a(M,{class:"specs-list"},{default:i((()=>[(e(!0),r(u,null,p(s.spec_items,((s,a)=>(e(),o(x,{class:n(s.checked?"btn-checked":"btn-checke"),key:a,onClick:s=>v.selectAttr(t,a)},{default:i((()=>[c(l(s.spec_value),1)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})):d("",!0)])),_:1}),a(M,{class:"level-box count_choose"},{default:i((()=>[a(P,{class:"key"},{default:i((()=>[c("數量")])),_:1}),a(M,{class:"d-s-c"},{default:i((()=>[a(M,{class:n(["icon-box minus d-c-c",{"num-wrap":!v.issub}]),onClick:t[0]||(t[0]=s=>v.sub())},{default:i((()=>[a(P,{class:"icon iconfont icon-jian",style:{"font-size":"20rpx",color:"#333333"}})])),_:1},8,["class"]),a(M,{class:"text-wrap"},{default:i((()=>[a(C,{type:"text",modelValue:b.form.show_sku.sum,"onUpdate:modelValue":t[1]||(t[1]=s=>b.form.show_sku.sum=s)},null,8,["modelValue"])])),_:1}),a(M,{class:n(["icon-box plus d-c-c",{"num-wrap":!v.isadd}]),onClick:t[2]||(t[2]=s=>v.add())},{default:i((()=>[a(P,{class:"icon iconfont icon-jia",style:{"font-size":"20rpx",color:"#333333"}})])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),a(M,{class:"btns white"},{default:i((()=>[b.clock?(e(),o(x,{key:1,class:"confirm-btn"},{default:i((()=>[c("暫無庫存")])),_:1})):(e(),o(x,{key:0,class:"confirm-btn",onClick:t[3]||(t[3]=s=>v.confirmFunc(b.form))},{default:i((()=>[c("確認")])),_:1}))])),_:1})])),_:1})])),_:1},8,["data-theme","class","onClick"])}],["__scopeId","data-v-28f39ffc"]]),Mpservice:D,share:C,AppShare:j},data:()=>({phoneHeight:0,scrollviewHigh:0,loadding:!0,indicatorDots:!0,autoplay:!0,interval:2e3,duration:500,point_product_id:null,imagList:[],detail:{product_sku:{},show_sku:{product_price:"",product_sku_id:0,line_price:"",stock_num:0,sku_image:""},show_point_sku:{}},isPopup:!1,specData:null,productModel:{},productSku:[],isMpservice:!1,isMpShare:!1,isAppShare:!1,appParams:{title:"",summary:"",path:""},url:""}),onReady(){S({title:this.points_name()+"商品"})},onLoad(s){this.point_product_id=s.point_product_id,this.url=window.location.href},mounted(){this.getData()},onShareAppMessage(){let s=this,t=s.getShareUrlParams({point_product_id:s.point_product_id});return{title:s.detail.product.product_name,path:"/pages/plus/points/detail/detail?"+t}},methods:{getData(){let s=this,t=s.point_product_id;y({title:"載入中"}),s._get("plus.points.product/detail",{point_product_id:t,url:s.url},(function(t){if(t.data.detail.product.content=b.format_content(t.data.detail.product.content),20==t.data.detail.product.spec_type&&s.initSpecData(t.data.detail.sku,t.data.specData),s.detail=t.data.detail,""!=s.url){let e={point_product_id:s.point_product_id};s.configWx(t.data.share.signPackage,t.data.share.shareParams,e)}s.loadding=!1,v()}))},initSpecData(s,t){for(let e=0;e<s.length;e++){let t=s[e];if(t.productSku){let s=t.productSku.spec_sku_id.split("_").map(Number);this.productSku.push(s)}}for(let e in t.spec_attr)for(let s=0;s<t.spec_attr[e].spec_items.length;s++){let o=t.spec_attr[e].spec_items[s];this.hasSpec(o.item_id,e)?(o.checked=!1,o.disabled=!1):(t.spec_attr[e].spec_items.splice(s,1),s--)}this.specData=t},hasSpec(s,t){let e=!1;for(let o=0;o<this.productSku.length;o++){if(this.productSku[o][t]==s){e=!0;break}}return e},openPopup(s){let t={specData:this.specData,detail:this.detail,productSpecArr:null!=this.specData?new Array(this.specData.spec_attr.length):[],show_sku:{sku_image:"",seckill_price:0,product_sku_id:0,line_price:0,seckill_stock:0,seckill_product_sku_id:0,sum:1},productSku:this.productSku,type:s};this.productModel=t,this.isPopup=!0},closePopup(){this.isPopup=!1},openMaservice(){this.isMpservice=!0},closeMpservice(){this.isMpservice=!1},showShare(){this.isMpShare=!0},closeBottmpanel(s){this.isMpShare=!1},closeAppShare(s){this.isAppShare=!1}}},[["render",function(s,t,_,w,g,S){const y=m,b=P,v=M,x=h,D=f,C=k,j=A("spec"),V=A("share"),L=A("AppShare"),O=A("Mpservice");return g.loadding?d("",!0):(e(),o(x,{key:0,class:n(["product-detail",s.theme()||""]),"data-theme":s.theme()},{default:i((()=>[a(x,{class:"product-pic"},{default:i((()=>[a(v,{class:"swiper","indicator-dots":g.indicatorDots,autoplay:g.autoplay,interval:g.interval,duration:g.duration},{default:i((()=>[(e(!0),r(u,null,p(g.detail.product.image,((s,t)=>(e(),o(b,{key:t},{default:i((()=>[a(y,{src:s.file_path,mode:""},null,8,["src"])])),_:2},1024)))),128))])),_:1},8,["indicator-dots","autoplay","interval","duration"])])),_:1}),a(x,{class:"bg-white"},{default:i((()=>[a(x,{class:"price-wrap pr"},{default:i((()=>[a(x,{class:"flex-1 d-s-s d-c"},{default:i((()=>[a(x,{class:"new-price"},{default:i((()=>[a(D,{class:"red f24"},{default:i((()=>[c("所需"+l(s.points_name()),1)])),_:1}),a(D,{class:"red fb f50"},{default:i((()=>[c(l(g.detail.sku[0].point_num),1)])),_:1}),g.detail.sku[0].point_money>0?(e(),r(u,{key:0},[a(D,{class:"red f40 gray9"},{default:i((()=>[c("+")])),_:1}),a(D,null,{default:i((()=>[c("¥")])),_:1}),a(D,{class:"num fb f40"},{default:i((()=>[c(l(g.detail.sku[0].point_money),1)])),_:1})],64)):d("",!0)])),_:1}),a(D,{class:"old-price"},{default:i((()=>[c("¥"+l(g.detail.sku[0].productSku.line_price),1)])),_:1})])),_:1}),a(x,{class:"share-box"},{default:i((()=>[a(C,{onClick:S.showShare,"open-type":"share"},{default:i((()=>[a(y,{class:"share_img",src:F,mode:""})])),_:1},8,["onClick"])])),_:1}),a(D,{class:"already-sale"},{default:i((()=>[c("還剩餘"+l(g.detail.stock)+"件",1)])),_:1})])),_:1}),a(x,{class:"product-name"},{default:i((()=>[c(l(g.detail.product.product_name),1)])),_:1}),a(x,{class:"product-describe"},{default:i((()=>[c(l(g.detail.product.selling_point),1)])),_:1})])),_:1}),a(x,{class:"product-content"},{default:i((()=>[a(x,{class:"group-hd border-b-e"},{default:i((()=>[a(x,{class:"left"},{default:i((()=>[a(D,{class:"min-name"},{default:i((()=>[c("商品介紹")])),_:1})])),_:1})])),_:1}),0==g.detail.product.is_picture?(e(),o(x,{key:0,class:"content-box",innerHTML:g.detail.product.content},null,8,["innerHTML"])):d("",!0),1==g.detail.product.is_picture?(e(),o(x,{key:1,class:"content-box"},{default:i((()=>[(e(!0),r(u,null,p(g.detail.product.contentImage,((s,t)=>(e(),o(x,{class:"ww100",key:t},{default:i((()=>[a(y,{class:"ww100",src:s.file_path,mode:"widthFix"},null,8,["src"])])),_:2},1024)))),128))])),_:1})):d("",!0)])),_:1}),a(x,{class:"btns-wrap"},{default:i((()=>[a(x,{class:"customer-service d-c-c"},{default:i((()=>[a(x,{class:"icon-box",onClick:S.openMaservice},{default:i((()=>[a(C,{class:"d-c-c d-c bg-white"},{default:i((()=>[a(D,{class:"icon iconfont icon-kefu gray3",style:{height:"50rpx","line-height":"60rpx"}}),a(D,{class:"f22 gray3",style:{height:"50rpx","line-height":"40rpx"}},{default:i((()=>[c("客服")])),_:1})])),_:1})])),_:1},8,["onClick"])])),_:1}),a(C,{type:"primary",class:"buy",onClick:t[0]||(t[0]=s=>S.openPopup("order"))},{default:i((()=>[c("立即搶購")])),_:1})])),_:1}),a(j,{isPopup:g.isPopup,productModel:g.productModel,onClose:S.closePopup},null,8,["isPopup","productModel","onClose"]),a(V,{isMpShare:g.isMpShare,onClose:S.closeBottmpanel},null,8,["isMpShare","onClose"]),a(L,{isAppShare:g.isAppShare,appParams:g.appParams,onClose:S.closeAppShare},null,8,["isAppShare","appParams","onClose"]),g.isMpservice?(e(),o(O,{key:0,isMpservice:g.isMpservice,onClose:S.closeMpservice},null,8,["isMpservice","onClose"])):d("",!0)])),_:1},8,["data-theme","class"]))}],["__scopeId","data-v-dc7fc0d0"]]);export{V as default};
