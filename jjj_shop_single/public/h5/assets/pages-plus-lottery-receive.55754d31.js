import{_ as e,o as s,f as t,c as a,w as o,b as l,d as c,t as d,F as r,r as i,j as u,g as p,n as _,I as n,a as f,e as m,u as h,i as k,h as y,S as g,R as b,z as x,J as S,B as w,M as A,k as v}from"./index-6e5c77a7.js";const P=e({components:{Myinfo:e({data:()=>({}),props:["Address","exist_address"],onLoad(){},mounted(){},methods:{addAddress(){let e="/pages/user/address/address?source=order";this.exist_address||(e="/pages/user/address/add/add"),this.gotoPage(e)}}},[["render",function(e,n,f,m,h,k){const y=u,g=p;return s(),t("div",null,[null==f.Address?(s(),a(g,{key:0,class:"add-address d-s-c",onClick:n[0]||(n[0]=e=>k.addAddress())},{default:o((()=>[l(g,{class:"icon-box mr10"},{default:o((()=>[l(y,{class:"icon iconfont icon-dizhi1"})])),_:1}),l(y,null,{default:o((()=>[c("請新增收貨地址")])),_:1})])),_:1})):(s(),a(g,{key:1,class:"address-defalut-wrap"},{default:o((()=>[l(g,{class:"info"},{default:o((()=>[l(y,{class:"state"},{default:o((()=>[c("預設")])),_:1}),l(y,{class:"type"},{default:o((()=>[c("家")])),_:1}),l(y,{class:"province-c-a"},{default:o((()=>[c(d(f.Address.region.province)+" "+d(f.Address.region.city)+" "+d(f.Address.region.region),1)])),_:1})])),_:1}),l(g,{class:"address"},{default:o((()=>[l(y,{class:"fb gray3"},{default:o((()=>[c(d(f.Address.detail),1)])),_:1}),l(g,{class:"icon-box",onClick:n[1]||(n[1]=e=>k.addAddress())},{default:o((()=>[l(y,{class:"icon iconfont icon-you"})])),_:1})])),_:1}),l(g,{class:"user"},{default:o((()=>[l(y,{class:"name"},{default:o((()=>[c(d(f.Address.name),1)])),_:1}),l(y,{class:"tel"},{default:o((()=>[c(d(f.Address.phone),1)])),_:1})])),_:1})])),_:1})),l(g,{class:"addree-bottom"},{default:o((()=>[(s(),t(r,null,i(10,((e,s)=>l(g,{class:"stripe",key:s},{default:o((()=>[l(y,{class:_(s%2==0?"red":"blue")},null,8,["class"]),l(y,{class:"white"})])),_:2},1024))),64))])),_:1})])}]]),Storeinfo:e({data:()=>({linkman:"",phone:""}),props:["extract_store","last_extract"],onLoad(){},mounted(){this.linkman=this.last_extract.linkman,this.phone=this.last_extract.phone},methods:{addAddress(){let e=-1;this.extract_store.store_id&&(e=this.extract_store.store_id),this.gotoPage("/pages/store/address/address?store_id="+e)}}},[["render",function(e,f,m,h,k,y){const g=u,b=p,x=n;return s(),t("div",null,[m.extract_store.store_id?(s(),a(b,{key:1,class:"address-defalut-wrap"},{default:o((()=>[l(b,{class:"info d-s-s"},{default:o((()=>[l(g,{class:"state"},{default:o((()=>[c("當前自提點")])),_:1}),l(b,{class:"province-c-a d-s-s flex-1"},{default:o((()=>[l(g,null,{default:o((()=>[c(d(m.extract_store.region.province),1)])),_:1}),l(g,null,{default:o((()=>[c(d(m.extract_store.region.city),1)])),_:1}),l(g,null,{default:o((()=>[c(d(m.extract_store.region.region),1)])),_:1})])),_:1})])),_:1}),l(b,{class:"address"},{default:o((()=>[l(g,{class:"fb gray3"},{default:o((()=>[c(d(m.extract_store.store_name),1)])),_:1}),l(b,{class:"icon-box",onClick:f[1]||(f[1]=e=>y.addAddress())},{default:o((()=>[l(g,{class:"icon iconfont icon-you"})])),_:1})])),_:1}),l(b,{class:"user"},{default:o((()=>[l(g,{class:"name"},{default:o((()=>[c(d(m.extract_store.address),1)])),_:1}),l(g,{class:"tel"},{default:o((()=>[c(d(m.extract_store.phone),1)])),_:1})])),_:1})])),_:1})):(s(),a(b,{key:0,class:"add-address d-s-c",onClick:f[0]||(f[0]=e=>y.addAddress())},{default:o((()=>[l(b,{class:"icon-box mr10"},{default:o((()=>[l(g,{class:"icon iconfont icon-dizhi1"})])),_:1}),l(g,null,{default:o((()=>[c("請選擇自提點")])),_:1})])),_:1})),l(b,{class:"addree-bottom"},{default:o((()=>[(s(),t(r,null,i(10,((e,s)=>l(b,{class:"stripe",key:s},{default:o((()=>[l(g,{class:_(s%2==0?"red":"blue")},null,8,["class"]),l(g,{class:"white"})])),_:2},1024))),64))])),_:1}),l(b,{class:"buy-checkout vender"},{default:o((()=>[l(b,{class:"group-hd"},{default:o((()=>[l(b,{class:"left"},{default:o((()=>[l(g,{class:"min-name"},{default:o((()=>[c("提貨人資訊")])),_:1})])),_:1})])),_:1}),l(b,{class:"item"},{default:o((()=>[l(g,{class:"key"},{default:o((()=>[c("聯絡人：")])),_:1}),l(x,{type:"text",modelValue:k.linkman,"onUpdate:modelValue":f[2]||(f[2]=e=>k.linkman=e),class:"flex-1 f30","placeholder-class":"gray",placeholder:"請輸入聯絡人"},null,8,["modelValue"])])),_:1}),l(b,{class:"item"},{default:o((()=>[l(g,{class:"key"},{default:o((()=>[c("聯絡電話：")])),_:1}),l(x,{type:"text",modelValue:k.phone,"onUpdate:modelValue":f[3]||(f[3]=e=>k.phone=e),class:"flex-1 f30","placeholder-class":"gray",placeholder:"請輸入聯絡電話"},null,8,["modelValue"])])),_:1})])),_:1})])}],["__scopeId","data-v-325cef02"]]),spec:e({data:()=>({Visible:!1,form:{detail:{},show_sku:{sku_image:""}},stock:0,selectSpec:"",isOpenSpec:!1,type:""}),props:["isPopup","productModel"],onLoad(){},mounted(){},computed:{isadd:function(){return this.form.show_sku.sum>=this.stock||this.form.show_sku.sum>=this.form.detail.limit_num},issub:function(){return this.form.show_sku.sum<=1}},watch:{isPopup:function(e,s){e!=s&&(this.Visible=e,this.form=this.productModel,this.initShowSku(),this.updateSpecProduct(),this.form.type=this.productModel.type,this.form.specData.spec_attr.forEach(((e,s)=>{e.spec_items.forEach(((e,t)=>{e.checked?(this.form.specData.spec_attr[s].spec_items[t].checked=!1,this.form.productSpecArr[s]=e.item_id):(this.form.productSpecArr[s]=null,this.form.specData.spec_attr[s].spec_items[t].checked=!1)}))})))},"form.specData":{handler(e,s){let t="",a="";if(this.isAll=!0,e){for(let s=0;s<e.spec_attr.length;s++)null==this.form.productSpecArr[s]?(this.isAll=!1,t+=e.spec_attr[s].group_name+" "):e.spec_attr[s].spec_items.forEach((e=>{this.form.productSpecArr[s]==e.item_id&&(a+='"'+e.spec_value+'" ')}));this.isAll?a="已選: "+a:t="請選擇: "+t}this.selectSpec=this.isAll?a:t},deep:!0,immediate:!0}},methods:{initShowSku(){this.form.show_sku.sku_image=this.form.detail.image[0].file_path,this.form.show_sku.product_price=this.form.detail.product_price,this.form.show_sku.product_sku_id=0,this.form.show_sku.line_price=this.form.detail.line_price,this.form.show_sku.stock_num=this.form.detail.product_stock,this.form.show_sku.sum=1,this.stock=this.form.detail.product_stock},selectAttr(e,s){let t=this,a=t.form.specData.spec_attr[e].spec_items,o=a[s];if(o.checked)t.form.specData.spec_attr[e].spec_items[s].checked=!1,t.form.productSpecArr[e]=null;else{for(let s=0;s<a.length;s++)t.form.specData.spec_attr[e].spec_items[s].checked=!1;t.form.specData.spec_attr[e].spec_items[s].checked=!0,t.form.productSpecArr[e]=o.item_id}for(let l=0;l<t.form.productSpecArr.length;l++)if(null==t.form.productSpecArr[l])return void t.initShowSku();t.updateSpecProduct()},updateSpecProduct(){let e=this,s=e.form.productSpecArr.join("_"),t=e.form.specData.spec_list.find((e=>e.spec_sku_id==s));"object"==typeof t&&(e.stock=t.spec_form.stock_num,e.form.show_sku.sum>e.stock&&(e.form.show_sku.sum=e.stock>0?e.stock:1),e.form.show_sku.product_sku_id=s,e.form.show_sku.product_price=t.spec_form.product_price,e.form.show_sku.line_price=t.spec_form.line_price,e.form.show_sku.stock_num=t.spec_form.stock_num,t.spec_form.image_id>0?e.form.show_sku.sku_image=t.spec_form.image_path:e.form.show_sku.sku_image=e.form.detail.image[0].file_path)},closePopup(){if(null!=this.form.specData)for(let s=0;s<this.form.productSpecArr.length;s++)if(null==this.form.productSpecArr[s])return void f({title:"請選擇規格",icon:"none",duration:2e3});this.form.show_sku.sum;let e={product_id:this.form.detail.product_id,product_sku_id:this.form.show_sku.product_sku_id};this.$emit("close",this.form.specData,e)},add(){if(!(this.stock<=0))return this.form.show_sku.sum>=this.stock?(f({title:"數量超過了庫存",icon:"none",duration:2e3}),!1):this.form.show_sku.sum>=this.form.detail.limit_num?(f({title:"數量超過了限購數量",icon:"none",duration:2e3}),!1):void this.form.show_sku.sum++},sub(){if(!(this.stock<=0))return this.form.show_sku.sum<2?(f({title:"商品數量至少為1",icon:"none",duration:2e3}),!1):void this.form.show_sku.sum--}}},[["render",function(e,n,f,b,x,S){const w=p,A=k,v=u,P=y,D=g;return s(),a(w,{class:_(x.Visible?"product-popup open":"product-popup close"),onTouchmove:n[2]||(n[2]=h((()=>{}),["stop","prevent"])),onClick:S.closePopup},{default:o((()=>[l(w,{class:"popup-bg"}),l(w,{class:"main",onClick:n[1]||(n[1]=h((()=>{}),["stop"]))},{default:o((()=>[l(w,{class:"header"},{default:o((()=>[l(A,{src:x.form.show_sku.sku_image,mode:"aspectFit",class:"avt"},null,8,["src"]),l(w,{class:""},{default:o((()=>[c(d(x.selectSpec),1)])),_:1}),l(w,{class:"close-btn",onClick:S.closePopup},{default:o((()=>[l(v,{class:"icon iconfont icon-guanbi"})])),_:1},8,["onClick"])])),_:1}),l(w,{class:"body"},{default:o((()=>[l(w,null,{default:o((()=>[null!=x.form.specData?(s(),a(D,{key:0,"scroll-y":"true",class:"specs mt20",style:{"max-height":"600rpx"}},{default:o((()=>[(s(!0),t(r,null,i(x.form.specData.spec_attr,((e,u)=>(s(),a(w,{class:"specs mt20",key:u},{default:o((()=>[l(w,{class:"specs-hd p-20-0"},{default:o((()=>[l(v,{class:"f24 gray9"},{default:o((()=>[c(d(e.group_name),1)])),_:2},1024),null==x.form.productSpecArr[u]?(s(),a(v,{key:0,class:"ml10 red"},{default:o((()=>[c("請選擇"+d(e.group_name),1)])),_:2},1024)):m("",!0)])),_:2},1024),l(w,{class:"specs-list"},{default:o((()=>[(s(!0),t(r,null,i(e.spec_items,((e,t)=>(s(),a(P,{type:"primary",class:_(e.checked?"btn-red":"btn-gray-border"),key:t,onClick:e=>S.selectAttr(u,t)},{default:o((()=>[c(d(e.spec_value),1)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})):m("",!0)])),_:1})])),_:1}),l(w,{class:"btns"},{default:o((()=>[l(P,{type:"primary",class:"confirm-btn",onClick:n[0]||(n[0]=e=>S.closePopup())},{default:o((()=>[c("選好了")])),_:1})])),_:1})])),_:1})])),_:1},8,["class","onClick"])}],["__scopeId","data-v-80e79877"]])},data:()=>({record_id:0,loadding:!0,indicatorDots:!0,autoplay:!0,interval:2e3,duration:500,id:0,tab_type:0,detail:{name:"",point:"",money:"",coupon_list:[]},store_id:0,exist_address:!1,Address:null,delivery:0,extract_store:{},last_extract:{},chooseProlist:[],productModel:{},isPopup:!1,alreadyChioce:{},code:0,chooseSpecData:null,chooseDetail:{product_sku:{},show_sku:{product_price:"",product_sku_id:0,line_price:"",stock_num:0,sku_image:""}},product_sku_id:0,deliverySetting:[],lock:!1}),onLoad(e){let s=this;b.getSceneData(e),s.$fire.on("selectStoreId",(function(e){s.store_id=e})),this.record_id=e.record_id,this.code=e.code},onShow(){this.getData()},methods:{onPay(){let e=this;if(e.lock)return;e.lock=!0,x({title:"載入中"});let s={record_id:e.record_id,product_sku_id:e.product_sku_id,delivery_type:e.delivery,extract:""},t="",a="";if(null!=e.$refs&&null!=e.$refs.getShopinfoData&&(t=e.$refs.getShopinfoData.phone,a=e.$refs.getShopinfoData.linkman),20==e.delivery){let o={phone:t,linkman:a,store_id:e.store_id};s.extract=JSON.stringify(o)}e._post("plus.lottery.order/buy",s,(function(s){S({content:"兌換成功",showCancel:!1,success(s){s.confirm&&e.gotoPage("/pages/user/index/index")}})}),(s=>{e.lock=!1}))},getData(){let e=this;x({title:"載入中"}),e.loadding=!0;let s={record_id:e.record_id,delivery_type:e.delivery};20==e.delivery?s.store_id=e.store_id:s.store_id=0,e._get("plus.lottery.order/buy",s,(function(s){e.deliverySetting=s.data.data.deliverySetting,e.detail=s.data.data.product[0],e.extract_store=s.data.data.extract_store,e.exist_address=s.data.data.exist_address,e.Address=s.data.data.address,e.delivery=s.data.data.delivery_type,10==e.delivery?e.tab_type=0:e.tab_type=1,w(),e.loadding=!1}),(function(e){A({delta:1})}))},hasType(e){return-1!=this.deliverySetting.indexOf(e)},tabFunc(e){this.tab_type=e,this.delivery=0==e?10:20,this.getData()},choosePaytype(e){this.payType=e},closePopup(e,s){if(this.isPopup=!1,console.log(s),e&&e.spec_attr){this.detail.spec_name="";let t="已選：",a="";e.spec_attr.forEach((e=>{if(e.spec_items){let s="";for(let t=0;t<e.spec_items.length;t++){let a=e.spec_items[t];if(a.checked){s=a.spec_value+" / ";break}}""!=s?t+=s:a+=e.group_name}})),this.product_sku_id=s.product_sku_id,""!=a?this.detail.spec_name=a:(t=t.replace(/(\s\/\s)$/gi,""),this.detail.spec_name=t)}},openPopup(e,s,t){let a={specData:s,detail:t,productSpecArr:null!=s?new Array(s.spec_attr.length):[],show_sku:{sku_image:"",seckill_price:0,product_sku_id:0,line_price:0,seckill_stock:0,seckill_product_sku_id:0,sum:1},type:e};this.productModel=a,this.isPopup=!0}}},[["render",function(e,t,r,i,n,f){const h=p,g=v("Myinfo"),b=v("Storeinfo"),x=k,S=u,w=y,A=v("spec");return n.loadding?m("",!0):(s(),a(h,{key:0,class:"gift-package"},{default:o((()=>[l(h,{class:"top-tabbar"},{default:o((()=>[f.hasType("10")?(s(),a(h,{key:0,class:_(0==n.tab_type?"tab-item active":"tab-item"),onClick:t[0]||(t[0]=e=>f.tabFunc(0))},{default:o((()=>[c("快遞配送")])),_:1},8,["class"])):m("",!0),f.hasType("20")?(s(),a(h,{key:1,class:_(1==n.tab_type?"tab-item active":"tab-item"),onClick:t[1]||(t[1]=e=>f.tabFunc(1))},{default:o((()=>[c("上門自提")])),_:1},8,["class"])):m("",!0)])),_:1}),0==n.tab_type?(s(),a(g,{key:0,Address:n.Address,exist_address:n.exist_address},null,8,["Address","exist_address"])):m("",!0),1==n.tab_type?(s(),a(b,{key:1,ref:"getShopinfoData",extract_store:n.extract_store,last_extract:n.last_extract},null,8,["extract_store","last_extract"])):m("",!0),l(h,{class:"gift-package-main"},{default:o((()=>[l(h,{class:""},{default:o((()=>[n.detail?(s(),a(h,{key:0,class:"p-0-30"},{default:o((()=>[l(h,{class:"cuopon-group",if:"detail.is_coupon"},{default:o((()=>[l(h,{class:"body"},{default:o((()=>[l(h,{class:"item mb30 borbox bg-white"},{default:o((()=>[l(h,{class:"d-s-c"},{default:o((()=>[l(h,null,{default:o((()=>[n.detail.image?(s(),a(x,{key:0,class:"product_img",src:n.detail.image[0].file_path,mode:"aspectFill"},null,8,["src"])):m("",!0)])),_:1}),l(h,{class:"pro"},{default:o((()=>[l(h,{class:"pro_t"},{default:o((()=>[c(d(n.detail.product_name),1)])),_:1}),n.detail.spec_name&&0!=n.detail.product_multi_spec?(s(),a(h,{key:0,class:"pro_c"},{default:o((()=>[c(d(n.detail.spec_name),1)])),_:1})):m("",!0),n.detail.spec_name||0==n.detail.product_multi_spec?m("",!0):(s(),a(h,{key:1,class:"pro_c"},{default:o((()=>[c("請選擇規格")])),_:1})),l(h,{class:"d-b-c"},{default:o((()=>[l(h,{class:"pro_b"},{default:o((()=>[l(S,{class:"f18"},{default:o((()=>[c("￥")])),_:1}),c(" "+d(n.detail.product_price),1)])),_:1}),0!=n.detail.product_multi_spec?(s(),a(h,{key:0,class:"speci",onClick:t[2]||(t[2]=e=>f.openPopup("order",n.detail.product_multi_spec,n.detail))},{default:o((()=>[c(" 選規格 ")])),_:1})):m("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):m("",!0)])),_:1})])),_:1}),l(h,{class:"btns d-e-c"},{default:o((()=>[l(w,{onClick:t[3]||(t[3]=e=>f.onPay()),class:"mr20"},{default:o((()=>[c("確認")])),_:1})])),_:1}),l(A,{isPopup:n.isPopup,productModel:n.productModel,onClose:f.closePopup},null,8,["isPopup","productModel","onClose"])])),_:1}))}],["__scopeId","data-v-bf27c6e5"]]);export{P as default};
