import{_ as s,a as e,o as t,c as a,w as i,b as o,f as l,d as c,t as r,F as u,r as p,e as d,n,u as _,g as f,i as h,j as m,h as k,S as g,I as b,z as w,x as y,y as S,R as v,B as C,q as x,Y as A,G as M,k as P,X as D}from"./index-6e5c77a7.js";import{C as R}from"./countdown.ae2f98a7.js";import{r as j}from"./uni-app.es.5424dc16.js";import{M as V}from"./Mpservice.14b0894b.js";import{j as F}from"./specSelect.07370fba.js";import{s as H}from"./mp-share.5df2fe0f.js";import{A as I}from"./app-share.6adf735f.js";import{_ as O}from"./fenxiang.6373a85a.js";import"./uni-popup.f3f35788.js";/* empty css                                                                  */import"./share.0e953495.js";const z=s({components:{Spec:s({data:()=>({Visible:!1,form:{detail:{product_sku:{},show_sku:{},show_point_sku:{bargain_price:0}},show_sku:{sum:1}},stock:0,selectSpec:"",isAll:!1}),props:["isPopup","productModel"],onLoad(){},mounted(){},computed:{isadd:function(){return this.form.show_sku.sum>=this.stock||this.form.show_sku.sum>=this.form.detail.limit_num},issub:function(){return this.form.show_sku.sum<=1}},watch:{isPopup:function(s,e){s!=e&&(this.Visible=s,this.isOpenSpec||(this.form=this.productModel,this.isOpenSpec=!0,this.initShowSku()),this.form.type=this.productModel.type)},"form.specData":{handler(s,e){let t="",a="";if(this.isAll=!0,s){for(let e=0;e<s.spec_attr.length;e++)null==this.form.productSpecArr[e]?(this.isAll=!1,t+=s.spec_attr[e].group_name+" "):s.spec_attr[e].spec_items.forEach((s=>{this.form.productSpecArr[e]==s.item_id&&(a+='"'+s.spec_value+'" ')}));this.isAll?a="已選: "+a:t="請選擇: "+t}this.selectSpec=this.isAll?a:t},deep:!0,immediate:!0,clock:!1}},methods:{closePopup(){this.$emit("close",this.form.specData,null)},confirmFunc(){null==this.form.specData||this.isAll?this.createdOrder():e({title:"請選擇規格",icon:"none",duration:2e3})},initShowSku(){this.form.show_sku.sku_image=this.form.detail.product.image[0].file_path,this.form.show_sku.bargain_price=this.form.detail.bargain_price,this.form.show_sku.product_sku_id=0,this.form.show_sku.line_price=this.form.detail.line_price,this.form.show_sku.bargain_stock=this.form.detail.stock,this.form.show_sku.bargain_product_sku_id=this.form.detail.bargainSku[0].bargain_product_sku_id,this.form.show_sku.sum=1,this.stock=this.form.detail.stock},selectAttr(s,e){let t=this;console.log(t.form.specData);let a=t.form.specData.spec_attr[s].spec_items,i=a[e];if(i.checked)i.checked=!1,t.form.productSpecArr[s]=null;else{for(let s=0;s<a.length;s++)a[s].checked=!1;i.checked=!0,t.form.productSpecArr[s]=i.item_id}F(t.form.specData.spec_attr,s,t.form.productSpecArr,t.form.productSku);let o=!0;for(let l=0;l<t.form.productSpecArr.length;l++){if(null==t.form.productSpecArr[l])return o=!1,void t.initShowSku()}o?t.updateSpecProduct():t.initShowSku()},updateSpecProduct(){let s=this,e=s.form.productSpecArr.join("_"),t=s.form.specData.spec_list.find((s=>s.spec_sku_id==e));if(t){if(s.clock=!1,"object"==typeof t){let e=s.form.detail.bargainSku.find((s=>s.product_sku_id==t.product_sku_id));s.stock=e.bargain_stock,s.form.show_sku.sum>s.stock&&(s.form.show_sku.sum=s.stock>0?s.stock:1),s.form.show_sku.product_sku_id=t.spec_sku_id,s.form.show_sku.bargain_price=e.bargain_price,s.form.show_sku.line_price=t.spec_form.product_price,s.form.show_sku.bargain_stock=e.bargain_stock,s.form.show_sku.bargain_product_sku_id=e.bargain_product_sku_id,t.spec_form.image_id>0?s.form.show_sku.sku_image=t.spec_form.image_path:s.form.show_sku.sku_image=s.form.detail.product.image[0].file_path}}else s.clock=!0},createdOrder(){let s=this,e=s.form.detail.bargain_activity_id,t=s.form.detail.bargain_product_id,a=s.form.show_sku.bargain_product_sku_id,i=s.form.show_sku.product_sku_id;s.form.detail.product_id,s._get("plus.bargain.task/add",{bargain_activity_id:e,bargain_product_id:t,bargain_product_sku_id:a,product_sku_id:i},(function(e){s.$emit("confirm");let t="/pages/plus/bargain/haggle/haggle?bargain_task_id="+e.data.bargain_task_id+"&order_type=bargain";s.gotoPage(t)}))},add(){if(!(this.stock<=0))return this.form.show_sku.sum>=this.stock?(e({title:"數量超過了庫存",icon:"none",duration:2e3}),!1):this.form.show_sku.sum>=this.form.detail.limit_num?(e({title:"數量超過了限購數量",icon:"none",duration:2e3}),!1):void this.form.show_sku.sum++},sub(){if(!(this.stock<=0))return this.form.show_sku.sum<2?(e({title:"商品數量至少為1",icon:"none",duration:2e3}),!1):void this.form.show_sku.sum--}}},[["render",function(s,e,w,y,S,v){const C=f,x=h,A=m,M=k,P=g,D=b;return t(),a(C,{class:n(S.Visible?"product-popup open":"product-popup close"),onTouchmove:e[5]||(e[5]=_((()=>{}),["stop","prevent"])),onClick:v.closePopup},{default:i((()=>[o(C,{class:"popup-bg"}),o(C,{class:"main",onClick:e[4]||(e[4]=_((()=>{}),["stop"]))},{default:i((()=>[o(C,{class:"header"},{default:i((()=>[o(x,{src:S.form.show_sku.sku_image,mode:"aspectFit",class:"avt"},null,8,["src"]),o(C,{class:"price d-s-c"},{default:i((()=>[null==S.form.specData||S.isAll?(t(),l(u,{key:0},[o(A,null,{default:i((()=>[c("¥")])),_:1}),o(A,{class:"num fb"},{default:i((()=>[c(r(S.form.show_sku.bargain_price),1)])),_:1}),o(A,{class:"old-price"},{default:i((()=>[c("¥"+r(S.form.show_sku.line_price),1)])),_:1})],64)):(t(),l(u,{key:1},[o(A,{class:"f22"},{default:i((()=>[c("¥")])),_:1}),o(A,{class:"f40 fb"},{default:i((()=>[c(r(S.form.detail.bargain_price),1)])),_:1})],64))])),_:1}),o(C,{class:"stock"},{default:i((()=>[c("庫存："+r(S.form.show_sku.bargain_stock),1)])),_:1}),o(C,{class:"p-20-0 select_spec"},{default:i((()=>[c(r(S.selectSpec),1)])),_:1}),o(C,{class:"close-btn",onClick:v.closePopup},{default:i((()=>[o(A,{class:"icon iconfont icon-guanbi"})])),_:1},8,["onClick"])])),_:1}),o(C,{class:"body"},{default:i((()=>[null!=S.form.specData?(t(),a(C,{key:0},{default:i((()=>[null!=S.form.specData?(t(),a(P,{key:0,"scroll-y":"true",class:"specs mt20",style:{"max-height":"600rpx"}},{default:i((()=>[(t(!0),l(u,null,p(S.form.specData.spec_attr,((s,e)=>(t(),a(C,{class:"specs mt20",key:e},{default:i((()=>[o(C,{class:"specs-hd p-20-0"},{default:i((()=>[o(A,{class:"f24 gray9"},{default:i((()=>[c(r(s.group_name),1)])),_:2},1024),null==S.form.productSpecArr[e]?(t(),a(A,{key:0,class:"ml10 red"},{default:i((()=>[c("請選擇"+r(s.group_name),1)])),_:2},1024)):d("",!0)])),_:2},1024),o(C,{class:"specs-list"},{default:i((()=>[(t(!0),l(u,null,p(s.spec_items,((s,o)=>(t(),a(M,{class:n(s.checked?"btn-checked":"btn-checke"),key:o,onClick:s=>v.selectAttr(e,o)},{default:i((()=>[c(r(s.spec_value),1)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})):d("",!0)])),_:1})):d("",!0),o(C,{class:"level-box count_choose"},{default:i((()=>[o(A,{class:"key"},{default:i((()=>[c("數量")])),_:1}),o(C,{class:"d-s-c"},{default:i((()=>[o(C,{class:n(["icon-box minus d-c-c",{"num-wrap":!v.issub}]),onClick:e[0]||(e[0]=s=>v.sub())},{default:i((()=>[o(A,{class:"icon iconfont icon-jian",style:{"font-size":"20rpx",color:"#333333"}})])),_:1},8,["class"]),o(C,{class:"text-wrap"},{default:i((()=>[o(D,{type:"text",modelValue:S.form.show_sku.sum,"onUpdate:modelValue":e[1]||(e[1]=s=>S.form.show_sku.sum=s)},null,8,["modelValue"])])),_:1}),o(C,{class:n(["icon-box plus d-c-c",{"num-wrap":!v.isadd}]),onClick:e[2]||(e[2]=s=>v.add())},{default:i((()=>[o(A,{class:"icon iconfont icon-jia",style:{"font-size":"20rpx",color:"#333333"}})])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),o(C,{class:"btns white"},{default:i((()=>[s.clock?(t(),a(M,{key:1,class:"confirm-btn"},{default:i((()=>[c("暫無庫存")])),_:1})):(t(),a(M,{key:0,class:"confirm-btn",onClick:e[3]||(e[3]=s=>v.confirmFunc(S.form))},{default:i((()=>[c("確認")])),_:1}))])),_:1})])),_:1})])),_:1},8,["class","onClick"])}],["__scopeId","data-v-35402229"]]),Rule:s({data:()=>({openRule:!1}),props:["isRule","setting"],watch:{isRule:function(s,e){s!=e&&(this.openRule=s)}},methods:{closeRule(){this.openRule=!1,this.$emit("close")}}},[["render",function(s,e,l,u,p,h){const k=f,g=m;return p.openRule?(t(),a(k,{key:0,class:"rule-detail-wrap"},{default:i((()=>[o(k,{class:n(["rule-bg",p.openRule?"active":""]),onClick:h.closeRule},null,8,["onClick","class"]),o(k,{class:"rule-content",onClick:e[0]||(e[0]=_((()=>{}),["stop"]))},{default:i((()=>[o(k,{class:"title pr"},{default:i((()=>[o(g,{class:""},{default:i((()=>[c("活動規則")])),_:1}),o(g,{class:"iconfont icon-guanbi",onClick:h.closeRule},null,8,["onClick"])])),_:1}),o(k,{class:"content"},{default:i((()=>[c(r(l.setting.bargain_rules),1)])),_:1})])),_:1})])),_:1})):d("",!0)}],["__scopeId","data-v-445ea727"]]),countdown:R,Mpservice:V,share:H,AppShare:I},data:()=>({phoneHeight:0,scrollviewHigh:0,loadding:!0,indicatorDots:!0,autoplay:!0,interval:2e3,duration:500,countdownConfig:{startstamp:0,endstamp:0},detail:{product_sku:{},show_sku:{product_price:"",product_sku_id:0,line_price:"",stock_num:0,sku_image:""},show_point_sku:{}},setting:{},isPopup:!1,specData:null,productModel:{},productSpecArr:[],isRule:!1,productSku:[],isMpservice:!1,isMpShare:!1,isAppShare:!1,appParams:{title:"",summary:"",path:""},url:""}),onLoad(s){w({title:"載入中"}),this.type_active=0,this.bargain_product_id=s.bargain_product_id,this.url=window.location.href},onShareAppMessage(){let s=this,e=s.getShareUrlParams({bargain_product_id:s.bargain_product_id});return{title:s.detail.product.product_name,path:"/pages/plus/bargain/detail/detail?"+e}},mounted(){this.init(),this.getData()},methods:{init(){let s=this;y({success(e){s.phoneHeight=e.windowHeight,S().select(".btns-wrap").boundingClientRect((e=>{let t=s.phoneHeight-e.height;s.scrollviewHigh=t})).exec()}})},getData(){let s=this,e=s.bargain_product_id;s._get("plus.bargain.product/detail",{bargain_product_id:e,url:s.url},(function(e){if(s.countdownConfig.startstamp=e.data.active.start_time,s.countdownConfig.endstamp=e.data.active.end_time,e.data.detail.product.content=v.format_content(e.data.detail.product.content),20==e.data.detail.product.spec_type&&s.initSpecData(e.data.detail.bargainSku,e.data.specData),s.setting=e.data.setting,s.detail=e.data.detail,""!=s.url){let t={bargain_product_id:s.bargain_product_id};s.configWx(e.data.share.signPackage,e.data.share.shareParams,t)}s.loadding=!1,C()}))},initSpecData(s,e){for(let t=0;t<s.length;t++){let e=s[t];if(e.productSku){let s=e.productSku.spec_sku_id.split("_").map(Number);this.productSku.push(s)}}for(let t in e.spec_attr)for(let s=0;s<e.spec_attr[t].spec_items.length;s++){let a=e.spec_attr[t].spec_items[s];this.hasSpec(a.item_id,t)?(a.checked=!1,a.disabled=!1):(e.spec_attr[t].spec_items.splice(s,1),s--)}this.specData=e},hasSpec(s,e){let t=!1;for(let a=0;a<this.productSku.length;a++){if(this.productSku[a][e]==s){t=!0;break}}return t},openPopup(s){let e={specData:this.specData,detail:this.detail,productSpecArr:null!=this.specData?new Array(this.specData.spec_attr.length):[],show_sku:{sku_image:"",bargain_price:0,product_sku_id:0,line_price:0,bargain_stock:0,bargain_product_sku_id:0,sum:1},productSku:this.productSku,type:s};this.productModel=e,this.isPopup=!0},closePopup(){this.isPopup=!1},openMaservice(){this.isMpservice=!0},closeMpservice(){this.isMpservice=!1},gotoProducntDetail(){let s="/pages/product/detail/detail?product_id="+this.detail.product_id;this.gotoPage(s)},openRule(){this.isRule=!0},closeRule(){this.isRule=!1},returnValFunc(){},showShare(){this.isMpShare=!0},closeBottmpanel(s){this.isMpShare=!1},closeAppShare(s){this.isAppShare=!1}}},[["render",function(s,e,n,_,b,w){const y=h,S=D,v=A,C=f,V=m,F=k,H=j(M("countdown"),R),I=g,z=P("spec"),L=P("Rule"),B=P("share"),T=P("AppShare"),$=P("Mpservice");return t(),a(C,{class:"bargain-detail"},{default:i((()=>[b.loadding?d("",!0):(t(),a(I,{key:0,"scroll-y":"true",class:"scroll-Y",style:x("height:"+b.scrollviewHigh+"px;")},{default:i((()=>[o(C,{class:"product-pic"},{default:i((()=>[o(v,{class:"swiper","indicator-dots":b.indicatorDots,autoplay:b.autoplay,interval:b.interval,duration:b.duration},{default:i((()=>[(t(!0),l(u,null,p(b.detail.product.image,((s,e)=>(t(),a(S,{key:e},{default:i((()=>[o(y,{src:s.file_path,mode:""},null,8,["src"])])),_:2},1024)))),128))])),_:1},8,["indicator-dots","autoplay","interval","duration"])])),_:1}),o(C,{class:"bg-white m20 p30 br12"},{default:i((()=>[o(C,{class:"price-wrap pr"},{default:i((()=>[o(C,{class:"left"},{default:i((()=>[o(C,{class:"new-price"},{default:i((()=>[o(V,{class:"f24 redF6"},{default:i((()=>[c("￥")])),_:1}),o(V,{class:"num"},{default:i((()=>[c(r(b.detail.bargain_price),1)])),_:1})])),_:1}),o(V,{class:"old-price"},{default:i((()=>[c("¥"+r(b.detail.line_price),1)])),_:1})])),_:1}),o(C,{class:"share-box"},{default:i((()=>[o(F,{onClick:w.showShare,"open-type":"share"},{default:i((()=>[o(y,{class:"share_img",src:O,mode:""})])),_:1},8,["onClick"])])),_:1})])),_:1}),o(C,{class:"product-name"},{default:i((()=>[c(r(b.detail.product.product_name),1)])),_:1}),o(C,{class:""},{default:i((()=>[o(C,{class:"limited-spike d-b-c"},{default:i((()=>[o(V,{class:"left-name"},{default:i((()=>[o(V,{class:"already-sale"},{default:i((()=>[c("已有"+r(b.detail.product_sales)+"人砍價成功",1)])),_:1})])),_:1}),o(C,{class:"right"},{default:i((()=>[o(H,{ref:"countdown",config:b.countdownConfig,onReturnVal:w.returnValFunc},null,8,["config","onReturnVal"])])),_:1})])),_:1})])),_:1}),o(C,{class:"d-b-c f24 gray3 mt20",onClick:w.openRule},{default:i((()=>[o(V,{class:"f24 gray3"},{default:i((()=>[c("邀請朋友幫忙砍價，超低價購買心儀之物")])),_:1}),o(C,null,{default:i((()=>[o(V,null,{default:i((()=>[c("玩法詳情")])),_:1}),o(V,{class:"icon iconfont icon-you",style:{color:"#333333","font-size":"25rpx"}})])),_:1})])),_:1},8,["onClick"])])),_:1}),o(C,{class:"product-content"},{default:i((()=>[o(C,{class:"group-hd border-b-e"},{default:i((()=>[o(C,{class:"d-s-c"},{default:i((()=>[o(C,{class:"pro_nameline"}),o(V,{class:"min-name f32 fb"},{default:i((()=>[c("商品介紹")])),_:1})])),_:1})])),_:1}),0==b.detail.product.is_picture?(t(),a(C,{key:0,class:"content-box",innerHTML:b.detail.product.content},null,8,["innerHTML"])):d("",!0),1==b.detail.product.is_picture?(t(),a(C,{key:1,class:"content-box"},{default:i((()=>[(t(!0),l(u,null,p(b.detail.product.contentImage,((s,e)=>(t(),a(C,{class:"ww100",key:e},{default:i((()=>[o(y,{class:"ww100",src:s.file_path,mode:"widthFix"},null,8,["src"])])),_:2},1024)))),128))])),_:1})):d("",!0)])),_:1})])),_:1},8,["style"])),o(C,{class:"btns-wrap d-s-c d-stretch"},{default:i((()=>[b.loadding?d("",!0):(t(),l(u,{key:0},[o(C,{class:"customer-service d-c-c"},{default:i((()=>[o(C,{class:"icon-box d-c-c",onClick:e[0]||(e[0]=e=>s.gotoPage("/pages/index/index"))},{default:i((()=>[o(F,{class:"d-c-c d-c bg-white"},{default:i((()=>[o(V,{class:"btn_btom pr icon iconfont icon-shouye gray3",style:{height:"50rpx","line-height":"60rpx"}}),o(V,{class:"f22 gray3",style:{height:"50rpx","line-height":"40rpx"}},{default:i((()=>[c("首頁")])),_:1})])),_:1})])),_:1}),o(C,{class:"icon-box",onClick:w.openMaservice},{default:i((()=>[o(F,{class:"d-c-c d-c bg-white"},{default:i((()=>[o(V,{class:"icon iconfont icon-kefu gray3",style:{height:"50rpx","line-height":"60rpx"}}),o(V,{class:"f22 gray3",style:{height:"50rpx","line-height":"40rpx"}},{default:i((()=>[c("客服")])),_:1})])),_:1})])),_:1},8,["onClick"])])),_:1}),o(C,{class:"buy-alone flex-1 d-c-c d-c",onClick:e[1]||(e[1]=s=>w.gotoProducntDetail())},{default:i((()=>[o(V,null,{default:i((()=>[c("￥"+r(b.detail.product.product_price),1)])),_:1}),o(F,{type:"primary"},{default:i((()=>[c("單獨購買")])),_:1})])),_:1}),o(C,{class:"make-group flex-1 d-c-c d-c",onClick:e[3]||(e[3]=s=>w.openPopup("order"))},{default:i((()=>[o(V,null,{default:i((()=>[c("￥"+r(b.detail.bargain_price),1)])),_:1}),o(F,{type:"primary",class:"buy",onClick:e[2]||(e[2]=s=>w.openPopup("order"))},{default:i((()=>[c("砍價購")])),_:1})])),_:1})],64))])),_:1}),o(z,{isPopup:b.isPopup,productModel:b.productModel,onClose:w.closePopup},null,8,["isPopup","productModel","onClose"]),o(L,{isRule:b.isRule,setting:b.setting,onClose:w.closeRule},null,8,["isRule","setting","onClose"]),o(B,{isMpShare:b.isMpShare,onClose:w.closeBottmpanel},null,8,["isMpShare","onClose"]),o(T,{isAppShare:b.isAppShare,appParams:b.appParams,onClose:w.closeAppShare},null,8,["isAppShare","appParams","onClose"]),b.isMpservice?(t(),a($,{key:1,isMpservice:b.isMpservice,onClose:w.closeMpservice},null,8,["isMpservice","onClose"])):d("",!0)])),_:1})}],["__scopeId","data-v-113edd05"]]);export{z as default};
