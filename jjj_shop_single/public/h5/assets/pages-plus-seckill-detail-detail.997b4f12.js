import{_ as s,a as e,o as t,c as i,w as o,b as l,f as c,d as a,t as r,F as u,r as p,e as d,n,u as _,g as h,i as f,j as m,h as k,S as g,I as w,x as y,y as S,z as b,R as v,B as A,q as C,Y as M,k as x,X as D}from"./index-6e5c77a7.js";import{j as P}from"./specSelect.07370fba.js";import{C as j}from"./countdown.ae2f98a7.js";import{M as H}from"./Mpservice.14b0894b.js";import{s as V}from"./mp-share.5df2fe0f.js";import{A as F}from"./app-share.6adf735f.js";import{_ as O}from"./fenxiang.6373a85a.js";import"./uni-popup.f3f35788.js";/* empty css                                                                  */import"./share.0e953495.js";const L=s({components:{Spec:s({data:()=>({Visible:!1,phoneHeight:0,scrollviewHigh:400,form:{detail:{product_sku:{},show_sku:{},show_point_sku:{seckill_price:0}},show_sku:{sum:1},specData:null},stock:0,selectSpec:"",isAll:!1}),props:["isPopup","productModel"],onLoad(){},mounted(){},computed:{isadd:function(){return this.form.show_sku.sum>=this.stock||this.form.show_sku.sum>=this.form.detail.limit_num},issub:function(){return this.form.show_sku.sum<=1}},watch:{isPopup:function(s,e){s!=e&&(this.Visible=s,this.isOpenSpec||(this.form=this.productModel,this.isOpenSpec=!0,this.initShowSku(),this.form.specData.spec_attr.forEach(((s,e)=>{this.selectAttr(e,0)}))),this.form.type=this.productModel.type)},"form.specData":{handler(s,e){let t="",i="";if(this.isAll=!0,s){if(""!=s)for(let e=0;e<s.spec_attr.length;e++)null==this.form.productSpecArr[e]?(this.isAll=!1,t+=s.spec_attr[e].group_name+" "):s.spec_attr[e].spec_items.forEach((s=>{this.form.productSpecArr[e]==s.item_id&&(i+='"'+s.spec_value+'" ')}));this.isAll?i="已選: "+i:t="請選擇: "+t,this.selectSpec=this.isAll?i:t}},deep:!0,immediate:!0}},methods:{init(){this.phoneHeight=res.scrollviewHigh},closePopup(){this.$emit("close",this.form.specData,null)},initShowSku(){this.form.show_sku.sku_image=this.form.detail.product.image[0].file_path,this.form.show_sku.seckill_price=this.form.detail.seckill_price,this.form.show_sku.product_sku_id=0,this.form.show_sku.line_price=this.form.detail.line_price,this.form.show_sku.seckill_stock=this.form.detail.stock,this.form.show_sku.sum=1,this.stock=this.form.detail.product_stock},confirmFunc(){null==this.form.specData||this.isAll?this.createdOrder():e({title:"請選擇規格",icon:"none",duration:2e3})},selectAttr(s,e){let t=this,i=t.form.specData.spec_attr[s].spec_items,o=i[e];if(o.checked)o.checked=!1,t.form.productSpecArr[s]=null;else{for(let s=0;s<i.length;s++)i[s].checked=!1;o.checked=!0,t.form.productSpecArr[s]=o.item_id}P(t.form.specData.spec_attr,s,t.form.productSpecArr,t.form.productSku);let l=!0;for(let c=0;c<t.form.productSpecArr.length;c++){if(null==t.form.productSpecArr[c])return l=!1,void t.initShowSku()}l?t.updateSpecProduct():t.initShowSku()},updateSpecProduct(){let s=this,e=s.form.productSpecArr.join("_"),t=s.form.specData.spec_list.find((s=>s.spec_sku_id==e));if("object"==typeof t){let e=s.form.detail.seckillSku.find((s=>s.product_sku_id==t.product_sku_id));s.stock=e.seckill_stock,s.form.show_sku.sum>s.stock&&(s.form.show_sku.sum=s.stock>0?s.stock:1),s.form.show_sku.line_price=t.spec_form.product_price,s.form.show_sku.product_sku_id=t.spec_sku_id,s.form.show_sku.seckill_price=e.seckill_price,s.form.show_sku.seckill_product_sku_id=e.seckill_product_sku_id,s.form.show_sku.seckill_stock=e.seckill_stock,t.spec_form.image_id>0?s.form.show_sku.sku_image=t.spec_form.image_path:s.form.show_sku.sku_image=s.form.detail.product.image[0].file_path}},createdOrder(){let s=this;s.$emit("confirm");let e=s.form.detail.seckill_product_id,t=s.form.show_sku.sum,i=s.form.show_sku.product_sku_id,o=s.form.show_sku.seckill_product_sku_id;this.gotoPage("/pages/order/confirm-order?product_num="+t+"&seckill_product_id="+e+"&product_sku_id="+i+"&seckill_product_sku_id="+o+"&order_type=seckill")},add(){if(!(this.stock<=0))return this.form.show_sku.sum>=this.stock?(e({title:"數量超過了庫存",icon:"none",duration:2e3}),!1):this.form.show_sku.sum>=this.form.detail.limit_num?(e({title:"數量超過了限購數量",icon:"none",duration:2e3}),!1):void this.form.show_sku.sum++},sub(){if(!(this.stock<=0))return this.form.show_sku.sum<2?(e({title:"商品數量至少為1",icon:"none",duration:2e3}),!1):void this.form.show_sku.sum--}}},[["render",function(s,e,y,S,b,v){const A=h,C=f,M=m,x=k,D=g,P=w;return t(),i(A,{class:n(b.Visible?"product-popup open":"product-popup close"),onTouchmove:e[5]||(e[5]=_((()=>{}),["stop","prevent"])),onClick:v.closePopup},{default:o((()=>[l(A,{class:"popup-bg"}),l(A,{class:"main",onClick:e[4]||(e[4]=_((()=>{}),["stop"]))},{default:o((()=>[l(A,{class:"header"},{default:o((()=>[l(C,{src:b.form.show_sku.sku_image,mode:"aspectFit",class:"avt"},null,8,["src"]),l(A,{class:"price d-s-c"},{default:o((()=>[null==b.form.specData||b.isAll?(t(),c(u,{key:0},[l(M,null,{default:o((()=>[a("¥")])),_:1}),l(M,{class:"num fb"},{default:o((()=>[a(r(b.form.show_sku.seckill_price),1)])),_:1}),l(M,{class:"old-price"},{default:o((()=>[a("¥"+r(b.form.show_sku.line_price),1)])),_:1})],64)):(t(),c(u,{key:1},[l(M,{class:"f22"},{default:o((()=>[a("¥")])),_:1}),l(M,{class:"f40 fb"},{default:o((()=>[a(r(b.form.detail.seckill_price),1)])),_:1})],64))])),_:1}),l(A,{class:"stock"},{default:o((()=>[a("庫存："+r(b.form.show_sku.seckill_stock),1)])),_:1}),l(A,{class:"p-20-0 select_spec"},{default:o((()=>[a(r(b.selectSpec),1)])),_:1}),l(A,{class:"close-btn",onClick:v.closePopup},{default:o((()=>[l(M,{class:"icon iconfont icon-guanbi"})])),_:1},8,["onClick"])])),_:1}),l(A,{class:"body"},{default:o((()=>[b.form.specData?(t(),i(A,{key:0},{default:o((()=>[null!=b.form.specData?(t(),i(D,{key:0,"scroll-y":"true",class:"specs mt20",style:{"max-height":"600rpx"}},{default:o((()=>[(t(!0),c(u,null,p(b.form.specData.spec_attr,((s,e)=>(t(),i(A,{class:"specs mt20",key:e},{default:o((()=>[l(A,{class:"specs-hd p-20-0"},{default:o((()=>[l(M,{class:"f24 gray9"},{default:o((()=>[a(r(s.group_name),1)])),_:2},1024),null==b.form.productSpecArr[e]?(t(),i(M,{key:0,class:"ml10 red"},{default:o((()=>[a(" 請選擇"+r(s.group_name),1)])),_:2},1024)):d("",!0)])),_:2},1024),l(A,{class:"specs-list"},{default:o((()=>[(t(!0),c(u,null,p(s.spec_items,((s,l)=>(t(),i(x,{class:n(s.checked?"btn-checked":"btn-checke"),key:l,onClick:s=>v.selectAttr(e,l)},{default:o((()=>[a(r(s.spec_value),1)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})):d("",!0)])),_:1})):d("",!0),l(A,{class:"level-box count_choose"},{default:o((()=>[l(M,{class:"key"},{default:o((()=>[a("數量")])),_:1}),l(A,{class:"d-s-c"},{default:o((()=>[l(A,{class:n(["icon-box minus d-c-c",{"num-wrap":!v.issub}]),onClick:e[0]||(e[0]=s=>v.sub())},{default:o((()=>[l(M,{class:"icon iconfont icon-jian",style:{"font-size":"20rpx",color:"#333333"}})])),_:1},8,["class"]),l(A,{class:"text-wrap"},{default:o((()=>[l(P,{type:"text",modelValue:b.form.show_sku.sum,"onUpdate:modelValue":e[1]||(e[1]=s=>b.form.show_sku.sum=s)},null,8,["modelValue"])])),_:1}),l(A,{class:n(["icon-box plus d-c-c",{"num-wrap":!v.isadd}]),onClick:e[2]||(e[2]=s=>v.add())},{default:o((()=>[l(M,{class:"icon iconfont icon-jia",style:{"font-size":"20rpx",color:"#333333"}})])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),l(A,{class:"btns white"},{default:o((()=>[l(x,{class:"confirm-btn",onClick:e[3]||(e[3]=s=>v.confirmFunc(b.form))},{default:o((()=>[a("確認")])),_:1})])),_:1})])),_:1})])),_:1},8,["class","onClick"])}],["__scopeId","data-v-ae99fce6"]]),Countdown:j,Mpservice:H,share:V,AppShare:F},data:()=>({phoneHeight:0,scrollviewHigh:0,loadding:!0,indicatorDots:!0,autoplay:!0,interval:2e3,duration:500,seckill_product_id:null,detail:{product_sku:{},show_sku:{seckill_price:"",product_sku_id:0,line_price:"",stock_num:0,sku_image:"",seckill_product_sku_id:0},show_point_sku:{}},isPopup:!1,countdownConfig:{startstamp:0,endstamp:0},specData:null,productModel:{},productSku:[],isMpservice:!1,isMpShare:!1,isAppShare:!1,appParams:{title:"",summary:"",path:""},url:"",status:-1}),onLoad(s){this.seckill_product_id=s.seckill_product_id,this.url=window.location.href},mounted(){this.init(),this.getData()},onShareAppMessage(){let s=this,e=s.getShareUrlParams({seckill_product_id:s.seckill_product_id});return{title:s.detail.product.product_name,path:"/pages/plus/seckill/detail/detail?"+e}},methods:{init(){let s=this;y({success(e){s.phoneHeight=e.windowHeight,S().select(".btns-wrap").boundingClientRect((e=>{let t=s.phoneHeight-e.height;s.scrollviewHigh=t})).exec()}})},getData(){let s=this;b({title:"載入中"}),s._get("plus.seckill.product/detail",{seckill_product_id:s.seckill_product_id,url:s.url},(function(e){if(s.countdownConfig.endstamp=e.data.active.end_time,s.countdownConfig.startstamp=e.data.active.start_time,e.data.detail.product.content=v.format_content(e.data.detail.product.content),20==e.data.detail.product.spec_type&&s.initSpecData(e.data.detail.seckillSku,e.data.specData),s.detail=e.data.detail,""!=s.url){let t={seckill_product_id:s.seckill_product_id};s.configWx(e.data.share.signPackage,e.data.share.shareParams,t)}s.loadding=!1,A()}))},initSpecData(s,e){for(let t=0;t<s.length;t++){let e=s[t];if(e.productSku){let s=e.productSku.spec_sku_id.split("_").map(Number);this.productSku.push(s)}}for(let t in e.spec_attr)for(let s=0;s<e.spec_attr[t].spec_items.length;s++){let i=e.spec_attr[t].spec_items[s];this.hasSpec(i.item_id,t)?(i.checked=!1,i.disabled=!1):(e.spec_attr[t].spec_items.splice(s,1),s--)}this.specData=e},hasSpec(s,e){let t=!1;for(let i=0;i<this.productSku.length;i++){if(this.productSku[i][e]==s){t=!0;break}}return t},openPopup(s){let e={specData:this.specData,detail:this.detail,productSpecArr:null!=this.specData?new Array(this.specData.spec_attr.length):[],show_sku:{sku_image:"",seckill_price:0,product_sku_id:0,line_price:0,seckill_stock:0,seckill_product_sku_id:0,sum:1},productSku:this.productSku,type:s};this.productModel=e,this.isPopup=!0},closePopup(){this.isPopup=!1},openMaservice(){this.isMpservice=!0},closeMpservice(){this.isMpservice=!1},showShare(){this.isMpShare=!0},closeBottmpanel(s){this.isMpShare=!1},closeAppShare(s){this.isAppShare=!1},returnValFunc(s){this.status=s}}},[["render",function(s,e,_,w,y,S){const b=f,v=D,A=M,P=h,j=m,H=x("Countdown"),V=k,F=g,L=x("spec"),R=x("share"),z=x("AppShare"),B=x("Mpservice");return t(),i(P,{class:n(["product-detail",s.theme()||""]),"data-theme":s.theme()},{default:o((()=>[y.loadding?d("",!0):(t(),i(F,{key:0,"scroll-y":"true",class:"scroll-Y",style:C("height:"+y.scrollviewHigh+"px;")},{default:o((()=>[l(P,{class:"product-pic"},{default:o((()=>[l(A,{class:"swiper","indicator-dots":y.indicatorDots,autoplay:y.autoplay,interval:y.interval,duration:y.duration},{default:o((()=>[(t(!0),c(u,null,p(y.detail.product.image,((s,e)=>(t(),i(v,{key:e},{default:o((()=>[l(b,{src:s.file_path,mode:""},null,8,["src"])])),_:2},1024)))),128))])),_:1},8,["indicator-dots","autoplay","interval","duration"])])),_:1}),l(P,{class:"limited-spike d-b-c m-0-20 mt20"},{default:o((()=>[l(j,{class:"left-name"},{default:o((()=>[a("限時秒殺")])),_:1}),l(P,{class:"right d-s-c"},{default:o((()=>[l(H,{ref:"countdown",config:y.countdownConfig,onReturnVal:S.returnValFunc},null,8,["config","onReturnVal"])])),_:1})])),_:1}),l(P,{class:"bg-white m-0-20 mb20 p30 bottom-radius"},{default:o((()=>[l(P,{class:"price-wrap mb16 pr"},{default:o((()=>[l(P,{class:"left"},{default:o((()=>[l(P,{class:"new-price"},{default:o((()=>[l(j,{class:"f24 redF6"},{default:o((()=>[a("￥")])),_:1}),l(j,{class:"num"},{default:o((()=>[a(r(y.detail.seckill_price),1)])),_:1})])),_:1}),l(j,{class:"old-price"},{default:o((()=>[a(r("￥"+y.detail.line_price),1)])),_:1})])),_:1}),l(P,{class:"share-box"},{default:o((()=>[l(V,{onClick:S.showShare,"open-type":"share"},{default:o((()=>[l(b,{class:"share_img",src:O,mode:""})])),_:1},8,["onClick"])])),_:1})])),_:1}),l(j,{class:"already-sale"},{default:o((()=>[a("已出售"+r(y.detail.product_sales)+"件",1)])),_:1}),l(P,{class:"product-name"},{default:o((()=>[a(r(y.detail.product.product_name),1)])),_:1}),l(P,{class:"product-describe"},{default:o((()=>[a(r(y.detail.product.selling_point),1)])),_:1})])),_:1}),l(P,{class:"product-content"},{default:o((()=>[l(P,{class:"group-hd border-b-e"},{default:o((()=>[l(P,{class:"d-s-c"},{default:o((()=>[l(P,{class:"pro_nameline"}),l(j,{class:"min-name f32 fb"},{default:o((()=>[a("商品介紹")])),_:1})])),_:1})])),_:1}),l(P,{class:"content-box",innerHTML:y.detail.product.content},null,8,["innerHTML"])])),_:1})])),_:1},8,["style"])),l(P,{class:"btns-wrap"},{default:o((()=>[l(P,{class:"customer-service d-c-c"},{default:o((()=>[l(P,{class:"icon-box d-c-c",onClick:e[0]||(e[0]=e=>s.gotoPage("/pages/index/index"))},{default:o((()=>[l(V,{class:"d-c-c d-c bg-white"},{default:o((()=>[l(j,{class:"btn_btom pr icon iconfont icon-shouye gray3",style:{height:"50rpx","line-height":"60rpx"}}),l(j,{class:"f22 gray3",style:{height:"50rpx","line-height":"40rpx"}},{default:o((()=>[a("首頁")])),_:1})])),_:1})])),_:1}),l(P,{class:"icon-box",onClick:S.openMaservice},{default:o((()=>[l(V,{class:"d-c-c d-c bg-white"},{default:o((()=>[l(j,{class:"icon iconfont icon-kefu gray3",style:{height:"50rpx","line-height":"60rpx"}}),l(j,{class:"f22 gray3",style:{height:"50rpx","line-height":"40rpx"}},{default:o((()=>[a("客服")])),_:1})])),_:1})])),_:1},8,["onClick"])])),_:1}),0==y.status?(t(),i(V,{key:0,type:"primary",class:"buy",onClick:e[1]||(e[1]=s=>S.openPopup("order"))},{default:o((()=>[a("立即搶購")])),_:1})):d("",!0),1==y.status?(t(),i(V,{key:1,type:"primary",class:"btn-gray"},{default:o((()=>[a("未開始")])),_:1})):d("",!0),2==y.status?(t(),i(V,{key:2,type:"primary",class:"btn-gray"},{default:o((()=>[a("已結束")])),_:1})):d("",!0),0==y.detail.stock?(t(),i(V,{key:3,type:"primary",class:"btn-gray"},{default:o((()=>[a("已搶光")])),_:1})):d("",!0)])),_:1}),l(L,{isPopup:y.isPopup,productModel:y.productModel,onClose:S.closePopup},null,8,["isPopup","productModel","onClose"]),l(R,{isMpShare:y.isMpShare,onClose:S.closeBottmpanel},null,8,["isMpShare","onClose"]),l(z,{isAppShare:y.isAppShare,appParams:y.appParams,onClose:S.closeAppShare},null,8,["isAppShare","appParams","onClose"]),y.isMpservice?(t(),i(B,{key:1,isMpservice:y.isMpservice,onClose:S.closeMpservice},null,8,["isMpservice","onClose"])):d("",!0)])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-c84d1f14"]]);export{L as default};
