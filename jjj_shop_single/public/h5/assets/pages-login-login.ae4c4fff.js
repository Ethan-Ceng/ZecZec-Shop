import{_ as e,A as i,L as t,a as s,z as a,s as o,M as n,B as d,o as l,c,w as g,n as r,g as u,b as _,d as f,t as p,i as h,j as m}from"./index-6e5c77a7.js";const k=e({data:()=>({wx_phone:!1,loading:!0,background:"",listData:[],invitation_id:0,user_id:"",mobile:!0,isRead:!1,setting:{login_desc:"",login_logo:"",name:""}}),onShow(){this.wx_phone=i("wxBinding")||0},onLoad(e){this.invitation_id=i("invitation_id")||0;let s=this;this.getCodeType(),uni.getUserInfo({success:function(e){const a=e.userInfo;console.log(a),t({provider:"weixin",success:e=>{console.log("res-login",e),s.code=e.code,"login:ok"==e.errMsg&&(s.code,a.nickName,a.avatarUrl,s._post("user.user/login",{code:s.code,source:"wx",invitation_id:s.invitation_id,referee_id:i("referee_id")},(e=>{s.user_id=e.data.user_id,s.mobile=e.data.mobile}),!1,(()=>{s.loading=!1})))}})}})},methods:{xieyi(e){this.gotoPage("/pages/webview/ue?type="+e)},getCodeType(){let e=this;e._post("index/loginSetting",{},(i=>{e.setting=i.data.setting}))},onNotLogin:function(){this.gotoPage("/pages/index/index")},UserLogin(){let e=this;e.loading||(e.isRead?(a({title:"正在處理",mask:!0}),t({success(i){let t={code:i.code};e._post("user.user/userLogin",t,(e=>{o("token",e.data.token),o("user_id",e.data.user_id),n()}),!1,(()=>{d()}))}})):s({title:"請勾選並同意《隱私政策》和《使用者協議》",icon:"none"}))},getUserInfo:function(e){let i=this;if(!i.loading)if(i.isRead){if("getPhoneNumber:ok"!==e.detail.errMsg)return!1;a({title:"正在處理",mask:!0}),t({success(t){let s={code:t.code,user_id:i.user_id,encrypted_data:e.detail.encryptedData,iv:e.detail.iv};i._post("user.user/bindMobile",s,(e=>{o("token",e.data.token),o("user_id",e.data.user_id),n()}),!1,(()=>{d()}))}})}else s({title:"請勾選並同意《隱私政策》和《使用者協議》",icon:"none"})},onGetAuthorize(e){console.log("開始授權");let i=this;t({provider:"alipay",success:function(e){console.log("sucss"),uni.getUserInfo({provider:"alipay",success:function(t){i.aliPayLogin(e,t)}})},fail(e){console.log(e)}})},aliPayLogin(e,i){let t=this;console.log(e),console.log(i),a({title:"登入中",mask:!0}),t._post("user.useralipay/login",{code:e.code,avatar:i.avatar,nickName:i.nickName},(e=>{console.log(e.data.token),o("token",e.data.token),o("user_id",e.data.user_id),t.gotoPage("/pages/index/index","redirect")}),!1,(()=>{t.gotoPage("/pages/index/index","redirect")}))}}},[["render",function(e,i,t,s,a,o){const n=h,d=u,k=m;return l(),c(d,{class:r(["login-container",e.theme()||""]),"data-theme":e.theme()},{default:g((()=>[_(d,{class:"wechatapp"},{default:g((()=>[_(n,{class:"logo-image",src:a.setting.login_logo||"/static/login-default.png"},null,8,["src"]),_(d,{class:"d-c-c f30 gray3"},{default:g((()=>[f(p(a.setting.name),1)])),_:1})])),_:1}),_(d,{class:"auth-title fb"},{default:g((()=>[f(p(a.setting.login_desc),1)])),_:1}),_(d,{class:"auth-subtitle"},{default:g((()=>[f("授權繫結手機號 為您提供更好的服務")])),_:1}),_(d,{class:"login-btn d-c-c"}),_(d,{onClick:i[2]||(i[2]=e=>a.isRead=!a.isRead),class:"d-c-c gray6 mt20"},{default:g((()=>[_(d,{class:r(["icon iconfont icon-tijiaochenggong",a.isRead?"active agreement":"agreement"])},null,8,["class"]),f(" 我已閱讀並接受"),_(k,{class:"dominant",onClick:i[0]||(i[0]=e=>o.xieyi("service"))},{default:g((()=>[f("《使用者協議》")])),_:1}),f("和"),_(k,{class:"dominant",onClick:i[1]||(i[1]=e=>o.xieyi("privacy"))},{default:g((()=>[f("《隱私政策》")])),_:1})])),_:1}),_(d,{class:"no-login-btn d-c d-c-c"},{default:g((()=>[_(d,{class:"f26 gray9",onClick:o.onNotLogin},{default:g((()=>[f("暫不登入")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-ee93e011"]]);export{k as default};
