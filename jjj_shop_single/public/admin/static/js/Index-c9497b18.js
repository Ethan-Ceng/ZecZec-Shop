import{f as e,c as t,d as i,e as a,b as l,i as s,E as o,u as r,w as n,s as c,l as d}from"./element-plus-4e26fc63.js";import{r as g}from"./request-58949a77.js";import{_ as p}from"./index-bb8b9786.js";import{o as m,S as u,R as h,O as y,V as f,c as C,a as _,P as F,a8 as v,X as b,ad as j,L as k,W as T,a0 as w,U as x}from"./@vue-5c89b57d.js";import"./lodash-es-493ac664.js";import"./async-validator-cf877c1f.js";import"./@vueuse-e57ebffb.js";import"./dayjs-342c85a3.js";import"./call-bind-0966096f.js";import"./get-intrinsic-ccd8a43d.js";import"./has-symbols-456daba2.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-9b3bb84c.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./axios-85bcd05e.js";import"./qs-9a0be292.js";import"./side-channel-7d553c0c.js";import"./object-inspect-1e1e9601.js";import"./vue-router-feb6ca35.js";import"./pinia-3964e703.js";import"./vue-demi-71ba0ef2.js";let S={SystemPictureList:(e,t)=>g._post("/admin/file.image/list",e,t),PictureIndex:(e,t)=>g._post("/admin/file.image/index",e,t),deleteFiles:(e,t)=>g._post("/admin/file.image/deleteFiles",e,t),addCategory:(e,t)=>g._post("/admin/file.image/addCategory",e,t),editCategory:(e,t)=>g._post("/admin/file.image/edit",e,t),deleteCategory:(e,t)=>g._post("/admin/file.image/delete",e,t),uploadFile:(e,t)=>g._upload("/admin/file.upload/image",e,t)};const L={class:"upload-wrap"},z={class:"upload-wrap-inline mb16 clearfix"},I={class:"leval-item flex-1"},P={class:"leval-item upload-btn"},V={class:"fileContainer"},D={class:"file-type"},U=["onClick"],B=["onClick"],q=["onClick"],$={class:"file-content"},E={class:"fileContainerUI clearfix"},N=["onClick"],A={key:0,class:"selectedIcon"},O=["scr"],W={class:"desc"},G=["onClick"],R={class:"pagination-wrap"};const X=p({components:{AddCategoryindex:p({data:()=>({dialogVisible:!0,title:"新增分類",form:{name:"",category_id:0}}),props:["category","fileType"],created(){null!=this.category?(this.form.name=this.category.name,this.form.category_id=this.category.category_id,this.title="編輯分類"):(this.form.name="",this.title="新增分類")},methods:{addCategory:function(){let t=this;S.addCategory({name:t.form.name,groupType:t.fileType}).then((i=>{e({message:"新增成功",type:"success"}),t.handleClose({status:"success"})})).catch((t=>{e.error("新增失敗")}))},editCategory:function(){let t=this,i={name:this.form.name,category_id:this.form.category_id};S.editCategory(i).then((i=>{e({message:"修改成功",type:"success"}),t.handleClose({status:"success"})})).catch((t=>{e.error("修改失敗")}))},submitForm(){this.$refs.form.validate((e=>{if(!e)return!1;this.category&&null!=this.category.category_id?this.editCategory():this.addCategory()}))},handleClose(e){this.dialogVisible=!1,this.$emit("closeCategory",e)}}},[["render",function(e,o,r,n,c,d){const g=t,p=i,C=a,_=l,F=s;return m(),u(F,{title:c.title,modelValue:c.dialogVisible,"onUpdate:modelValue":o[2]||(o[2]=e=>c.dialogVisible=e),width:"30%","before-close":d.handleClose,"append-to-body":!0},{default:h((()=>[y(_,{size:"small",model:c.form,ref:"form","label-width":"100px",class:"demo-ruleForm"},{default:h((()=>[y(p,{label:"分類名稱",prop:"name",rules:[{required:!0,message:"名字不能為空"}]},{default:h((()=>[y(g,{type:"age",modelValue:c.form.name,"onUpdate:modelValue":o[0]||(o[0]=e=>c.form.name=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),y(p,null,{default:h((()=>[y(C,{size:"small",onClick:d.handleClose},{default:h((()=>[f("取消")])),_:1},8,["onClick"]),y(C,{size:"small",type:"primary",onClick:o[1]||(o[1]=e=>d.submitForm())},{default:h((()=>[f("提交")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["title","modelValue","before-close"])}]])},data:()=>({dialogWidth:"910px",activeType:0,category_id:"",typeList:[],imageUrl:null,dialogVisible:!0,fileList:[],addLoading:!1,this_config:{total:1,fileType:"image"},record:0,loading:!0,tableData:[],pageSize:36,totalDataNumber:0,curPage:1,isShowCategory:!1,category:null,fileIds:[],accept:""}),props:["config"],created(){if("[object object]"===Object.prototype.toString.call(this.config).toLowerCase()){for(let e in this.config)this.config[e]&&(this.this_config[e]=this.config[e]);"image"==this.this_config.fileType?this.accept="image/jpeg,image/png,image/jpg":this.accept="video/mp4"}this.getFileCategory(),this.getData()},methods:{getFileCategory(){let e=this,t={page:e.curPage,list_rows:e.pageSize,parentId:e.activeType,fileType:e.this_config.fileType};S.SystemPictureList(t,!0).then((t=>{e.loading=!1,e.fileList=t.data.list.data,e.totalDataNumber=t.data.list.total})).catch((t=>{e.loading=!1}))},getData:function(){let e=this;S.PictureIndex({type:e.this_config.fileType},!0).then((t=>{e.typeList=[{category_id:0,name:"全部"}].concat(t.data.list),e.category_id=e.typeList.category_id})).catch((t=>{e.loading=!1}))},addCategory(){this.isShowCategory=!0,this.category=null},editCategoryFunc(e){this.isShowCategory=!0,this.category=e},closeCategoryFunc(e){null!=e&&(this.getFileCategory(),this.getData()),this.isShowCategory=!1},deleteCategoryFunc(t){o.confirm("此操作將永久刪除該記錄, 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.deleteCategory(t)})).catch((()=>{e({type:"info",message:"已取消刪除"})}))},deleteCategory(t){let i=this;S.deleteCategory({category_id:t}).then((t=>{e({message:"刪除成功",type:"success"}),i.activeType=null,i.getFileCategory(),i.getData()})).catch((t=>{e.error("刪除失敗")}))},selectTypeFunc(e){this.activeType=e,this.curPage=1,this.getFileCategory()},handleCurrentChange(e){this.curPage=e,this.getFileCategory()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getFileCategory()},fileChange(e){},onBeforeUploadImage:e=>!0,UploadImage(t){let i=this;if(null==i.activeType||0==i.activeType)return void e.error("請選擇分類");const a=r.service({lock:!0,text:"檔案上傳中,請等待",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),l=new FormData;l.append("iFile",t.file),l.append("category_id",null==i.activeType?0:i.activeType),l.append("file_type","image"),S.uploadFile(l).then((l=>{a.close(),i.getFileCategory(),t.onSuccess(),e({message:"上傳檔案成功",type:"success"})})).catch((i=>{a.close(),e({message:"本次上傳檔案失敗",type:"warning"}),t.onError()}))},selectFileFunc(e,t){e.selected?(e.selected=!1,this.record--):(e.selected=!0,this.record++),this.fileList[t]=e},deleteFileFunc(t){let i=this,a=null;o.confirm("此操作將永久刪除該記錄, 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{a=r.service({lock:!0,text:"正在刪除",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});let l=[];if(t)l.push(t.category_id);else for(let e=0;e<i.fileList.length;e++){let t=i.fileList[e];t.selected&&l.push(t.category_id)}if(0==l.length)return a.close(),void e({message:"請選擇檔案",type:"warning"});S.deleteFiles({imageIds:l.join(",")},!0).then((t=>{a.close(),e({message:"刪除成功",type:"success"}),i.getFileCategory()})).catch((e=>{a&&a.close()}))})).catch((()=>{a&&a.close(),e({message:"刪除失敗",type:"warning"})}))},confirmFunc(){let e=[],t=0;for(let i=0;i<this.fileList.length;i++){let a=this.fileList[i];if(a.selected){let i={fileId:a.fileId,filePath:a.filePath};e.push(i),t++}if(t>this.this_config.total)break}this.$emit("returnImgs",e)},cancelFunc(){this.$emit("returnImgs",null)}}},[["render",function(e,t,i,l,s,o){const r=a,g=n,p=j("Edit"),S=d,X=j("Delete"),H=j("Check"),J=c,K=j("AddCategoryindex");return m(),C("div",L,[_("div",z,[_("div",I,[y(r,{icon:"Plus",onClick:o.addCategory},{default:h((()=>[f("新增分類")])),_:1},8,["onClick"]),y(r,{type:"danger",icon:"Delete",onClick:t[0]||(t[0]=e=>o.deleteFileFunc(!1))},{default:h((()=>[f("批次刪除")])),_:1})]),_("div",P,[y(g,{class:"avatar-uploader",multiple:"",ref:"upload",action:"string",accept:s.accept,"before-upload":o.onBeforeUploadImage,"http-request":o.UploadImage,"show-file-list":!1,"on-change":o.fileChange},{default:h((()=>[y(r,{icon:"Upload",type:"primary"},{default:h((()=>[f("點選上傳")])),_:1})])),_:1},8,["accept","before-upload","http-request","on-change"])])]),_("div",V,[_("div",D,[_("ul",null,[(m(!0),C(F,null,v(s.typeList,((e,i)=>(m(),C("li",{class:k(s.activeType==e.category_id?"item active":"item"),key:i,onClick:t=>o.selectTypeFunc(e.category_id)},[f(T(e.name)+" ",1),null!=e.category_id?(m(),C("div",{key:0,class:"operation",onClick:t[1]||(t[1]=w((()=>{}),["stop"]))},[_("p",{onClick:t=>o.editCategoryFunc(e)},[y(S,null,{default:h((()=>[y(p)])),_:1})],8,B),_("p",{onClick:t=>o.deleteCategoryFunc(e.category_id)},[y(S,null,{default:h((()=>[y(X)])),_:1})],8,q)])):b("",!0)],10,U)))),128))])]),_("div",$,[_("ul",E,[(m(!0),C(F,null,v(s.fileList,((e,i)=>(m(),C("li",{class:"file",key:i,onClick:t=>o.selectFileFunc(e,i)},[1==e.selected?(m(),C("div",A,[y(S,null,{default:h((()=>[y(H)])),_:1})])):b("",!0),"image"==s.this_config.fileType?(m(),C("img",{key:1,scr:e.image,style:x("background-image:url("+e.image+")"),alt:""},null,12,O)):b("",!0),_("p",W,T(e.name),1),_("div",{class:"bottom-shade",onClick:t[2]||(t[2]=w((()=>{}),["stop"]))},[_("a",{href:"javascript:void(0)",onClick:t=>o.deleteFileFunc(e)},[y(S,null,{default:h((()=>[y(X)])),_:1})],8,G)])],8,N)))),128))])])]),_("div",R,[y(J,{onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange,"current-page":s.curPage,"page-sizes":[12,24,36,42,48],"page-size":s.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:s.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),s.isShowCategory?(m(),u(K,{key:0,category:s.category,fileType:s.this_config.fileType,onCloseCategory:o.closeCategoryFunc},null,8,["category","fileType","onCloseCategory"])):b("",!0)])}]]);export{X as default};
