import{_ as e}from"./Specs-58a287cd.js";import{E as l,f as t,d as s,l as i,k as a,i as o,e as r}from"./element-plus-84a27f94.js";import{_ as c}from"./index-5ae5860a.js";import{P as d}from"./Product-14aa5af4.js";import{m as p}from"./table-d3149ce0.js";import{ae as u,o as n,c as m,P as _,S as h,W as k,a as f,X as b,Y as w,T as y,M as V,bb as j,b9 as x}from"./@vue-8fe4574d.js";import"./product-6ff3546d.js";import"./@vueuse-3cd91d51.js";import"./lodash-es-656e9c2f.js";import"./async-validator-cf877c1f.js";import"./dayjs-9faf8871.js";import"./call-bind-0c463fe3.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-06559b09.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-49f0fa2f.js";import"./pinia-265da389.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-b80b041e.js";import"./side-channel-ba7aab8a.js";import"./object-inspect-860361a9.js";import"./vue-clipboard2-f8268db2.js";import"./clipboard-dd0324d2.js";import"./vue-ueditor-wrap-dff311b3.js";const v={components:{Product:d,Specs:e},data(){return{isproduct:!1,excludeIds:[],isspecs:!1,curProduct:{},curIndex:-1,specType:!1,SpecExcludeIds:[],all_seckill_price:null,all_seckill_stock:null,all_limit_num:null,rulesProduct:[{validator:(e,l,t)=>{if(l.length<1)return t(new Error("請選擇商品"));{let e=!1;for(let l=0;l<this.form.tableData.length;l++){let t=this.form.tableData[l];if(!e){let l=""==t.seckill_price||""==t.seckill_stock||""==t.limit_num||""==t.sort,s=0==parseFloat(t.seckill_price)||parseInt(t.seckill_stock)<1||parseInt(t.limit_num)<1||20==t.spec_type&&!t.spec_name;(l||s)&&(e=!0)}parseInt(t.seckill_stock)>0?t.stockValid=!0:t.stockValid=!1,parseInt(t.seckill_price)>0?t.priceValid=!0:t.priceValid=!1,parseInt(t.limit_num)>0?t.limit_numValid=!0:t.limit_numValid=!1,parseInt(t.sort)>0?t.sortValid=!0:t.sortValid=!1,this.form.tableData[l]=t}if(e)return t(new Error("請填寫正確的資訊"));t()}},required:!0,trigger:"blur"}]}},props:{form:Object,type:String},created(){},methods:{changeProduct(e){let l=[];e.forEach((e=>{l.push(e.product_id)})),this.excludeIds=l,this.isproduct=!0},closeDialogFunc(e){let l=this;if(l.isproduct=!1,e&&"success"==e.type){let t=[];for(let l=0;l<e.params.length;l++){let s=e.params[l],i={product_name:s.product_name,product_id:s.product_id,product_price:s.product_price,stock_num:s.product_stock,product_sku_id:s.product_sku.product_sku_id,sales_num:0,spec_type:s.spec_type,seckill_price:null,seckill_stock:0,limit_num:1,sort:100,tempProduct:!0,is_delete:0,seckill_product_id:0,seckill_product_sku_id:0,sales_initial:0};t.push(i)}l.form.tableData=l.form.tableData.concat(t),l.form.tableData=p(this.form.tableData)}},specsFunc(e,l,t){this.curProduct=l,this.curIndex=e;let s=[];t?(this.specType=!0,this.form.tableData.forEach((e=>{this.curProduct.product_id==e.product_id&&s.push(e.product_sku_id)}))):this.specType=!1,this.SpecExcludeIds=s,this.isspecs=!0},closeSpecs(e){if(this.isspecs=!1,e&&"success"==e.type){let l=[];for(let s=0;s<e.params.length;s++){let t=e.params[s],i={product_name:this.curProduct.product_name,product_id:this.curProduct.product_id,spec_type:this.curProduct.spec_type,product_sku_id:this.curProduct.product_sku_id,seckill_product_id:this.curProduct.seckill_product_id,product_price:t.spec_form.product_price,stock_num:t.product_stock,sales_num:0,spec_name:t.spec_name,product_sku_id:t.product_sku_id,seckill_price:null,seckill_stock:0,limit_num:1,sort:100,tempProduct:!0,is_delete:0,seckill_product_sku_id:0,sales_initial:0};l.push(i)}let t=[this.curIndex,this.specType?0:1].concat(l);this.form.tableData.splice(...t),this.form.tableData=p(this.form.tableData)}},deleteClick(e,t){let s=this.form.tableData[e];if(s.join_num>0)l({message:"此商品有人參加活動，無法刪除！",type:"warning"});else{if(t){for(let e=0;e<this.form.tableData.length;e++){let t=this.form.tableData[e];if(s.product_id==t.product_id&&t.sales_num>0)return void l({message:"已售商品不能刪除！",type:"warning"})}for(let l=0;l<this.form.tableData.length;l++){let t=this.form.tableData[l];if(s.product_id==t.product_id){if("edit"==this.type&&1!=e.tempProduct){let e=t.seckill_product_id;this.form.product_del_ids.push(e)}this.form.tableData.splice(l,1),l--}}}else{if(parseInt(e.sales_num)>0)return void l({message:"已售商品規格不能刪除！",type:"warning"});let t=0;for(let e=0;e<this.form.tableData.length;e++){let l=this.form.tableData[e];if(s.product_id==l.product_id&&(t++,t>1))break}t>1?this.form.tableData.splice(e,1):s.spec_name=null}this.form.tableData=p(this.form.tableData)}},objectSpanMethod({row:e,column:l,rowIndex:t,columnIndex:s}){if(0===s||6===s||7===s||8===s||9===s)return null!=e.rowSpan?{rowspan:e.rowSpan,colspan:1}:{rowspan:0,colspan:0}},allApply(){this.form.tableData.forEach((e=>{parseInt(this.all_seckill_price)&&parseInt(this.all_seckill_price)>0&&(e.seckill_price=this.all_seckill_price),parseInt(this.all_seckill_stock)&&parseInt(this.all_seckill_stock)>0&&(e.seckill_stock=this.all_seckill_stock),parseInt(this.all_limit_num)&&parseInt(this.all_limit_num)>0&&(e.limit_num=this.all_limit_num)}))},showFunc(e,l){0===l.is_delete?l.is_delete=1:l.is_delete=0}}},I=e=>(j("data-v-87d66d75"),e=e(),x(),e),D=I((()=>f("div",{class:"common-form"},"活動商品",-1))),g={class:"d-s-c pt16 max-w460 active-all-set"},C=I((()=>f("div",{style:{width:"60px"}},"批次設定：",-1))),P={class:"flex-1"},S={class:"flex-1 ml10"},U={class:"flex-1 ml10"},z={class:"ml10"},E={class:"pt16"},F={class:"text-ellipsis-2"},T={key:0,class:"gray"},$={key:1},M={key:0,class:"spec-min-box"},A=["title"];const q=c(v,[["render",function(l,c,d,p,j,x){const v=t,I=s,q=i,B=u("CloseBold"),J=a,L=u("CaretRight"),O=o,R=r,W=u("Product",!0),X=e;return n(),m("div",null,[D,_(R,{label:"商品管理",prop:"tableData",rules:j.rulesProduct},{default:h((()=>[_(v,{icon:"Plus",onClick:c[0]||(c[0]=e=>x.changeProduct(d.form.tableData))},{default:h((()=>[k("選擇商品")])),_:1}),f("div",g,[C,f("div",P,[_(I,{modelValue:j.all_seckill_price,"onUpdate:modelValue":c[1]||(c[1]=e=>j.all_seckill_price=e),type:"number",min:"0",placeholder:"秒殺價"},null,8,["modelValue"])]),f("div",S,[_(I,{modelValue:j.all_seckill_stock,"onUpdate:modelValue":c[2]||(c[2]=e=>j.all_seckill_stock=e),type:"number",min:"0",placeholder:"秒殺庫存"},null,8,["modelValue"])]),f("div",U,[_(I,{modelValue:j.all_limit_num,"onUpdate:modelValue":c[3]||(c[3]=e=>j.all_limit_num=e),type:"number",min:"0",placeholder:"限購數量"},null,8,["modelValue"])]),f("div",z,[_(v,{onClick:x.allApply},{default:h((()=>[k("應用")])),_:1},8,["onClick"])])]),f("div",E,[_(O,{size:"small",data:d.form.tableData,"span-method":x.objectSpanMethod,border:"",style:{width:"100%"}},{default:h((()=>[_(q,{label:"商品名稱",width:"300"},{default:h((e=>[f("p",F,b(e.row.product_name),1)])),_:1}),_(q,{label:"規格",width:"180"},{default:h((e=>[10==e.row.spec_type?(n(),m("div",T,"暫無規格")):w("",!0),20==e.row.spec_type?(n(),m("div",$,[null!=e.row.spec_name&&""!=e.row.spec_name?(n(),m("div",M,[f("p",{class:"text-ellipsis",title:e.row.spec_name},b(e.row.spec_name),9,A),_(J,{class:"el-icon-close",onClick:l=>x.deleteClick(e.$index)},{default:h((()=>[_(B)])),_:2},1032,["onClick"]),_(J,{class:"el-icon-caret-right",onClick:l=>x.specsFunc(e.$index,e.row,!0)},{default:h((()=>[_(L)])),_:2},1032,["onClick"])])):(n(),y(v,{key:1,size:"small",icon:"Plus",onClick:l=>x.specsFunc(e.$index,e.row)},{default:h((()=>[k("新增規格")])),_:2},1032,["onClick"]))])):w("",!0)])),_:1}),_(q,{prop:"product_price",label:"售價"}),_(q,{label:"秒殺價"},{default:h((e=>[_(I,{size:"small",class:V({isvalid:1==e.row.priceValid}),type:"number",min:"0",step:"0.01",modelValue:e.row.seckill_price,"onUpdate:modelValue":l=>e.row.seckill_price=l},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(q,{label:"秒殺庫存"},{default:h((e=>[_(I,{size:"small",class:V({isvalid:1==e.row.stockValid}),type:"number",min:"0",modelValue:e.row.seckill_stock,"onUpdate:modelValue":l=>e.row.seckill_stock=l},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(q,{prop:"sales_num",label:"已售"}),_(q,{label:"限購數量"},{default:h((e=>[_(I,{size:"small",class:V({isvalid:1==e.row.limit_numValid}),type:"number",min:"1",modelValue:e.row.limit_num,"onUpdate:modelValue":l=>e.row.limit_num=l},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(q,{label:"虛擬銷量"},{default:h((e=>[_(I,{size:"small",class:V({isvalid:1==e.row.sortValid}),type:"number",min:"0",modelValue:e.row.sales_initial,"onUpdate:modelValue":l=>e.row.sales_initial=l},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(q,{label:"排序"},{default:h((e=>[_(I,{size:"small",class:V({isvalid:1==e.row.sortValid}),type:"number",min:"0",modelValue:e.row.sort,"onUpdate:modelValue":l=>e.row.sort=l},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(q,{fixed:"right",label:"操作",width:"edit"==d.type?140:60},{default:h((e=>["edit"==d.type?(n(),y(v,{key:0,onClick:l=>x.showFunc(e.$index,e.row),type:"text",size:"small"},{default:h((()=>[k(b(0==e.row.is_delete?"隱藏":"顯示"),1)])),_:2},1032,["onClick"])):w("",!0),_(v,{onClick:l=>x.deleteClick(e.$index,!0),type:"text",size:"small"},{default:h((()=>[k("刪除")])),_:2},1032,["onClick"])])),_:1},8,["width"])])),_:1},8,["data","span-method"])])])),_:1},8,["rules"]),_(W,{isproduct:j.isproduct,excludeIds:j.excludeIds,islist:!0,onCloseDialog:x.closeDialogFunc},null,8,["isproduct","excludeIds","onCloseDialog"]),_(X,{isspecs:j.isspecs,productId:j.curProduct.product_id,excludeIds:j.SpecExcludeIds,islist:!0,onClose:x.closeSpecs},null,8,["isspecs","productId","excludeIds","onClose"])])}],["__scopeId","data-v-87d66d75"]]);export{q as default};
