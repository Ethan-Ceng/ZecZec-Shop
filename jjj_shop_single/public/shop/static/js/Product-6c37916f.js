import{_ as e}from"./Specs-58a287cd.js";import{E as a,f as l,d as t,l as s,k as i,i as r,e as o}from"./element-plus-84a27f94.js";import{_ as d}from"./index-5ae5860a.js";import{P as c}from"./Product-14aa5af4.js";import{m as n}from"./table-d3149ce0.js";import{ae as u,o as p,c as m,P as _,S as b,W as h,a as f,X as g,Y as k,T as w,M as V,bb as y,b9 as j}from"./@vue-8fe4574d.js";import"./product-6ff3546d.js";import"./@vueuse-3cd91d51.js";import"./lodash-es-656e9c2f.js";import"./async-validator-cf877c1f.js";import"./dayjs-9faf8871.js";import"./call-bind-0c463fe3.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-06559b09.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-49f0fa2f.js";import"./pinia-265da389.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-b80b041e.js";import"./side-channel-ba7aab8a.js";import"./object-inspect-860361a9.js";import"./vue-clipboard2-f8268db2.js";import"./clipboard-dd0324d2.js";import"./vue-ueditor-wrap-dff311b3.js";const x={components:{Product:c,Specs:e},data(){return{isproduct:!1,excludeIds:[],isspecs:!1,curProduct:{},curIndex:-1,specType:!1,SpecExcludeIds:[],all_bargain_price:null,all_bargain_stock:null,all_limit_num:null,all_bargain_num:null,rulesProduct:[{validator:(e,a,l)=>{if(a.length<1)return l(new Error("請選擇商品"));{let e=!1;for(let a=0;a<this.form.tableData.length;a++){let l=this.form.tableData[a];if(!e){let a=""==l.bargain_price||""==l.bargain_stock||""==l.limit_num||""==l.sort,t=0==parseFloat(l.bargain_price)||parseInt(l.bargain_stock)<1||parseInt(l.limit_num)<1||20==l.spec_type&&!l.spec_name;(a||t)&&(e=!0)}parseInt(l.bargain_stock)>0?l.stockValid=!0:l.stockValid=!1,parseInt(l.bargain_price)>0?l.priceValid=!0:l.priceValid=!1,parseInt(l.limit_num)>0?l.limit_numValid=!0:l.limit_numValid=!1,parseInt(l.sort)>0?l.sortValid=!0:l.sortValid=!1,this.form.tableData[a]=l}if(e)return l(new Error("請填寫正確的資訊"));l()}},required:!0,trigger:"blur"}]}},inject:["form","type"],created(){},methods:{changeProduct(e){let a=[];e.forEach((e=>{a.push(e.product_id)})),this.excludeIds=a,this.isproduct=!0},closeDialogFunc(e){let a=this;if(a.isproduct=!1,e&&"success"==e.type){let l=[];for(let a=0;a<e.params.length;a++){let t=e.params[a],s={product_name:t.product_name,product_id:t.product_id,product_price:t.product_price,stock_num:t.product_stock,product_sku_id:t.product_sku.product_sku_id,sales_num:0,spec_type:t.spec_type,bargain_price:null,bargain_stock:0,limit_num:1,sort:100,tempProduct:!0,is_delete:0,bargain_num:0,bargain_product_id:0,bargain_product_sku_id:0,sales_initial:0};l.push(s)}a.form.tableData=a.form.tableData.concat(l),a.form.tableData=n(this.form.tableData)}},specsFunc(e,a,l){this.curProduct=a,this.curIndex=e;let t=[];l?(this.specType=!0,this.form.tableData.forEach((e=>{this.curProduct.product_id==e.product_id&&t.push(e.product_sku_id)}))):this.specType=!1,this.SpecExcludeIds=t,this.isspecs=!0},closeSpecs(e){if(this.isspecs=!1,e&&"success"==e.type){let a=[];for(let t=0;t<e.params.length;t++){let l=e.params[t],s={product_name:this.curProduct.product_name,product_id:this.curProduct.product_id,product_price:l.spec_form.product_price,spec_type:this.curProduct.spec_type,product_sku_id:this.curProduct.product_sku_id,bargain_product_id:this.curProduct.bargain_product_id,stock_num:l.product_stock,sales_num:0,spec_name:l.spec_name,product_sku_id:l.product_sku_id,bargain_price:null,bargain_stock:0,limit_num:1,sort:100,tempProduct:!0,is_delete:0,bargain_num:0,bargain_product_sku_id:0,sales_initial:0};a.push(s)}let l=[this.curIndex,this.specType?0:1].concat(a);this.form.tableData.splice(...l),this.form.tableData=n(this.form.tableData)}},deleteClick(e,l){let t=this.form.tableData[e];if(t.join_num>0)a({message:"此商品有人參加活動，無法刪除！",type:"warning"});else{if(l){for(let e=0;e<this.form.tableData.length;e++){let l=this.form.tableData[e];if(t.product_id==l.product_id&&l.sales_num>0)return void a({message:"已售商品不能刪除！",type:"warning"})}for(let a=0;a<this.form.tableData.length;a++){let l=this.form.tableData[a];if(t.product_id==l.product_id){if("edit"==this.type&&1!=e.tempProduct){let e=l.bargain_product_id;this.form.product_del_ids.push(e)}this.form.tableData.splice(a,1),a--}}}else{if(parseInt(e.sales_num)>0)return void a({message:"已售商品規格不能刪除！",type:"warning"});let l=0;for(let e=0;e<this.form.tableData.length;e++){let a=this.form.tableData[e];if(t.product_id==a.product_id&&(l++,l>1))break}l>1?this.form.tableData.splice(e,1):t.spec_name=null}this.form.tableData=n(this.form.tableData)}},objectSpanMethod({row:e,column:a,rowIndex:l,columnIndex:t}){if(0===t||6===t||7===t||8===t||9===t)return null!=e.rowSpan?{rowspan:e.rowSpan,colspan:1}:{rowspan:0,colspan:0}},allApply(){for(let e=0;e<this.form.tableData.length;e++){let a=this.form.tableData[e];null==a.bargain_price&&(parseInt(this.all_bargain_price)>parseInt(a.product_price)?a.bargain_price=a.product_price:a.bargain_price=this.all_bargain_price),a.bargain_stock=a.bargain_stock<=1?this.all_bargain_stock:a.bargain_stock,a.limit_num=a.limit_num<=1?this.all_limit_num:a.limit_num,a.bargain_num=a.bargain_num<=1?this.all_bargain_num:a.bargain_num}},showFunc(e,a){0===a.is_delete?a.is_delete=1:a.is_delete=0}}},v=e=>(y("data-v-b3a51832"),e=e(),j(),e),D=v((()=>f("div",{class:"common-form"},"活動商品",-1))),I={class:"d-s-c pt16 max-w460 active-all-set"},C=v((()=>f("div",{style:{width:"60px"}},"批次設定：",-1))),P={class:"flex-1"},U={class:"flex-1 ml10"},z={class:"flex-1 ml10"},S={class:"flex-1 ml10"},E={class:"ml10"},F={class:"pt16"},T={class:"text-ellipsis-2"},$={key:0,class:"gray"},M={key:1},A={key:0,class:"spec-min-box"},q=["title"];const B=d(x,[["render",function(a,d,c,n,y,j){const x=l,v=t,B=s,J=u("CloseBold"),L=i,R=u("CaretRight"),W=r,X=o,Y=u("Product",!0),G=e;return p(),m("div",null,[D,_(X,{label:"商品管理",prop:"tableData",rules:y.rulesProduct},{default:b((()=>[_(x,{icon:"Plus",onClick:d[0]||(d[0]=e=>j.changeProduct(j.form.tableData))},{default:b((()=>[h("選擇商品")])),_:1}),f("div",I,[C,f("div",P,[_(v,{modelValue:y.all_bargain_price,"onUpdate:modelValue":d[1]||(d[1]=e=>y.all_bargain_price=e),type:"number",min:"0",placeholder:"砍到底價"},null,8,["modelValue"])]),f("div",U,[_(v,{modelValue:y.all_bargain_stock,"onUpdate:modelValue":d[2]||(d[2]=e=>y.all_bargain_stock=e),type:"number",min:"0",placeholder:"活動庫存"},null,8,["modelValue"])]),f("div",z,[_(v,{modelValue:y.all_bargain_num,"onUpdate:modelValue":d[3]||(d[3]=e=>y.all_bargain_num=e),type:"number",min:"0",placeholder:"砍價人數"},null,8,["modelValue"])]),f("div",S,[_(v,{modelValue:y.all_limit_num,"onUpdate:modelValue":d[4]||(d[4]=e=>y.all_limit_num=e),type:"number",min:"0",placeholder:"限購數量"},null,8,["modelValue"])]),f("div",E,[_(x,{onClick:j.allApply},{default:b((()=>[h("應用")])),_:1},8,["onClick"])])]),f("div",F,[_(W,{size:"small",data:j.form.tableData,"span-method":j.objectSpanMethod,border:"",style:{width:"100%"}},{default:b((()=>[_(B,{label:"商品名稱",width:"300"},{default:b((e=>[f("p",T,g(e.row.product_name),1)])),_:1}),_(B,{label:"規格",width:"180"},{default:b((e=>[10==e.row.spec_type?(p(),m("div",$,"暫無規格")):k("",!0),20==e.row.spec_type?(p(),m("div",M,[null!=e.row.spec_name&&""!=e.row.spec_name?(p(),m("div",A,[f("p",{class:"text-ellipsis",title:e.row.spec_name},g(e.row.spec_name),9,q),_(L,{class:"el-icon-close",onClick:a=>j.deleteClick(e.$index)},{default:b((()=>[_(J)])),_:2},1032,["onClick"]),_(L,{class:"el-icon-caret-right",onClick:a=>j.specsFunc(e.$index,e.row,!0)},{default:b((()=>[_(R)])),_:2},1032,["onClick"])])):(p(),w(x,{key:1,size:"small",icon:"Plus",onClick:a=>j.specsFunc(e.$index,e.row)},{default:b((()=>[h("新增規格")])),_:2},1032,["onClick"]))])):k("",!0)])),_:1}),_(B,{prop:"product_price",label:"售價"}),_(B,{label:"砍到底價"},{default:b((e=>[_(v,{size:"small",class:V({isvalid:1==e.row.priceValid}),type:"number",min:"0",step:"0.01",modelValue:e.row.bargain_price,"onUpdate:modelValue":a=>e.row.bargain_price=a},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(B,{label:"活動庫存"},{default:b((e=>[_(v,{size:"small",class:V({isvalid:1==e.row.stockValid}),type:"number",min:"0",modelValue:e.row.bargain_stock,"onUpdate:modelValue":a=>e.row.bargain_stock=a},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(B,{prop:"sales_num",label:"已售"}),_(B,{label:"砍價人數"},{default:b((e=>[_(v,{size:"small",class:V({isvalid:1==e.row.bargain_numValid}),type:"number",min:"0",modelValue:e.row.bargain_num,"onUpdate:modelValue":a=>e.row.bargain_num=a},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(B,{label:"限購數量"},{default:b((e=>[_(v,{size:"small",class:V({isvalid:1==e.row.limit_numValid}),type:"number",min:"1",modelValue:e.row.limit_num,"onUpdate:modelValue":a=>e.row.limit_num=a},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(B,{label:"虛擬銷量"},{default:b((e=>[_(v,{size:"small",class:V({isvalid:1==e.row.sortValid}),type:"number",min:"0",modelValue:e.row.sales_initial,"onUpdate:modelValue":a=>e.row.sales_initial=a},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(B,{label:"排序"},{default:b((e=>[_(v,{size:"small",class:V({isvalid:1==e.row.sortValid}),type:"number",min:"0",modelValue:e.row.sort,"onUpdate:modelValue":a=>e.row.sort=a},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(B,{fixed:"right",label:"操作",width:"edit"==j.type?140:60},{default:b((e=>["edit"==j.type?(p(),w(x,{key:0,onClick:a=>j.showFunc(e.$index,e.row),type:"text",size:"small"},{default:b((()=>[h(g(0==e.row.is_delete?"隱藏":"顯示"),1)])),_:2},1032,["onClick"])):k("",!0),_(x,{onClick:a=>j.deleteClick(e.$index,!0),type:"text",size:"small"},{default:b((()=>[h("刪除")])),_:2},1032,["onClick"])])),_:1},8,["width"])])),_:1},8,["data","span-method"])])])),_:1},8,["rules"]),_(Y,{isproduct:y.isproduct,excludeIds:y.excludeIds,islist:!0,onCloseDialog:j.closeDialogFunc},null,8,["isproduct","excludeIds","onCloseDialog"]),_(G,{isspecs:y.isspecs,productId:y.curProduct.product_id,excludeIds:y.SpecExcludeIds,islist:!0,onClose:j.closeSpecs},null,8,["isspecs","productId","excludeIds","onClose"])])}],["__scopeId","data-v-b3a51832"]]);export{B as default};
