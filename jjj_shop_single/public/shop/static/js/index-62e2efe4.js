import{a as e,E as a,u as t,d as r,e as l,s as o,t as s,J as i,f as d,c as n,x as c,y as u,K as p,l as _,i as m,p as y,L as v,w as g,q as h,v as w}from"./element-plus-84a27f94.js";import{O as k}from"./order-10f620ac.js";import"./qs-b80b041e.js";import f from"./cancel-b3cc37fe.js";import{_ as x}from"./index-5ae5860a.js";import{L as b}from"./viewLogistics-484ccb9e.js";import{ae as C,ap as D,o as j,c as z,a as L,P as V,S as F,Q as S,a9 as U,T as B,W as E,$ as N,M as I,X as P,Y as M}from"./@vue-8fe4574d.js";import"./@vueuse-3cd91d51.js";import"./lodash-es-656e9c2f.js";import"./async-validator-cf877c1f.js";import"./dayjs-9faf8871.js";import"./call-bind-0c463fe3.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-06559b09.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./side-channel-ba7aab8a.js";import"./object-inspect-860361a9.js";import"./vuedraggable-54f344de.js";import"./vue-a056b7b7.js";import"./sortablejs-88eb33dd.js";import"./vue-router-49f0fa2f.js";import"./pinia-265da389.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./vue-clipboard2-f8268db2.js";import"./clipboard-dd0324d2.js";import"./vue-ueditor-wrap-dff311b3.js";const q={components:{Cancel:f,Logistics:b},data:()=>({activeName:"all",loading:!0,tableData:[],pageSize:20,totalDataNumber:0,curPage:1,searchForm:{order_no:"",search:"",style_id:"",store_id:"",create_time:""},exStyle:[],shopList:[],create_time:"",order_count:{payment:0,delivery:0,received:0,cancel:0,canceled:0},dialogBatchDelivery:!1,open_edit:!1,order_no:0,is_send_wx:"",isLogistics:!1,logisticsData:{}}),created(){this.getData()},methods:{arraySpanMethod(e){if(e.rowIndex%2==0&&0===e.columnIndex)return[1,8]},handleCurrentChange(e){this.curPage=e,this.getData()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getData()},handleClick(e,a){let t=this;t.curPage=1,t.activeName=e,t.getData()},getData(){let e=this,a=this.searchForm;a.dataType=e.activeName,a.page=e.curPage,a.list_rows=e.pageSize,e.loading=!0,k.orderlist(a,!0).then((a=>{let t=[];for(let e=0;e<a.data.list.data.length;e++){let r=a.data.list.data[e],l={order_no:r.order_no,create_time:r.create_time,order_source:r.order_source,order_source_text:r.order_source_text,is_top_row:!0,order_status_value:r.order_status.value};t.push(l),t.push(r)}e.tableData.data=t,e.totalDataNumber=a.data.list.total,e.exStyle=a.data.ex_style,e.shopList=a.data.shop_list,e.order_count=a.data.order_count.order_count,e.is_send_wx=a.data.is_send_wx,e.loading=!1})).catch((e=>{}))},cancelClick(e){this.order_no=e.order_no,this.open_edit=!0},closeDialogFunc(e,a){"edit"==a&&(this.open_edit=e.openDialog,"success"==e.type&&this.getData())},addClick(e){let a=e.order_id;this.$router.push({path:"/order/order/Detail",query:{order_id:a}})},getLogistics(e){let a=this,t={order_id:e.order_id,express_id:e.express_id,express_no:e.express_no};a.loading=!0,k.orderExpress(t,!0).then((e=>{a.loading=!1,a.logisticsData=e.data.express.list,a.openLogistics()})).catch((e=>{a.loading=!1}))},openLogistics(){this.isLogistics=!0},closeLogistics(){this.isLogistics=!1},onSubmit(){this.curPage=1,this.tableData=[],this.getData()},onExport:function(){let e=this.searchForm;this.$filter.onExportFunc("/index.php/shop/order.operate/export",e)},showBatchDelivery(){this.dialogBatchDelivery=!0},gotoExpress(){this.$router.push("/setting/express/index")},wxdeliveryClick(t){let r=this,l=t.order_id;e.confirm("確定發貨嗎?","提示",{type:"warning"}).then((()=>{k.wxDelivery({order_id:l},!0).then((e=>{r.loading=!1,a({message:"恭喜你，操作成功",type:"success"}),r.getData()})).catch((e=>{r.loading=!1}))})).catch((()=>{a({type:"info",message:"已取消發貨"})}))},onBeforeUploadImage(e){const t="xlsx"===e.name.substring(e.name.lastIndexOf(".")+1),r=e.size/1024/1024<10;return t||a.error("上傳檔案只能是excel格式!"),r||a.error("上傳檔案大小不能超過 10MB!"),t&&r},UploadImage(e){let r=this;const l=t.service({lock:!0,text:"正在處理,請等待",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),o=new FormData;o.append("iFile",e.file),k.batchDelivery(o).then((e=>{l.close(),r.dialogBatchDelivery=!1,a({message:e.msg,type:"warning"})})).catch((t=>{l.close(),a({message:"本次處理失敗",type:"warning"}),e.onError()}))}}},Y={class:"user"},T={class:"common-seach-wrap"},$={class:"block"},O=L("span",{class:"demonstration"},null,-1),A={class:"product-content"},J={class:"table-wrap"},K={key:0,class:"order-code"},Q={class:"c_main"},W={class:"pl16"},X={key:0,class:"pl16"},G={class:"pic"},H={alt:""},R={class:"info"},Z={class:"name gray3 product-name"},ee={key:0,class:"red"},ae={key:0,class:"gray9"},te={key:1,class:"orange"},re={class:"d-c-c d-c"},le={class:"orange"},oe={class:"gray3"},se={key:0},ie={key:0,class:"orange"},de={key:1,class:"orange"},ne={key:2,class:"orange"},ce={class:"gray9"},ue={key:0},pe={class:"gray9"},_e={key:0},me={key:0},ye={key:0},ve={key:0,class:"red"},ge={key:1,class:"gray9"},he={key:1},we={class:"gray9"},ke={key:0},fe={class:"green"},xe={key:0},be={key:0},Ce={key:0},De={key:1},je={key:0},ze={class:"pagination"},Le=L("div",null,"1、先按未發貨條件篩選後，匯出訂單",-1),Ve=L("div",null,"2、在匯出excel中填寫物流公司、物流單號，然後點批次發貨匯入填好的excel檔案",-1),Fe={style:{"padding-top":"20px","padding-bottom":"20px","text-align":"center"}};const Se=x(q,[["render",function(e,a,t,k,f,x){const b=r,q=l,Se=o,Ue=s,Be=i,Ee=d,Ne=n,Ie=c,Pe=u,Me=p,qe=_,Ye=m,Te=y,$e=C("Logistics"),Oe=v,Ae=g,Je=h,Ke=C("Cancel"),Qe=D("auth"),We=D("img-url"),Xe=w;return j(),z("div",Y,[L("div",T,[V(Ne,{size:"small",inline:!0,model:f.searchForm,class:"demo-form-inline"},{default:F((()=>[V(q,{label:"訂單號"},{default:F((()=>[V(b,{size:"small",modelValue:f.searchForm.order_no,"onUpdate:modelValue":a[0]||(a[0]=e=>f.searchForm.order_no=e),placeholder:"請輸入訂單號"},null,8,["modelValue"])])),_:1}),V(q,{label:"暱稱/手機號"},{default:F((()=>[V(b,{modelValue:f.searchForm.search,"onUpdate:modelValue":a[1]||(a[1]=e=>f.searchForm.search=e),placeholder:"請輸入暱稱/手機號"},null,8,["modelValue"])])),_:1}),V(q,{label:"配送方式"},{default:F((()=>[V(Ue,{size:"small",modelValue:f.searchForm.style_id,"onUpdate:modelValue":a[2]||(a[2]=e=>f.searchForm.style_id=e),placeholder:"請選擇"},{default:F((()=>[V(Se,{label:"全部",value:""}),(j(!0),z(S,null,U(f.exStyle,((e,a)=>(j(),B(Se,{key:a,label:e.name,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(q,{label:"門店地址"},{default:F((()=>[V(Ue,{size:"small",modelValue:f.searchForm.store_id,"onUpdate:modelValue":a[3]||(a[3]=e=>f.searchForm.store_id=e),placeholder:"請選擇"},{default:F((()=>[V(Se,{label:"全部",value:""}),(j(!0),z(S,null,U(f.shopList,((e,a)=>(j(),B(Se,{key:a,label:e.store_name,value:e.store_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(q,{label:"起始時間"},{default:F((()=>[L("div",$,[O,V(Be,{size:"small",modelValue:f.searchForm.create_time,"onUpdate:modelValue":a[4]||(a[4]=e=>f.searchForm.create_time=e),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"開始日期","end-placeholder":"結束日期"},null,8,["modelValue"])])])),_:1}),V(q,null,{default:F((()=>[V(Ee,{size:"small",type:"primary",icon:"Search",onClick:x.onSubmit},{default:F((()=>[E("查詢")])),_:1},8,["onClick"])])),_:1}),V(q,null,{default:F((()=>[N((j(),B(Ee,{size:"small",type:"success",onClick:x.onExport},{default:F((()=>[E("匯出")])),_:1},8,["onClick"])),[[Qe,"/order/operate/export"]])])),_:1}),V(q,null,{default:F((()=>[N((j(),B(Ee,{size:"small",type:"warning",onClick:x.showBatchDelivery},{default:F((()=>[E("批次發貨")])),_:1},8,["onClick"])),[[Qe,"/order/operate/batchDelivery"]])])),_:1})])),_:1},8,["model"])]),L("div",A,[L("div",J,[V(Pe,{modelValue:f.activeName,"onUpdate:modelValue":a[5]||(a[5]=e=>f.activeName=e),onTabChange:x.handleClick},{default:F((()=>[V(Ie,{label:"全部訂單",name:"all"}),V(Ie,{label:"未付款("+f.order_count.payment+")",name:"payment"},null,8,["label"]),V(Ie,{label:"待發貨("+f.order_count.delivery+")",name:"delivery"},null,8,["label"]),V(Ie,{label:"待收貨("+f.order_count.received+")",name:"received"},null,8,["label"]),V(Ie,{label:"待取消("+f.order_count.cancel+")",name:"cancel"},null,8,["label"]),V(Ie,{label:"已取消("+f.order_count.canceled+")",name:"canceled"},null,8,["label"]),V(Ie,{label:"待評價",name:"comment"}),V(Ie,{label:"已完成",name:"six"})])),_:1},8,["modelValue","onTabChange"]),N((j(),B(Ye,{size:"small",data:f.tableData.data,"span-method":x.arraySpanMethod,border:"",style:{width:"100%"}},{default:F((()=>[V(qe,{prop:"order_no",label:"訂單資訊",width:"400"},{default:F((e=>[e.row.is_top_row?(j(),z("div",K,[L("span",{class:I(["state-text",{"state-text-red":10!=e.row.order_source}])},P(e.row.order_source_text),3),L("span",Q,"訂單號："+P(e.row.order_no),1),L("span",W,"下單時間："+P(e.row.create_time),1),21==e.row.order_status_value?(j(),z("span",X,[V(Me,{effect:"dark",size:"small"},{default:F((()=>[E("取消申請中")])),_:1})])):M("",!0)])):(j(!0),z(S,{key:1},U(e.row.product,((e,a)=>(j(),z("div",{class:"product-info",key:a},[L("div",G,[N(L("img",H,null,512),[[We,e.image.file_path]])]),L("div",R,[L("div",Z,[L("span",null,[E(P(e.product_name)+" ",1),1==e.is_gift?(j(),z("span",ee,"贈品")):M("",!0)])]),e.product_attr?(j(),z("div",ae,P(e.product_attr),1)):M("",!0),e.refund?(j(),z("div",te,P(e.refund.type.text)+"-"+P(e.refund.status.text),1)):M("",!0)]),L("div",re,[L("div",le,"￥ "+P(e.product_price),1),L("div",oe,"x"+P(e.total_num),1)])])))),128))])),_:1}),V(qe,{prop:"pay_price",label:"實付款"},{default:F((e=>[e.row.is_top_row?M("",!0):(j(),z("div",se,[80!=e.row.order_source?(j(),z("div",ie,P(e.row.pay_price),1)):M("",!0),80==e.row.order_source?(j(),z("p",de,"定金："+P(e.row.advance.pay_price),1)):M("",!0),80==e.row.order_source?(j(),z("p",ne,"尾款："+P(e.row.pay_price),1)):M("",!0),L("p",ce,"(含運費："+P(e.row.express_price)+")",1)]))])),_:1}),V(qe,{prop:"",label:"買家"},{default:F((e=>[e.row.is_top_row?M("",!0):(j(),z("div",ue,[L("div",null,P(e.row.user?e.row.user.nickName:"--"),1),L("div",pe,"ID：("+P(e.row.user?e.row.user.user_id:"--")+")",1)]))])),_:1}),V(qe,{prop:"state_text",label:"交易狀態"},{default:F((e=>[e.row.is_top_row?M("",!0):(j(),z("div",_e,P(e.row.state_text),1))])),_:1}),V(qe,{prop:"pay_type.text",label:"支付方式"},{default:F((e=>[e.row.is_top_row?M("",!0):(j(),z("div",me,[20==e.row.pay_status.value?(j(),z("div",ye,[10!=e.row.pay_type.value&&e.row.balance>0?(j(),z("div",ve,[L("div",null,P(e.row.pay_type.text)+"("+P(e.row.online_money)+")",1),L("div",null,"餘額支付("+P(e.row.balance)+")",1)])):(j(),z("div",ge,P(e.row.pay_type.text),1))])):(j(),z("div",he,[L("div",we,P(e.row.pay_type.text),1)]))]))])),_:1}),V(qe,{prop:"delivery_type.text",label:"配送方式"},{default:F((e=>[e.row.is_top_row?M("",!0):(j(),z("div",ke,[L("span",fe,P(e.row.delivery_type.text),1),30==e.row.delivery_type.value?(j(),z("span",xe,"手機號:"+P(e.row.user?e.row.user.mobile:"--"),1)):M("",!0)]))])),_:1}),V(qe,{prop:"is_comment",label:"評價",width:"60"},{default:F((e=>[e.row.is_top_row?M("",!0):(j(),z("div",be,[0==e.row.is_comment?(j(),z("span",Ce,"未評價")):(j(),z("span",De,"已評價"))]))])),_:1}),V(qe,{fixed:"right",label:"操作",width:"210"},{default:F((e=>[e.row.is_top_row?M("",!0):(j(),z("div",je,[N((j(),B(Ee,{onClick:a=>x.addClick(e.row),type:"text",size:"small"},{default:F((()=>[E("詳情 ")])),_:2},1032,["onClick"])),[[Qe,"/order/order/detail"]]),10==e.row.delivery_type.value&&20==e.row.delivery_status.value&&0==e.row.is_single?N((j(),B(Ee,{key:0,onClick:a=>x.getLogistics(e.row),link:"",type:"primary",size:"small"},{default:F((()=>[E("檢視物流 ")])),_:2},1032,["onClick"])),[[Qe,"/order/order/express"]]):M("",!0),20!=e.row.pay_status.value||10!=e.row.delivery_status.value||20==e.row.order_status.value||21==e.row.order_status.value||10!=e.row.delivery_type.value||e.row.assemble_status&&20!=e.row.assemble_status?M("",!0):N((j(),B(Ee,{key:1,onClick:a=>x.addClick(e.row),type:"text",size:"small"},{default:F((()=>[E(" 發貨 ")])),_:2},1032,["onClick"])),[[Qe,"/order/order/delivery"]]),20==e.row.pay_status.value&&10==e.row.delivery_status.value&&20!=e.row.order_status.value&&21!=e.row.order_status.value&&20==e.row.delivery_type.value?N((j(),B(Ee,{key:2,onClick:a=>x.addClick(e.row),type:"text",size:"small"},{default:F((()=>[E(" 核銷 ")])),_:2},1032,["onClick"])),[[Qe,"/order/operate/extract"]]):M("",!0),20==e.row.pay_status.value&&10==e.row.delivery_status.value&&20!=e.row.order_status.value&&21!=e.row.order_status.value&&30==e.row.delivery_type.value?N((j(),B(Ee,{key:3,onClick:a=>x.addClick(e.row),type:"text",size:"small"},{default:F((()=>[E(" 發貨 ")])),_:2},1032,["onClick"])),[[Qe,"/order/order/delivery"]]):M("",!0),20==e.row.pay_status.value&&30==e.row.delivery_status.value&&20!=e.row.order_status.value&&21!=e.row.order_status.value&&1==e.row.is_single?N((j(),B(Ee,{key:4,onClick:a=>x.addClick(e.row),type:"text",size:"small"},{default:F((()=>[E(" 繼續發貨 ")])),_:2},1032,["onClick"])),[[Qe,"/order/order/delivery"]]):M("",!0),20==e.row.pay_status.value&&10==e.row.delivery_status.value&&10==e.row.order_status.value?N((j(),B(Ee,{key:5,onClick:a=>x.cancelClick(e.row),type:"text",size:"small"},{default:F((()=>[E(" 取消 ")])),_:2},1032,["onClick"])),[[Qe,"/order/order/orderCancel"]]):M("",!0),21==e.row.order_status.value?N((j(),B(Ee,{key:6,onClick:a=>x.addClick(e.row),type:"text",size:"small"},{default:F((()=>[E("稽核")])),_:2},1032,["onClick"])),[[Qe,"/order/operate/confirmCancel"]]):M("",!0),20==e.row.pay_type.value&&20==e.row.pay_status.value&&20==e.row.delivery_status.value&&10==e.row.wx_delivery_status&&"wx"==e.row.pay_source&&1==f.is_send_wx?N((j(),B(Ee,{key:7,onClick:a=>x.wxdeliveryClick(e.row),link:"",type:"primary",size:"small"},{default:F((()=>[E("小程式發貨")])),_:2},1032,["onClick"])),[[Qe,"/order/order/wxDelivery"]]):M("",!0)]))])),_:1})])),_:1},8,["data","span-method"])),[[Xe,f.loading]])]),L("div",ze,[V(Te,{onSizeChange:x.handleSizeChange,onCurrentChange:x.handleCurrentChange,background:"","current-page":f.curPage,"page-size":f.pageSize,layout:"total, prev, pager, next, jumper",total:f.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])]),f.isLogistics?(j(),B($e,{key:0,logisticsData:f.logisticsData,isLogistics:f.isLogistics,onCloseDialog:x.closeLogistics},null,8,["logisticsData","isLogistics","onCloseDialog"])):M("",!0),V(Je,{title:"批次發貨說明",modelValue:f.dialogBatchDelivery,"onUpdate:modelValue":a[7]||(a[7]=e=>f.dialogBatchDelivery=e),width:"30%"},{default:F((()=>[Le,Ve,L("div",null,[E("3、請檢查物流公司是否已經新增到系統，"),V(Oe,{type:"primary",underline:!1,onClick:a[6]||(a[6]=e=>x.gotoExpress())},{default:F((()=>[E("檢視")])),_:1})]),L("div",Fe,[V(Ae,{class:"avatar-uploader",ref:"upload",action:"string",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","before-upload":x.onBeforeUploadImage,"http-request":x.UploadImage,"show-file-list":!1},{default:F((()=>[V(Ee,{size:"small",icon:"Upload",type:"primary"},{default:F((()=>[E("上傳發貨表格")])),_:1})])),_:1},8,["before-upload","http-request"])])])),_:1},8,["modelValue"]),f.open_edit?(j(),B(Ke,{key:1,open_edit:f.open_edit,order_no:f.order_no,onCloseDialog:a[8]||(a[8]=e=>x.closeDialogFunc(e,"edit"))},null,8,["open_edit","order_no"])):M("",!0)])}]]);export{Se as default};
