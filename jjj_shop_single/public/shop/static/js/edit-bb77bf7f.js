import{E as e,d as a,e as t,m as i,l as r,i as l,f as o,c as s}from"./element-plus-84a27f94.js";import{S as d}from"./setting-db36ed28.js";import n from"./Area-c7ed214c.js";import{_ as m,d as u}from"./index-5ae5860a.js";import{ae as f,o as p,c,P as h,S as y,a as _,W as v,Q as w,a9 as b,X as g,Y as j,T as k,bb as x,b9 as V}from"./@vue-8fe4574d.js";import"./@vueuse-3cd91d51.js";import"./lodash-es-656e9c2f.js";import"./async-validator-cf877c1f.js";import"./dayjs-9faf8871.js";import"./call-bind-0c463fe3.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-06559b09.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-49f0fa2f.js";import"./pinia-265da389.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-b80b041e.js";import"./side-channel-ba7aab8a.js";import"./object-inspect-860361a9.js";import"./vue-clipboard2-f8268db2.js";import"./clipboard-dd0324d2.js";import"./vue-ueditor-wrap-dff311b3.js";const C={components:{Areas:n},data:()=>({form:{delivery_id:0,method:"10",name:"",sort:1,radio:"10",rule:[]},formRules:{name:[{required:!0,message:" ",trigger:"blur"}]},loading:!1,options:[],optionsMap:{},areaModel:{index:0},show_area:!1,tableHeadName:{first:"首件(個)",first_fee:"運費(元)",additional:"續件(個)",additional_fee:"續費(元)"},cityCount:0,formData:[]}),watch:{"form.radio":function(e,a){this.tableHeadName="10"==e?{first:"首件(個)",first_fee:"運費(元)",additional:"續件(個)",additional_fee:"續費(元)"}:{first:"首重(Kg)",first_fee:"運費(元)",additional:"續重(Kg)",additional_fee:"續費(元)"}},"form.rule":{handler(e,a){},deep:!0}},created(){this.delivery_id=this.$route.query.delivery_id,this.getData()},methods:{getData(){let e=this;d.deliveryDetail({delivery_id:e.delivery_id},!0).then((a=>{if(e.delivery_id>0&&(e.form=a.data.detail,e.form.rule=[],e.form.radio=e.form.method.value.toString(),e.formData=a.data.formData),e.options=a.data.arr,e.cityCount=a.data.cityCount,e.options.forEach((function(a){e.optionsMap[a.value]=a})),!e.formData.length)return!1;e.formData.forEach((function(a){for(var t in a.citys)a.citys.hasOwnProperty(t)&&(a.citys[t]=parseInt(a.citys[t]));a.showData=e.getShowData({province:a.province,citys:a.citys}),e.form.rule.push(a)}))})).catch((e=>{}))},getShowData:function(e){var a=this,t={};return e.province.forEach((function(i){var r=a.optionsMap[i],l=[],o=0;for(var s in r.children)if(r.children.hasOwnProperty(s)){var d=r.children[s];a.inArray(d.value,e.citys)&&l.push({id:d.value,name:d.label}),o++}t[r.value]={id:r.value,name:r.label,citys:l,isAllCitys:l.length===o}})),t},inArray:function(e,a){return a.indexOf(e)>-1},addAreaClick(e){this.areaModel.index=this.form.rule.length,this.areaModel.type="add",this.show_area=!0},editAreaClick(e){this.areaModel.index=e,this.areaModel.type="edit",this.show_area=!0},closeAreaFunc(e){let a=this;if(this.show_area=e.statu,"confirm"!=e.type)return;this.options=e.this_area;let t=[],i=[];e.this_area.forEach((function(e,r){1!=e.checked&&1!=e.indeterminate||-1==e.index.indexOf(a.areaModel.index)||(t.push(e.value),e.children.forEach((function(e){1==e.checked&&e.index==a.areaModel.index&&i.push(e.value)})))})),""==t&&""==i||("add"==this.areaModel.type&&this.form.rule.push({first:"",first_fee:"",additional:"",additional_fee:"",citys:i,showData:this.getShowData({province:t,citys:i})}),"edit"==this.areaModel.type&&(this.form.rule[this.areaModel.index].showData=this.getShowData({province:t,citys:i}),this.form.rule[this.areaModel.index].citys=i),this.form.rule.push([]),this.form.rule.pop())},deleteAreaClick(e){let a=this;a.options.forEach((function(t){a.form.rule[e].province&&a.inArray(t.value,a.form.rule[e].province)&&(t.checked=!1,t.index=null),t.children.forEach((function(t){a.inArray(t.value,a.form.rule[e].citys)&&(t.checked=!1,t.index=null)}))})),a.form.rule.splice(e,1)},onSubmit(){let a=this,t=u(a.form);t.rule.forEach((function(e){delete e.showData})),a.$refs.form.validate((i=>{if(i){if(0==t.rule.length)return e({message:"請新增配送區域和運費",type:"error"}),!1;for(let a in t.rule){if(!(t.rule[a].hasOwnProperty("first")&&t.rule[a].first>0))return e({message:"首件/首重不能為空",type:"error"}),!1;if(!t.rule[a].hasOwnProperty("first_fee")||""==t.rule[a].first_fee)return e({message:"運費不能為空",type:"error"}),!1;if(!(t.rule[a].hasOwnProperty("additional")&&t.rule[a].additional>0))return e({message:"續件/續重不能為空",type:"error"}),!1;if(!t.rule[a].hasOwnProperty("additional_fee")||""==t.rule[a].additional_fee)return e({message:"續費不能為空",type:"error"}),!1}a.loading=!0,d.editDelivery(t,!0).then((t=>{a.loading=!1,e({message:"恭喜你，修改成功",type:"success"}),a.$router.push("/setting/delivery/index")})).catch((e=>{a.loading=!1}))}}))},cancelFunc(){this.$router.back(-1)}}},M=e=>(x("data-v-3c54159f"),e=e(),V(),e),A={class:"product-add"},D=M((()=>_("div",{class:"common-form"},"修改運費模版",-1))),U={class:"area-list"},E={key:0},S={class:"am-link-muted gray9"},O={key:0},P=["onClick"],H=["onClick"],N=M((()=>_("div",{class:"tips"},"數字越小越靠前",-1))),$={class:"common-button-wrapper"};const z=m(C,[["render",function(e,d,n,m,u,x){const V=a,C=t,M=i,z=r,F=l,q=o,I=s,K=f("Areas");return p(),c("div",A,[h(I,{size:"small",ref:"form",model:u.form,rules:u.formRules,"label-width":"200px"},{default:y((()=>[D,h(C,{label:"模版名稱",prop:"name"},{default:y((()=>[h(V,{modelValue:u.form.name,"onUpdate:modelValue":d[0]||(d[0]=e=>u.form.name=e),modelModifiers:{trim:!0},class:"max-w460"},null,8,["modelValue"])])),_:1}),h(C,{label:"計費方式"},{default:y((()=>[_("div",null,[h(M,{modelValue:u.form.radio,"onUpdate:modelValue":d[1]||(d[1]=e=>u.form.radio=e),label:"10"},{default:y((()=>[v("按件數")])),_:1},8,["modelValue"]),h(M,{modelValue:u.form.radio,"onUpdate:modelValue":d[2]||(d[2]=e=>u.form.radio=e),label:"20"},{default:y((()=>[v("按重量")])),_:1},8,["modelValue"])])])),_:1}),h(C,{label:"配送區域及運費"},{default:y((()=>[h(F,{data:u.form.rule,border:"",style:{width:"100%"}},{default:y((()=>[h(z,{label:"可配送區域"},{default:y((a=>[_("div",U,[a.row.citys.length==u.cityCount?(p(),c("span",E,"全國")):(p(!0),c(w,{key:1},b(a.row.showData,((e,a)=>(p(),c("span",{key:a,class:"pr16"},[v(g(e.name)+" ",1),e.isAllCitys?j("",!0):(p(),c(w,{key:0},[v(" ( "),_("span",S,[(p(!0),c(w,null,b(e.citys,((a,t)=>(p(),c("em",{key:t},[_("span",null,g(a.name),1),t+1<e.citys.length?(p(),c("span",O,"、")):j("",!0)])))),128))]),v(" ) ")],64))])))),128))]),_("a",{href:"javascript:void(0);",onClick:t=>e.el=x.editAreaClick(a.$index)},"編輯",8,P)])),_:1}),h(z,{prop:"first",label:u.tableHeadName.first,width:"100px"},{default:y((e=>[h(V,{modelValue:e.row.first,"onUpdate:modelValue":a=>e.row.first=a,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),h(z,{prop:"first_fee",label:u.tableHeadName.first_fee,width:"100px"},{default:y((e=>[h(V,{modelValue:e.row.first_fee,"onUpdate:modelValue":a=>e.row.first_fee=a,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),h(z,{prop:"additional",label:u.tableHeadName.additional,width:"100px"},{default:y((e=>[h(V,{modelValue:e.row.additional,"onUpdate:modelValue":a=>e.row.additional=a,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),h(z,{prop:"additional_fee",label:u.tableHeadName.additional_fee,width:"100px"},{default:y((e=>[h(V,{modelValue:e.row.additional_fee,"onUpdate:modelValue":a=>e.row.additional_fee=a,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),h(z,{label:"操作",width:"60px"},{default:y((e=>[_("a",{href:"javascript:void(0);",onClick:a=>x.deleteAreaClick(e.$index)},"刪除",8,H)])),_:1})])),_:1},8,["data"]),_("div",null,[h(q,{onClick:x.addAreaClick,type:"text",size:"small"},{default:y((()=>[v("+點選新增可配送區域和運費")])),_:1},8,["onClick"])])])),_:1}),h(C,{label:"排序"},{default:y((()=>[h(V,{modelValue:u.form.sort,"onUpdate:modelValue":d[3]||(d[3]=e=>u.form.sort=e),modelModifiers:{trim:!0},type:"number",class:"max-w460"},null,8,["modelValue"]),N])),_:1}),_("div",$,[h(q,{size:"small",type:"info",onClick:x.cancelFunc},{default:y((()=>[v("取消")])),_:1},8,["onClick"]),h(q,{type:"primary",onClick:x.onSubmit,loading:u.loading},{default:y((()=>[v("提交")])),_:1},8,["onClick","loading"])])])),_:1},8,["model","rules"]),u.show_area?(p(),k(K,{key:0,show_area:u.show_area,areaModel:u.areaModel,areas:u.options,onCloseArea:x.closeAreaFunc},null,8,["show_area","areaModel","areas","onCloseArea"])):j("",!0)])}],["__scopeId","data-v-3c54159f"]]);export{z as default};
