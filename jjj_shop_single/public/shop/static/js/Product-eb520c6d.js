import{_ as e}from"./Specs-58a287cd.js";import{E as l,f as s,d as t,l as a,k as i,i as o,e as r}from"./element-plus-84a27f94.js";import{_ as d}from"./index-5ae5860a.js";import{P as m}from"./Product-14aa5af4.js";import{m as c}from"./table-d3149ce0.js";import{ae as u,o as p,c as n,P as _,S as b,W as h,a as f,X as k,Y as V,T as w,M as y,bb as j,b9 as x}from"./@vue-8fe4574d.js";import"./product-6ff3546d.js";import"./@vueuse-3cd91d51.js";import"./lodash-es-656e9c2f.js";import"./async-validator-cf877c1f.js";import"./dayjs-9faf8871.js";import"./call-bind-0c463fe3.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-06559b09.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-49f0fa2f.js";import"./pinia-265da389.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-b80b041e.js";import"./side-channel-ba7aab8a.js";import"./object-inspect-860361a9.js";import"./vue-clipboard2-f8268db2.js";import"./clipboard-dd0324d2.js";import"./vue-ueditor-wrap-dff311b3.js";const I={components:{Product:m,Specs:e},data(){return{isproduct:!1,excludeIds:[],isspecs:!1,curProduct:{},curIndex:-1,specType:!1,SpecExcludeIds:[],all_assemble_price:null,all_assemble_stock:null,all_limit_num:null,all_assemble_num:null,rulesProduct:[{validator:(e,l,s)=>{if(l.length<1)return s(new Error("請選擇商品"));{let e=!1;for(let l=0;l<this.form.tableData.length;l++){let s=this.form.tableData[l];if(!e){let l=""==s.assemble_price||""==s.assemble_stock||""==s.limit_num||""==s.sort,t=0==parseFloat(s.assemble_price)||parseInt(s.assemble_stock)<1||parseInt(s.limit_num)<1||parseInt(s.assemble_num)<1||20==s.spec_type&&!s.spec_name;(l||t)&&(e=!0)}parseInt(s.assemble_stock)>0?s.stockValid=!0:s.stockValid=!1,parseInt(s.assemble_price)>0?s.priceValid=!0:s.priceValid=!1,parseInt(s.limit_num)>0?s.limit_numValid=!0:s.limit_numValid=!1,parseInt(s.assemble_num)>1?s.assemble_numValid=!0:s.assemble_numValid=!1,parseInt(s.sort)>0?s.sortValid=!0:s.sortValid=!1,this.form.tableData[l]=s}if(e)return s(new Error("請填寫正確的資訊"));s()}},required:!0,trigger:"blur"}]}},props:{form:Object,type:String},created(){},methods:{changeProduct(e){let l=[];e.forEach((e=>{l.push(e.product_id)})),this.excludeIds=l,this.isproduct=!0},closeDialogFunc(e){let l=this;if(l.isproduct=!1,e&&"success"==e.type){let s=[];for(let l=0;l<e.params.length;l++){let t=e.params[l],a={product_name:t.product_name,product_id:t.product_id,product_price:t.product_price,stock_num:t.product_stock,product_sku_id:t.product_sku.product_sku_id,sales_num:0,spec_type:t.spec_type,assemble_price:null,assemble_stock:0,limit_num:1,sort:100,tempProduct:!0,is_delete:0,assemble_num:0,assemble_product_id:0,assemble_product_sku_id:0,sales_initial:0};s.push(a)}l.form.tableData=l.form.tableData.concat(s),l.form.tableData=c(this.form.tableData)}},specsFunc(e,l,s){this.curProduct=l,this.curIndex=e;let t=[];s?(this.specType=!0,this.form.tableData.forEach((e=>{this.curProduct.product_id==e.product_id&&t.push(e.product_sku_id)}))):this.specType=!1,this.SpecExcludeIds=t,this.isspecs=!0},closeSpecs(e){if(this.isspecs=!1,e&&"success"==e.type){let l=[];for(let t=0;t<e.params.length;t++){let s=e.params[t],a={product_name:this.curProduct.product_name,product_id:this.curProduct.product_id,product_price:s.spec_form.product_price,spec_type:this.curProduct.spec_type,product_sku_id:this.curProduct.product_sku_id,assemble_product_id:this.curProduct.assemble_product_id,stock_num:s.product_stock,sales_num:0,spec_name:s.spec_name,product_sku_id:s.product_sku_id,assemble_price:null,assemble_stock:0,limit_num:2,sort:100,tempProduct:!0,is_delete:0,assemble_num:2,assemble_product_sku_id:0,sales_initial:2};l.push(a)}let s=[this.curIndex,this.specType?0:1].concat(l);this.form.tableData.splice(...s),this.form.tableData=c(this.form.tableData)}},deleteClick(e,s){let t=this.form.tableData[e];if(t.join_num>0)l({message:"此商品有人參加活動，無法刪除！",type:"warning"});else{if(s){for(let e=0;e<this.form.tableData.length;e++){let s=this.form.tableData[e];if(t.product_id==s.product_id&&s.sales_num>0)return void l({message:"已售商品不能刪除！",type:"warning"})}for(let l=0;l<this.form.tableData.length;l++){let s=this.form.tableData[l];if(t.product_id==s.product_id){if("edit"==this.type&&1!=e.tempProduct){let e=s.assemble_product_id;this.form.product_del_ids.push(e)}this.form.tableData.splice(l,1),l--}}}else{if(parseInt(e.sales_num)>0)return void l({message:"已售商品規格不能刪除！",type:"warning"});let s=0;for(let e=0;e<this.form.tableData.length;e++){let l=this.form.tableData[e];if(t.product_id==l.product_id&&(s++,s>1))break}s>1?this.form.tableData.splice(e,1):t.spec_name=null}this.form.tableData=c(this.form.tableData)}},objectSpanMethod({row:e,column:l,rowIndex:s,columnIndex:t}){if(0===t||6===t||7===t||8===t||9===t||10===t)return null!=e.rowSpan?{rowspan:e.rowSpan,colspan:1}:{rowspan:0,colspan:0}},allApply(){this.form.tableData.forEach((e=>{parseInt(this.all_assemble_price)&&parseInt(this.all_assemble_price)>0&&(e.assemble_price=this.all_assemble_price),parseInt(this.all_assemble_stock)&&parseInt(this.all_assemble_stock)>0&&(e.assemble_stock=this.all_assemble_stock),parseInt(this.all_assemble_num)&&parseInt(this.all_assemble_num)>0&&(e.assemble_num=this.all_assemble_num),parseInt(this.all_limit_num)&&parseInt(this.all_limit_num)>0&&(e.limit_num=this.all_limit_num)}))},showFunc(e,l){0===l.is_delete?l.is_delete=1:l.is_delete=0}}},v=e=>(j("data-v-068ca3bf"),e=e(),x(),e),D=v((()=>f("div",{class:"common-form"},"活動商品",-1))),g={class:"d-s-c pt16 max-w460 active-all-set"},C=v((()=>f("div",{style:{width:"60px"}},"批次設定：",-1))),P={class:"flex-1"},U={class:"flex-1 ml10"},S={class:"flex-1 ml10"},z={class:"flex-1 ml10"},E={class:"ml10"},F={class:"pt16"},T={class:"text-ellipsis-2"},$={key:0,class:"gray"},M={key:1},A={key:0,class:"spec-min-box"},q=["title"];const B=d(I,[["render",function(l,d,m,c,j,x){const I=s,v=t,B=a,J=u("CloseBold"),L=i,O=u("CaretRight"),R=o,W=r,X=u("Product",!0),Y=e;return p(),n("div",null,[D,_(W,{label:"商品管理",prop:"tableData",rules:j.rulesProduct},{default:b((()=>[_(I,{icon:"Plus",onClick:d[0]||(d[0]=e=>x.changeProduct(m.form.tableData))},{default:b((()=>[h("選擇商品")])),_:1}),f("div",g,[C,f("div",P,[_(v,{modelValue:j.all_assemble_price,"onUpdate:modelValue":d[1]||(d[1]=e=>j.all_assemble_price=e),type:"number",min:"0",placeholder:"拼團價"},null,8,["modelValue"])]),f("div",U,[_(v,{modelValue:j.all_assemble_stock,"onUpdate:modelValue":d[2]||(d[2]=e=>j.all_assemble_stock=e),type:"number",min:"0",placeholder:"拼團庫存"},null,8,["modelValue"])]),f("div",S,[_(v,{modelValue:j.all_assemble_num,"onUpdate:modelValue":d[3]||(d[3]=e=>j.all_assemble_num=e),type:"number",min:"0",placeholder:"開團人數"},null,8,["modelValue"])]),f("div",z,[_(v,{modelValue:j.all_limit_num,"onUpdate:modelValue":d[4]||(d[4]=e=>j.all_limit_num=e),type:"number",min:"0",placeholder:"限購數量"},null,8,["modelValue"])]),f("div",E,[_(I,{onClick:x.allApply},{default:b((()=>[h("應用")])),_:1},8,["onClick"])])]),f("div",F,[_(R,{size:"small",data:m.form.tableData,"span-method":x.objectSpanMethod,border:"",style:{width:"100%"}},{default:b((()=>[_(B,{label:"商品名稱",width:"300"},{default:b((e=>[f("p",T,k(e.row.product_name),1)])),_:1}),_(B,{label:"規格",width:"180"},{default:b((e=>[10==e.row.spec_type?(p(),n("div",$,"暫無規格")):V("",!0),20==e.row.spec_type?(p(),n("div",M,[null!=e.row.spec_name&&""!=e.row.spec_name?(p(),n("div",A,[f("p",{class:"text-ellipsis",title:e.row.spec_name},k(e.row.spec_name),9,q),_(L,{class:"el-icon-close",onClick:l=>x.deleteClick(e.$index)},{default:b((()=>[_(J)])),_:2},1032,["onClick"]),_(L,{class:"el-icon-caret-right",onClick:l=>x.specsFunc(e.$index,e.row,!0)},{default:b((()=>[_(O)])),_:2},1032,["onClick"])])):(p(),w(I,{key:1,size:"small",icon:"Plus",onClick:l=>x.specsFunc(e.$index,e.row)},{default:b((()=>[h("新增規格 ")])),_:2},1032,["onClick"]))])):V("",!0)])),_:1}),_(B,{prop:"product_price",label:"售價"}),_(B,{label:"拼團價"},{default:b((e=>[_(v,{size:"small",class:y({isvalid:1==e.row.priceValid}),type:"number",min:"0",step:"0.01",modelValue:e.row.assemble_price,"onUpdate:modelValue":l=>e.row.assemble_price=l},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(B,{label:"拼團庫存"},{default:b((e=>[_(v,{size:"small",class:y({isvalid:1==e.row.stockValid}),type:"number",min:"0",modelValue:e.row.assemble_stock,"onUpdate:modelValue":l=>e.row.assemble_stock=l},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(B,{prop:"sales_num",label:"已售"}),_(B,{label:"開團人數"},{default:b((e=>[_(v,{size:"small",class:y({isvalid:1==e.row.assemble_numValid}),type:"number",min:"2",modelValue:e.row.assemble_num,"onUpdate:modelValue":l=>e.row.assemble_num=l},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(B,{label:"限購數量"},{default:b((e=>[_(v,{size:"small",class:y({isvalid:1==e.row.limit_numValid}),type:"number",min:"1",modelValue:e.row.limit_num,"onUpdate:modelValue":l=>e.row.limit_num=l},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(B,{label:"虛擬銷量"},{default:b((e=>[_(v,{size:"small",class:y({isvalid:1==e.row.sortValid}),type:"number",min:"0",modelValue:e.row.sales_initial,"onUpdate:modelValue":l=>e.row.sales_initial=l},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(B,{label:"排序"},{default:b((e=>[_(v,{size:"small",class:y({isvalid:1==e.row.sortValid}),type:"number",min:"0",modelValue:e.row.sort,"onUpdate:modelValue":l=>e.row.sort=l},null,8,["class","modelValue","onUpdate:modelValue"])])),_:1}),_(B,{fixed:"right",label:"操作",width:"edit"==m.type?140:60},{default:b((e=>["edit"==m.type?(p(),w(I,{key:0,onClick:l=>x.showFunc(e.$index,e.row),type:"text",size:"small"},{default:b((()=>[h(k(0==e.row.is_delete?"隱藏":"顯示"),1)])),_:2},1032,["onClick"])):V("",!0),_(I,{onClick:l=>x.deleteClick(e.$index,!0),type:"text",size:"small"},{default:b((()=>[h("刪除")])),_:2},1032,["onClick"])])),_:1},8,["width"])])),_:1},8,["data","span-method"])])])),_:1},8,["rules"]),_(X,{isproduct:j.isproduct,excludeIds:j.excludeIds,islist:!0,onCloseDialog:x.closeDialogFunc},null,8,["isproduct","excludeIds","onCloseDialog"]),_(Y,{isspecs:j.isspecs,productId:j.curProduct.product_id,excludeIds:j.SpecExcludeIds,islist:!0,onClose:x.closeSpecs},null,8,["isspecs","productId","excludeIds","onClose"])])}],["__scopeId","data-v-068ca3bf"]]);export{B as default};
