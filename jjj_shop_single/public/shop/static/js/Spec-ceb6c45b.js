import{_ as t}from"./Specs-58a287cd.js";import{E as e,d as l,f as o,l as s,k as a,e as i,i as r}from"./element-plus-84a27f94.js";import{_ as p}from"./index-5ae5860a.js";import{m as n}from"./table-d3149ce0.js";import{ae as c,o as d,c as u,P as m,S as _,a as h,W as f,X as b,Y as y,T as k,bb as j,b9 as w}from"./@vue-8fe4574d.js";import"./product-6ff3546d.js";import"./@vueuse-3cd91d51.js";import"./lodash-es-656e9c2f.js";import"./async-validator-cf877c1f.js";import"./dayjs-9faf8871.js";import"./call-bind-0c463fe3.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-06559b09.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-49f0fa2f.js";import"./pinia-265da389.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-b80b041e.js";import"./side-channel-ba7aab8a.js";import"./object-inspect-860361a9.js";import"./vue-clipboard2-f8268db2.js";import"./clipboard-dd0324d2.js";import"./vue-ueditor-wrap-dff311b3.js";const V={components:{Specs:t},data(){return{excludeIds:[],isspecs:!1,curProduct:{},curIndex:-1,specType:!1,SpecExcludeIds:[],all_point_num:null,all_point_money:null,all_point_stock:null,rulesProduct:[{validator:(t,e,l)=>{if(e.length<1)return l(new Error("請選擇商品"));{let t=!1;for(let e=0;e<this.form.tableData.length;e++){let l=this.form.tableData[e];if(!t){let e=""==l.point_price||""==l.point_stock||""==l.limit_num||""==l.sort,o=0==parseFloat(l.point_price)||parseInt(l.point_stock)<1||parseInt(l.limit_num)<1;(e||o)&&(t=!0)}parseInt(l.point_stock)>0?l.stockValid=!0:l.stockValid=!1,parseInt(l.point_price)>0?l.priceValid=!0:l.priceValid=!1,parseInt(l.limit_num)>0?l.limit_numValid=!0:l.limit_numValid=!1,parseInt(l.sort)>0?l.sortValid=!0:l.sortValid=!1,this.form.tableData[e]=l}if(t)return l(new Error("請填寫正確的資訊"));l()}},required:!0,trigger:"blur"}]}},inject:["form","type"],created(){this.creatSpec()},methods:{creatSpec(t){this.form.tableData=n(this.form.tableData)},specsFunc(t,e,l){this.curProduct=e,this.curIndex=t;let o=[];l?(this.specType=!0,this.form.tableData.forEach((t=>{this.curProduct.product_id==t.product_id&&o.push(t.product_sku_id)}))):this.specType=!1,this.SpecExcludeIds=o,this.isspecs=!0},closeSpecs(t){if(this.isspecs=!1,t&&"success"==t.type){let e=[];for(let o=0;o<t.params.length;o++){let l=t.params[o],s={product_name:this.curProduct.product_name,product_id:this.curProduct.product_id,spec_type:this.curProduct.spec_type,product_sku_id:this.curProduct.product_sku_id,point_product_id:this.curProduct.point_product_id,product_price:l.spec_form.product_price,stock_num:l.product_stock,sales_num:0,spec_name:l.spec_name,product_sku_id:l.product_sku_id,point_price:null,point_stock:0,limit_num:1,sort:100,tempProduct:!0,is_delete:0,point_product_sku_id:0,sales_initial:0,point_num:0};e.push(s)}let l=[this.curIndex,this.specType?0:1].concat(e);this.form.tableData.splice(...l),this.form.tableData=n(this.form.tableData)}},deleteClick(t,l){let o=this.form.tableData[t];if(l){for(let t=0;t<this.form.tableData.length;t++){let l=this.form.tableData[t];if(o.product_id==l.product_id&&l.sales_num>0)return void e({message:"已售商品不能刪除！",type:"warning"})}for(let e=0;e<this.form.tableData.length;e++){let l=this.form.tableData[e];if(o.product_id==l.product_id){if("edit"==this.type&&1!=t.tempProduct){let t=l.point_product_id;this.form.product_del_ids.push(t)}this.form.tableData.splice(e,1),e--}}}else{if(parseInt(t.sales_num)>0)return void e({message:"已售商品規格不能刪除！",type:"warning"});let l=0;for(let t=0;t<this.form.tableData.length;t++){let e=this.form.tableData[t];if(o.product_id==e.product_id&&(l++,l>1))break}l>1?this.form.tableData.splice(t,1):o.spec_name=null}this.form.tableData=n(this.form.tableData)},objectSpanMethod({row:t,column:e,rowIndex:l,columnIndex:o}){if(0===o)return null!=t.rowSpan?{rowspan:t.rowSpan,colspan:1}:{rowspan:0,colspan:0}},allApply(){for(let t=0;t<this.form.tableData.length;t++){let e=this.form.tableData[t];parseFloat(this.all_point_money)>parseFloat(e.product_price)?e.point_money=e.product_price:e.point_money=this.all_point_money,e.point_stock=this.all_point_stock>=0?this.all_point_stock:e.point_stock,e.point_num=this.all_point_num>=0?this.all_point_num:e.point_num}},showFunc(t,e){0===e.is_delete?e.is_delete=1:e.is_delete=0}}},v=t=>(j("data-v-b4283b4f"),t=t(),w(),t),x=v((()=>h("div",{class:"common-form"},"規格",-1))),D={class:"d-s-c max-w460 active-all-set"},I=v((()=>h("div",{style:{width:"60px"}},"批次設定：",-1))),g={class:"flex-1"},C={class:"flex-1 ml10"},P={class:"flex-1 ml10"},S={class:"ml10"},U={class:"pt16 ww100"},z={class:"text-ellipsis-2"},E={key:0,class:"gray"},F={key:1},T={key:0,class:"spec-min-box"},A=["title"];const M=p(V,[["render",function(e,p,n,j,w,V){const v=l,M=o,$=s,q=c("CloseBold"),B=a,L=c("CaretRight"),R=i,W=r,X=t;return d(),u("div",null,[x,m(R,{label:"商品管理",prop:"tableData",rules:w.rulesProduct},{default:_((()=>[h("div",D,[I,h("div",g,[m(v,{modelValue:w.all_point_num,"onUpdate:modelValue":p[0]||(p[0]=t=>w.all_point_num=t),type:"number",min:"0",placeholder:"兌換積分"},null,8,["modelValue"])]),h("div",C,[m(v,{modelValue:w.all_point_money,"onUpdate:modelValue":p[1]||(p[1]=t=>w.all_point_money=t),type:"number",min:"0",placeholder:"兌換金額"},null,8,["modelValue"])]),h("div",P,[m(v,{modelValue:w.all_point_stock,"onUpdate:modelValue":p[2]||(p[2]=t=>w.all_point_stock=t),type:"number",min:"0",placeholder:"總庫存"},null,8,["modelValue"])]),h("div",S,[m(M,{onClick:V.allApply},{default:_((()=>[f("應用")])),_:1},8,["onClick"])])]),h("div",U,[m(W,{size:"small",data:V.form.tableData,"span-method":V.objectSpanMethod,border:"",style:{width:"100%"}},{default:_((()=>[m($,{label:"商品名稱",width:"300"},{default:_((t=>[h("p",z,b(t.row.product_name),1)])),_:1}),m($,{label:"規格",width:"180"},{default:_((t=>[10==t.row.spec_type?(d(),u("div",E,"暫無規格")):y("",!0),20==t.row.spec_type?(d(),u("div",F,[null!=t.row.spec_name&&""!=t.row.spec_name?(d(),u("div",T,[h("p",{class:"text-ellipsis",title:t.row.spec_name},b(t.row.spec_name),9,A),m(B,{class:"el-icon-close",onClick:e=>V.deleteClick(t.$index)},{default:_((()=>[m(q)])),_:2},1032,["onClick"]),m(B,{class:"el-icon-caret-right",onClick:e=>V.specsFunc(t.$index,t.row,!0)},{default:_((()=>[m(L)])),_:2},1032,["onClick"])])):(d(),k(M,{key:1,size:"small",icon:"Plus",onClick:e=>V.specsFunc(t.$index,t.row)},{default:_((()=>[f("新增規格")])),_:2},1032,["onClick"]))])):y("",!0)])),_:1}),m($,{prop:"product_price",label:"售價"}),m($,{label:"兌換積分"},{default:_((t=>[m(v,{size:"small",type:"number",min:"0",step:"1",modelValue:t.row.point_num,"onUpdate:modelValue":e=>t.row.point_num=e},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),m($,{label:"兌換金額"},{default:_((t=>[m(R,{label:"",style:{"margin-bottom":"0"}},{default:_((()=>[m(v,{size:"small",type:"number",min:"0",step:"0.01",modelValue:t.row.point_money,"onUpdate:modelValue":e=>t.row.point_money=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1}),m($,{label:"庫存總量"},{default:_((t=>[m(R,{label:"",style:{"margin-bottom":"0"}},{default:_((()=>[m(v,{size:"small",type:"number",min:"0",step:"1",modelValue:t.row.point_stock,"onUpdate:modelValue":e=>t.row.point_stock=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1})])),_:1},8,["data","span-method"])])])),_:1},8,["rules"]),m(X,{isspecs:w.isspecs,productId:w.curProduct.product_id,excludeIds:w.SpecExcludeIds,islist:!0,onClose:V.closeSpecs},null,8,["isspecs","productId","excludeIds","onClose"])])}],["__scopeId","data-v-b4283b4f"]]);export{M as default};
