import{E as t,c as i,f as a}from"./element-plus-84a27f94.js";import{B as r}from"./bargain-d601917c.js";import e from"./Basic-d9164f65.js";import o from"./Datetime-708850f2.js";import s from"./Product-6c37916f.js";import d from"./Other-bc2fba10.js";import{m as p}from"./table-d3149ce0.js";import{_ as c}from"./index-5ae5860a.js";import{ae as n,o as m,c as l,P as _,S as u,a as b,W as g}from"./@vue-8fe4574d.js";import"./@vueuse-3cd91d51.js";import"./lodash-es-656e9c2f.js";import"./async-validator-cf877c1f.js";import"./dayjs-9faf8871.js";import"./call-bind-0c463fe3.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-06559b09.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./Upload-71ca9325.js";import"./file-b7a04c7e.js";/* empty css                                                               */import"./AddCategory-69aab672.js";import"./vue-router-49f0fa2f.js";import"./pinia-265da389.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-b80b041e.js";import"./side-channel-ba7aab8a.js";import"./object-inspect-860361a9.js";import"./vue-clipboard2-f8268db2.js";import"./clipboard-dd0324d2.js";import"./vue-ueditor-wrap-dff311b3.js";import"./Specs-58a287cd.js";import"./product-6ff3546d.js";import"./Product-14aa5af4.js";const j={class:"product-add"},f={class:"common-button-wrapper"};const h=c({components:{Basic:e,Datetime:o,ProductIndex:s,Other:d},data:()=>({loading:!1,form:{title:"",image_id:0,file_path:"",start_time:"",end_time:"",together_time:0,status:1,conditions:1,sort:1,tableData:[],product_list:[]}}),provide:function(){return{form:this.form,type:"edit"}},created(){this.form.bargain_activity_id=this.$route.query.bargain_activity_id,this.getData()},methods:{getData(){let t=this;t.loading=!0,r.editActive({bargain_activity_id:t.form.bargain_activity_id},!0).then((i=>{let a=i.data.detail;a.bargain_activity_id=t.form.bargain_activity_id,a.product_del_ids=[],a.tableData=[];let r=[];for(let t=0;t<i.data.product_list.length;t++){let a=i.data.product_list[t];for(let t=0;t<a.bargainSku.length;t++){let i=a.bargainSku[t],e={product_name:a.product.product_name,product_id:a.product.product_id,product_price:a.product.product_price,stock_num:a.product.product_stock,spec_type:a.product.spec_type,is_delete:a.is_delete,product_sku_id:i.product_sku_id,spec_name:i.product_attr,sales_num:a.total_sales,bargain_price:i.bargain_price,bargain_stock:i.bargain_stock,bargain_product_id:i.bargain_product_id,limit_num:a.limit_num,bargain_num:i.bargain_num,sort:a.sort,bargain_product_sku_id:i.bargain_product_sku_id,sales_initial:a.sales_initial,join_num:a.join_num};r.push(e)}}a.tableData=p(r),Object.assign(t.form,a),t.loading=!1})).catch((i=>{t.loading=!1}))},onSubmit(){let i=this;null!=i.form.end_time&&""!=i.form.end_time?i.$refs.form.validate((a=>{if(a){i.form.product_list=i.tableFormet(i.form.tableData);let a=i.form;delete a.tableData,i.loading=!0,r.saveActive(a,!0).then((a=>{t({message:"恭喜你，砍價活動修改成功",type:"success"}),i.$router.push("/plus/bargain/index")})).catch((t=>{}))}})):t({message:"請填寫活動結束時間",type:"error"})},tableFormet(t){let i=[],a=[],r=null;for(let e=0;e<t.length;e++){let o=t[e],s={product_sku_id:o.product_sku_id,bargain_stock:o.bargain_stock,bargain_price:o.bargain_price,product_attr:o.spec_name,product_price:o.product_price,bargain_num:o.bargain_num,bargain_product_sku_id:o.bargain_product_sku_id,sales_initial:o.sales_initial};null==r&&(r=o),r.product_id!=o.product_id&&(r.spec_list=i,a.push(r),r=o,i=[]),i.push(s)}return r.spec_list=i,a.push(r),a},cancelFunc(){this.$router.back(-1)}}},[["render",function(t,r,e,o,s,d){const p=n("Basic"),c=n("Datetime"),h=n("ProductIndex"),v=n("Other"),k=i,y=a;return m(),l("div",j,[_(k,{size:"small",ref:"form",model:s.form,"label-width":"200px"},{default:u((()=>[_(p),_(c),_(h),_(v)])),_:1},8,["model"]),b("div",f,[_(y,{size:"small",onClick:d.cancelFunc},{default:u((()=>[g("取消")])),_:1},8,["onClick"]),_(y,{size:"small",type:"primary",onClick:d.onSubmit,disabled:s.loading},{default:u((()=>[g("提交")])),_:1},8,["onClick","disabled"])])])}],["__scopeId","data-v-69624096"]]);export{h as default};
