import{k as e,p as t,f as i,q as a,a as l,E as s,u as o,h as c,w as n}from"./element-plus-84a27f94.js";import{F as r}from"./file-b7a04c7e.js";/* empty css                                                               */import{_ as g}from"./index-5ae5860a.js";import{ae as d,o as p,c as u,P as h,S as f,a as y,W as m,Q as C,a9 as _,M as k,X as F,Y as v,V as S,T as b,a1 as z}from"./@vue-8fe4574d.js";import{_ as w}from"./AddCategory-69aab672.js";const L={class:"upload-wrap"},T={class:"fileContainer"},x={class:"file-type"},D=["onClick"],I={class:"file-content"},P={class:"fileContainerUI clearfix"},j=["onClick"],V={key:0,class:"selectedIcon"},U=["scr"],B={class:"desc"},N={class:"pagination-wrap"},W={class:"dialog-footer"};const $=g({components:{},data:()=>({dialogWidth:"910px",activeType:null,category_id:"",typeList:[],imageUrl:null,dialogVisible:!0,fileList:[],addLoading:!1,this_config:{total:1,fileType:"image"},record:0,loading:!0,tableData:[],pageSize:36,totalDataNumber:0,curPage:1,isShowCategory:!1,category:null,fileIds:[],accept:""}),props:["config"],created(){if("[object object]"===Object.prototype.toString.call(this.config).toLowerCase()){for(let e in this.config)this.config[e]&&(this.this_config[e]=this.config[e]);"image"==this.this_config.fileType?this.accept="image/jpeg,image/png,image/jpg":this.accept="video/mp4"}this.getFileCategory(),this.getData()},methods:{getFileCategory(){let e=this,t={page:e.curPage,list_rows:e.pageSize,parentId:e.activeType,fileType:e.this_config.fileType};r.SystemPictureList(t,!0).then((t=>{e.loading=!1,e.fileList=t.data.list.data,e.totalDataNumber=t.data.list.total})).catch((t=>{e.loading=!1}))},getData:function(){let e=this;r.PictureIndex({type:e.this_config.fileType},!0).then((t=>{e.typeList=[{category_id:null,name:"全部"}].concat(t.data.list),e.category_id=e.typeList.category_id})).catch((t=>{e.loading=!1}))},selectTypeFunc(e){this.activeType=e,this.curPage=1,this.getFileCategory()},handleCurrentChange(e){this.curPage=e,this.getFileCategory()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getFileCategory()},fileChange(e){},selectFileFunc(e,t){e.selected?(e.selected=!1,this.record--):(e.selected=!0,this.record++),this.fileList[t]=e},confirmFunc(){let e=[],t=0;for(let i=0;i<this.fileList.length;i++){let a=this.fileList[i];if(a.selected){let i={file_path:a.image};e.push(i),t++}if(t>this.this_config.total)break}this.$emit("closeSystem",e)},cancelFunc(){this.$emit("closeSystem",null)}}},[["render",function(l,s,o,c,n,r){const g=d("Check"),b=e,z=t,w=i,$=a;return p(),u("div",L,[h($,{title:"系統圖標",modelValue:n.dialogVisible,"onUpdate:modelValue":s[0]||(s[0]=e=>n.dialogVisible=e),"close-on-click-modal":!1,"custom-class":"upload-dialog","close-on-press-escape":!1,onClose:r.cancelFunc,width:n.dialogWidth,"append-to-body":!0},{footer:f((()=>[y("div",W,[h(w,{size:"small",onClick:r.cancelFunc},{default:f((()=>[m("取 消")])),_:1},8,["onClick"]),h(w,{size:"small",type:"primary",onClick:r.confirmFunc},{default:f((()=>[m("確 定")])),_:1},8,["onClick"])])])),default:f((()=>[y("div",T,[y("div",x,[y("ul",null,[(p(!0),u(C,null,_(n.typeList,((e,t)=>(p(),u("li",{class:k(n.activeType==e.category_id?"item active":"item"),key:t,onClick:t=>r.selectTypeFunc(e.category_id)},F(e.name),11,D)))),128))])]),y("div",I,[y("ul",P,[(p(!0),u(C,null,_(n.fileList,((e,t)=>(p(),u("li",{class:"file",key:t,onClick:i=>r.selectFileFunc(e,t)},[1==e.selected?(p(),u("div",V,[h(b,null,{default:f((()=>[h(g)])),_:1})])):v("",!0),"image"==n.this_config.fileType?(p(),u("img",{key:1,scr:e.image,style:S("background-image:url("+e.image+")"),alt:""},null,12,U)):v("",!0),y("p",B,F(e.name),1)],8,j)))),128))])])]),y("div",N,[h(z,{onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange,"current-page":n.curPage,"page-sizes":[12,24,36,42,48],"page-size":n.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:n.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])),_:1},8,["modelValue","onClose","width"])])}],["__scopeId","data-v-e1085942"]]),E={class:"upload-wrap"},q={class:"upload-wrap-inline mb16 clearfix"},A={class:"leval-item"},M={class:"move-type"},O=["onClick"],Q={class:"leval-item upload-btn"},X={class:"fileContainer"},Y={class:"file-type"},G=["onClick"],H=["onClick"],J=["onClick"],K={class:"file-content"},R={class:"fileContainerUI clearfix"},Z=["onClick"],ee={key:0,class:"selectedIcon"},te={class:"iconBox"},ie=["scr"],ae=["src"],le={class:"desc"},se=["onClick"],oe={class:"pagination-wrap"};const ce=g({components:{AddCategory:w,System:$},data:()=>({dialogWidth:"910px",activeType:null,typeList:[],imageUrl:null,dialogVisible:!0,fileList:[],addLoading:!1,this_config:{total:1,file_type:"image"},record:0,loading:!0,tableData:[],pageSize:36,totalDataNumber:0,curPage:1,isShowCategory:!1,isShowSystemPicture:!1,category:null,system:null,fileIds:[],accept:""}),props:["config","uploadimage","selectedIndex"],created(){if("[object object]"===Object.prototype.toString.call(this.config).toLowerCase()){for(let e in this.config)this.this_config[e]=this.config[e];"image"==this.this_config.file_type?this.accept="image/jpeg,image/png,image/jpg":this.accept="video/mp4"}this.getFileCategory(),this.getData()},methods:{getFileCategory(){let e=this;r.fileCategory({type:e.this_config.file_type},!0).then((t=>{e.typeList=[{group_id:null,group_name:"全部"}].concat(t.data.group_list)})).catch((t=>{e.loading=!1}))},addCategory(){this.isShowCategory=!0,this.category=null},addSystem(){this.isShowSystemPicture=!0,this.system=null},editCategoryFunc(e){this.isShowCategory=!0,this.category=e},closeCategoryFunc(e){null!=e&&this.getFileCategory(),this.isShowCategory=!1},closeSystemFunc(e){this.isShowSystemPicture=!1,e&&this.$emit("returnImgs",e)},deleteCategoryFunc(e){l.confirm("此操作將永久刪除該記錄, 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.deleteCategory(e)})).catch((()=>{s({type:"info",message:"已取消刪除"})}))},deleteCategory(e){let t=this;r.deleteCategory({group_id:e}).then((e=>{s({message:"刪除成功",type:"success"}),t.getFileCategory()})).catch((e=>{s.error("刪除失敗")}))},selectTypeFunc(e){this.activeType=e,this.curPage=1,this.getData()},handleCurrentChange(e){this.curPage=e,this.getData()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getData()},getData:function(){let e=this,t={page:e.curPage,pageSize:e.pageSize,group_id:e.activeType,type:e.this_config.file_type};r.fileList(t,!0).then((t=>{e.loading=!1,e.fileList=t.data.file_list,e.totalDataNumber=e.fileList.total})).catch((t=>{e.loading=!1}))},moveTypeFunc(e){let t=this,i=[];t.fileList.data.forEach((e=>{e.selected&&i.push(e.file_id)})),0!=i.length?l.confirm("確定移動選中的檔案嗎, 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{r.moveFile({group_id:e,fileIds:i},!0).then((e=>{s({message:"移動成功",type:"success"}),t.getFileCategory(),t.getData()})).catch((e=>{}))})).catch((()=>{})):s({message:"請選擇檔案",type:"warning"})},fileChange(e){},onBeforeUploadImage:e=>!0,UploadImage(e){let t=this;const i=o.service({lock:!0,text:"圖片上傳中,請等待",background:"rgba(0, 0, 0, 0.7)"}),a=new FormData;a.append("iFile",e.file),a.append("group_id",t.activeType),a.append("file_type",t.this_config.file_type),r.uploadFile(a).then((a=>{i.close(),t.getData(),e.onSuccess()})).catch((t=>{i.close(),s({message:"本次上傳圖片失敗",type:"warning"}),e.onError()}))},selectFileFunc(e,t){if(e.selected)e.selected=!1,this.record--;else{if(e.selected=!0,this.record++,this.record>=this.this_config.total)return void s({message:"本次最多隻能上傳 "+this.this_config.total+" 個檔案",type:"warning"});e.selected=!0,this.record++}},deleteFileFunc(e){let t=this;l.confirm("此操作將永久刪除該記錄, 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((()=>{const i=o.service({lock:!0,text:"圖片上傳中,請等待",background:"rgba(0, 0, 0, 0.7)"});let a=[];if(e)a.push(e.file_id);else for(let e=0;e<t.fileList.data.length;e++){let i=t.fileList.data[e];i.selected&&a.push(i.file_id)}r.deleteFiles({fileIds:a},!0).then((e=>{i.close(),s({message:"刪除成功",type:"success"}),t.getData()})).catch((e=>{i.close()}))})).catch((()=>{loading.close(),s({message:"刪除失敗",type:"warning"})}))},confirmFunc(){let e=[],t=0;for(let i=0;i<this.fileList.data.length;i++){let a=this.fileList.data[i];if(a.selected){let i={file_id:a.file_id,file_path:a.file_path};e.push(i),t++}if(t>this.this_config.total)break}this.$emit("returnImgs",e)},cancelFunc(){this.$emit("returnImgs",null)}}},[["render",function(l,s,o,r,g,L){const T=i,x=c,D=n,I=d("Edit"),P=e,j=d("Delete"),V=d("Select"),U=t,B=a,N=w,W=$;return p(),u("div",E,[h(B,{title:"檔案管理",modelValue:g.dialogVisible,"onUpdate:modelValue":s[3]||(s[3]=e=>g.dialogVisible=e),"close-on-click-modal":!1,"custom-class":"upload-dialog","close-on-press-escape":!1,onClose:L.cancelFunc,width:g.dialogWidth,"append-to-body":!0},{footer:f((()=>[h(T,{size:"small",onClick:L.cancelFunc},{default:f((()=>[m("取 消")])),_:1},8,["onClick"]),h(T,{size:"small",type:"primary",onClick:L.confirmFunc},{default:f((()=>[m("確 定")])),_:1},8,["onClick"])])),default:f((()=>[y("div",q,[y("div",A,[h(T,{size:"small",icon:"Plus",onClick:L.addCategory},{default:f((()=>[m("新增分類")])),_:1},8,["onClick"]),h(x,{placement:"bottom",width:"200",trigger:"click",value:!0},{reference:f((()=>[h(T,{size:"small",icon:"CaretBottom"},{default:f((()=>[m("移動至")])),_:1})])),default:f((()=>[y("ul",M,[(p(!0),u(C,null,_(g.typeList,((e,t)=>(p(),u("li",{key:t,onClick:t=>L.moveTypeFunc(e.group_id)},F(e.group_name),9,O)))),128))])])),_:1}),h(T,{size:"small",type:"danger",icon:"Delete",onClick:s[0]||(s[0]=e=>L.deleteFileFunc(!1))},{default:f((()=>[m("批次刪除")])),_:1}),null!=o.selectedIndex?(p(),b(T,{key:0,size:"small",type:"danger",icon:"Menu",style:{"background-color":"#FF7300"},onClick:L.addSystem},{default:f((()=>[m(" 系統圖標")])),_:1},8,["onClick"])):v("",!0)]),y("div",Q,[h(D,{class:"avatar-uploader",multiple:"",ref:"upload",action:"string",accept:g.accept,"before-upload":L.onBeforeUploadImage,"http-request":L.UploadImage,"show-file-list":!1,"on-change":L.fileChange},{default:f((()=>[h(T,{size:"small",icon:"Upload",type:"primary"},{default:f((()=>[m("點選上傳")])),_:1})])),_:1},8,["accept","before-upload","http-request","on-change"])])]),y("div",X,[y("div",Y,[y("ul",null,[(p(!0),u(C,null,_(g.typeList,((e,t)=>(p(),u("li",{class:k(g.activeType==e.group_id?"item active":"item"),key:t,onClick:t=>L.selectTypeFunc(e.group_id)},[m(F(e.group_name)+" ",1),null!=e.group_id?(p(),u("div",{key:0,class:"operation",onClick:s[1]||(s[1]=z((()=>{}),["stop"]))},[y("p",{onClick:t=>L.editCategoryFunc(e)},[h(P,null,{default:f((()=>[h(I)])),_:1})],8,H),y("p",{onClick:t=>L.deleteCategoryFunc(e.group_id)},[h(P,null,{default:f((()=>[h(j)])),_:1})],8,J)])):v("",!0)],10,G)))),128))])]),y("div",K,[y("ul",R,[(p(!0),u(C,null,_(g.fileList.data,((e,t)=>(p(),u("li",{class:"file",key:t,onClick:i=>L.selectFileFunc(e,t)},[1==e.selected?(p(),u("div",ee,[y("div",te,[h(P,null,{default:f((()=>[h(V)])),_:1})])])):v("",!0),"image"==g.this_config.file_type?(p(),u("img",{key:1,scr:e.file_path,style:S("background-image:url("+e.file_path+")"),alt:""},null,12,ie)):v("",!0),"video"==g.this_config.file_type?(p(),u("video",{key:2,height:"100",width:"100",src:e.file_path,autoplay:!1}," 您的瀏覽器不支援 video 標籤 ",8,ae)):v("",!0),y("p",le,F(e.real_name),1),y("div",{class:"bottom-shade",onClick:s[2]||(s[2]=z((()=>{}),["stop"]))},[y("a",{href:"javascript:void(0)",onClick:t=>L.deleteFileFunc(e)},[h(P,null,{default:f((()=>[h(j)])),_:1})],8,se)])],8,Z)))),128))])])]),y("div",oe,[h(U,{onSizeChange:L.handleSizeChange,onCurrentChange:L.handleCurrentChange,"current-page":g.curPage,"page-sizes":[12,24,36,42,48],"page-size":g.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:g.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])),_:1},8,["modelValue","onClose","width"]),g.isShowCategory?(p(),b(N,{key:0,category:g.category,file_type:g.this_config.file_type,onCloseCategory:L.closeCategoryFunc},null,8,["category","file_type","onCloseCategory"])):v("",!0),g.isShowSystemPicture?(p(),b(W,{key:1,system:g.system,onCloseSystem:L.closeSystemFunc},null,8,["system","onCloseSystem"])):v("",!0)])}],["__scopeId","data-v-18afb026"]]);export{ce as _};
