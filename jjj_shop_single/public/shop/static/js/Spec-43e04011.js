import{_ as e}from"./Specs-58a287cd.js";import{E as t,d as a,f as s,l,e as r,i as o}from"./element-plus-84a27f94.js";import{_ as i}from"./index-5ae5860a.js";import{m as c}from"./table-d3149ce0.js";import{o as d,c as p,P as n,S as u,a as m,W as _,X as h,Y as f,T as b,bb as v,b9 as j}from"./@vue-8fe4574d.js";import"./product-6ff3546d.js";import"./@vueuse-3cd91d51.js";import"./lodash-es-656e9c2f.js";import"./async-validator-cf877c1f.js";import"./dayjs-9faf8871.js";import"./call-bind-0c463fe3.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-06559b09.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-49f0fa2f.js";import"./pinia-265da389.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-b80b041e.js";import"./side-channel-ba7aab8a.js";import"./object-inspect-860361a9.js";import"./vue-clipboard2-f8268db2.js";import"./clipboard-dd0324d2.js";import"./vue-ueditor-wrap-dff311b3.js";const k={components:{Specs:e},data(){return{excludeIds:[],isspecs:!1,curProduct:{},curIndex:-1,specType:!1,SpecExcludeIds:[],all_advance_price:null,all_advance_stock:null,rulesProduct:[{validator:(e,t,a)=>{if(t.length<1)return a(new Error("請選擇商品"));{let e=!1;for(let t=0;t<this.form.tableData.length;t++){let a=this.form.tableData[t];if(!e){let t=""==a.advance_price||""==a.advance_stock||""==a.limit_num||""==a.sort,s=0==parseFloat(a.advance_price)||parseInt(a.advance_stock)<1||parseInt(a.limit_num)<1;(t||s)&&(e=!0)}parseInt(a.advance_stock)>0?a.stockValid=!0:a.stockValid=!1,parseInt(a.advance_price)>0?a.priceValid=!0:a.priceValid=!1,parseInt(a.limit_num)>0?a.limit_numValid=!0:a.limit_numValid=!1,parseInt(a.sort)>0?a.sortValid=!0:a.sortValid=!1,this.form.tableData[t]=a}if(e)return a(new Error("請填寫正確的資訊"));a()}},required:!0,trigger:"blur"}]}},inject:["form","type"],created(){this.creatSpec()},methods:{creatSpec(e){this.form.tableData=c(this.form.tableData)},specsFunc(e,t,a){this.curProduct=t,this.curIndex=e;let s=[];a?(this.specType=!0,this.form.tableData.forEach((e=>{this.curProduct.product_id==e.product_id&&s.push(e.product_sku_id)}))):this.specType=!1,this.SpecExcludeIds=s,this.isspecs=!0},closeSpecs(e){if(this.isspecs=!1,"success"==e.type){let t=[];for(let s=0;s<e.params.length;s++){let a=e.params[s],l={product_name:this.curProduct.product_name,product_id:this.curProduct.product_id,spec_type:this.curProduct.spec_type,product_sku_id:this.curProduct.product_sku_id,advance_product_id:this.curProduct.advance_product_id,product_price:a.spec_form.product_price,stock_num:a.product_stock,sales_num:0,spec_name:a.spec_name,product_sku_id:a.product_sku_id,advance_price:null,advance_stock:0,limit_num:1,sort:100,tempProduct:!0,is_delete:0,advance_product_sku_id:0,sales_initial:0};t.push(l)}let a=[this.curIndex,this.specType?0:1].concat(t);this.form.tableData.splice(...a),this.form.tableData=c(this.form.tableData)}},deleteClick(e,a){let s=this.form.tableData[e];if(a){for(let e=0;e<this.form.tableData.length;e++){let a=this.form.tableData[e];if(s.product_id==a.product_id&&a.sales_num>0)return void t({message:"已售商品不能刪除！",type:"warning"})}for(let t=0;t<this.form.tableData.length;t++){let a=this.form.tableData[t];if(s.product_id==a.product_id){if("edit"==this.type&&1!=e.tempProduct){let e=a.advance_product_id;this.form.product_del_ids.push(e)}this.form.tableData.splice(t,1),t--}}}else{if(parseInt(e.sales_num)>0)return void t({message:"已售商品規格不能刪除！",type:"warning"});let a=0;for(let e=0;e<this.form.tableData.length;e++){let t=this.form.tableData[e];if(s.product_id==t.product_id&&(a++,a>1))break}a>1?this.form.tableData.splice(e,1):s.spec_name=null}this.form.tableData=c(this.form.tableData)},objectSpanMethod({row:e,column:t,rowIndex:a,columnIndex:s}){if(0===s)return null!=e.rowSpan?{rowspan:e.rowSpan,colspan:1}:{rowspan:0,colspan:0}},allApply(){for(let e=0;e<this.form.tableData.length;e++){let t=this.form.tableData[e];parseFloat(this.all_advance_price)>parseFloat(t.product_price)?t.advance_price=t.product_price:t.advance_price=this.all_advance_price,t.advance_stock=this.all_advance_stock>=0?this.all_advance_stock:t.advance_stock}},showFunc(e,t){0===t.is_delete?t.is_delete=1:t.is_delete=0}}},w=e=>(v("data-v-5db55d7f"),e=e(),j(),e),y=w((()=>m("div",{class:"common-form"},"規格",-1))),D={class:"ww100"},x={class:"d-s-c max-w460 active-all-set"},V=w((()=>m("div",{style:{width:"60px"}},"批次設定：",-1))),I={class:"flex-1 ml10"},g={class:"flex-1 ml10"},P={class:"ml10"},S={class:"pt16 ww100"},C={class:"text-ellipsis-2"},E={key:0,class:"gray"},z={key:1},F={key:0,class:"spec-min-box"},U=["title"];const T=i(k,[["render",function(t,i,c,v,j,k){const w=a,T=s,A=l,M=r,q=o,L=e;return d(),p("div",null,[y,n(M,{label:"商品管理",prop:"tableData",rules:j.rulesProduct},{default:u((()=>[m("div",D,[m("div",x,[V,m("div",I,[n(w,{modelValue:j.all_advance_price,"onUpdate:modelValue":i[0]||(i[0]=e=>j.all_advance_price=e),type:"number",min:"0",placeholder:"尾款立減"},null,8,["modelValue"])]),m("div",g,[n(w,{modelValue:j.all_advance_stock,"onUpdate:modelValue":i[1]||(i[1]=e=>j.all_advance_stock=e),type:"number",min:"0",placeholder:"總庫存"},null,8,["modelValue"])]),m("div",P,[n(T,{onClick:k.allApply},{default:u((()=>[_("應用")])),_:1},8,["onClick"])])])]),m("div",S,[n(q,{size:"small",data:k.form.tableData,"span-method":k.objectSpanMethod,border:"",style:{width:"100%"}},{default:u((()=>[n(A,{label:"商品名稱",width:"300"},{default:u((e=>[m("p",C,h(e.row.product_name),1)])),_:1}),n(A,{label:"規格",width:"180"},{default:u((e=>[10==e.row.spec_type?(d(),p("div",E,"暫無規格")):f("",!0),20==e.row.spec_type?(d(),p("div",z,[null!=e.row.spec_name&&""!=e.row.spec_name?(d(),p("div",F,[m("p",{class:"text-ellipsis",title:e.row.spec_name},h(e.row.spec_name),9,U)])):(d(),b(T,{key:1,size:"small",icon:"Plus",disabled:"",onClick:t=>k.specsFunc(e.$index,e.row)},{default:u((()=>[_("新增規格")])),_:2},1032,["onClick"]))])):f("",!0)])),_:1}),n(A,{prop:"product_price",label:"售價"}),n(A,{label:"尾款立減金額(加上定金金額)"},{default:u((e=>[n(M,{label:"",style:{"margin-bottom":"0"}},{default:u((()=>[n(w,{size:"small",type:"number",min:"0",step:"0.01",modelValue:e.row.advance_price,"onUpdate:modelValue":t=>e.row.advance_price=t},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1}),n(A,{label:"庫存總量"},{default:u((e=>[n(M,{label:"",style:{"margin-bottom":"0"}},{default:u((()=>[n(w,{size:"small",type:"number",min:"0",step:"1",modelValue:e.row.advance_stock,"onUpdate:modelValue":t=>e.row.advance_stock=t},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1})])),_:1},8,["data","span-method"])])])),_:1},8,["rules"]),n(L,{isspecs:j.isspecs,productId:j.curProduct.product_id,excludeIds:j.SpecExcludeIds,islist:!0,onClose:k.closeSpecs},null,8,["isspecs","productId","excludeIds","onClose"])])}],["__scopeId","data-v-5db55d7f"]]);export{T as default};
