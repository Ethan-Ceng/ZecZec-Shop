import{l as e,d as t,e as o,i as s,c as a,q as l}from"./element-plus-84a27f94.js";import{P as i}from"./pointproduct-cdf8cedb.js";import{_ as r}from"./index-5ae5860a.js";import{o as p,T as d,S as c,P as n,c as u,Q as m,a9 as _,W as f,X as h}from"./@vue-8fe4574d.js";import"./@vueuse-3cd91d51.js";import"./lodash-es-656e9c2f.js";import"./async-validator-cf877c1f.js";import"./dayjs-9faf8871.js";import"./call-bind-0c463fe3.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-06559b09.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-49f0fa2f.js";import"./pinia-265da389.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-b80b041e.js";import"./side-channel-ba7aab8a.js";import"./object-inspect-860361a9.js";import"./vue-clipboard2-f8268db2.js";import"./clipboard-dd0324d2.js";import"./vue-ueditor-wrap-dff311b3.js";const b=r({data:()=>({form1:{deduct_stock_type:10,status:0,product_id:0,sort:1},formLabelWidth:"120px",loading:!1,dialogVisible:!1,point_product_id:0,productDetail:{spec_type:10,sku:{},specData:{}}}),props:["open_edit","userModel"],created(){this.dialogVisible=this.open_edit,this.point_product_id=this.userModel.point_product_id,this.getData()},methods:{getData(){let e=this,t=e.point_product_id;i.getProductData({point_product_id:t},!0).then((t=>{e.form1=t.data.data,e.form1.product_id=t.data.data.product_id,e.productDetail.spec_type=e.form1.product.spec_type,e.productDetail.specData=t.data.specData,e.buildSkulist()})).catch((t=>{e.loading=!1}))},buildSkulist:function(){for(var e=this,t=e.productDetail.specData.spec_attr,o=[],s=0;s<t.length;s++)o.push(t[s].spec_items);var a=e.calcDescartes(o),l=[];for(s=0;s<a.length;s++){var i=[],r=[];Array.isArray(a[s])?i=a[s]:i.push(a[s]);for(var p=0;p<i.length;p++)r.push(i[p].item_id);l.push({spec_sku_id:r.join("_"),rows:i,spec_form:{}})}if(e.productDetail.specData.spec_list.length>0&&l.length>0)for(s=0;s<l.length;s++){var d=e.productDetail.specData.spec_list.filter((function(e){return e.spec_sku_id===l[s].spec_sku_id}));d.length>0&&(l[s].spec_form=d[0].spec_form,l[s].spec_form.product_sku_id=d[0].product_sku_id),(d=e.form1.sku.filter((function(e){return e.product_sku_id===l[s].spec_form.product_sku_id}))).length>0&&(l[s].spec_form.point_money=d[0].point_money,l[s].spec_form.point_num=d[0].point_num,l[s].spec_form.stock=d[0].stock,l[s].spec_form.point_product_sku_id=d[0].point_product_sku_id)}e.productDetail.specData.spec_list=l},calcDescartes:function(e){return e.length<2?e[0]||[]:[].reduce.call(e,(function(e,t){var o=[];return e.forEach((function(e){t.forEach((function(t){var s=[].concat(Array.isArray(e)?e:[e]);s.push(t),o.push(s)}))})),o}))},objectSpanMethod({row:e,column:t,rowIndex:o,columnIndex:s}){var a=this.productDetail.specData.spec_attr,l=1;if(s<a.length-1){let e=s+1,t=a.length-1;for(var i=e;i<=t;i++)l*=a[i].spec_items.length;return o%l==0?{rowspan:l,colspan:1}:{rowspan:0,colspan:0}}},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},[["render",function(i,r,b,g,j,D){const y=e,k=t,V=o,w=s,v=a,x=l;return p(),d(x,{title:"商品規格",modelValue:j.dialogVisible,"onUpdate:modelValue":r[0]||(r[0]=e=>j.dialogVisible=e),onClose:D.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"600px"},{default:c((()=>[n(v,{size:"small",ref:"form",model:j.form1,"label-width":"250px",loading:j.loading},{default:c((()=>[n(V,{label:"","label-width":"20px"},{default:c((()=>[n(w,{data:j.productDetail.specData.spec_list,"span-method":D.objectSpanMethod,border:"",style:{width:"100%","margin-top":"20px"}},{default:c((()=>[(p(!0),u(m,null,_(j.productDetail.specData.spec_attr,((e,t)=>(p(),d(y,{width:"180",label:e.group_name,key:e.group_name},{default:c((e=>[f(h(e.row.rows[t].spec_value),1)])),_:2},1032,["label"])))),128)),n(y,{label:"兌換積分"},{default:c((e=>[n(V,{label:"",style:{"margin-bottom":"0"}},{default:c((()=>[n(k,{size:"small",type:"number",modelValue:e.row.spec_form.point_num,"onUpdate:modelValue":t=>e.row.spec_form.point_num=t,disabled:!0},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1}),n(y,{label:"兌換金額"},{default:c((e=>[n(V,{label:"",style:{"margin-bottom":"0"}},{default:c((()=>[n(k,{size:"small",type:"number",modelValue:e.row.spec_form.point_money,"onUpdate:modelValue":t=>e.row.spec_form.point_money=t,disabled:!0},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1}),n(y,{label:"活動庫存"},{default:c((e=>[n(V,{label:"",style:{"margin-bottom":"0"}},{default:c((()=>[n(k,{size:"small",type:"number",modelValue:e.row.spec_form.stock,"onUpdate:modelValue":t=>e.row.spec_form.stock=t,disabled:!0},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1})])),_:1},8,["data","span-method"])])),_:1})])),_:1},8,["model","loading"])])),_:1},8,["modelValue","onClose"])}]]);export{b as default};
