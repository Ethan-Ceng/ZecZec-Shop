import{E as e,a as l,K as o,d as a,f as t,l as s,e as p,m as d,g as r,i as m}from"./element-plus-84a27f94.js";import{P as i}from"./product-6ff3546d.js";import{o as c,c as u,a as n,Q as _,a9 as f,X as h,P as g,S as y,W as b,Y as V,$ as w,a0 as v,bb as k,b9 as j,ap as x,T as G,ae as U}from"./@vue-8fe4574d.js";import{_ as z}from"./index-5ae5860a.js";import{_ as A}from"./Upload-71ca9325.js";import"./@vueuse-3cd91d51.js";import"./lodash-es-656e9c2f.js";import"./async-validator-cf877c1f.js";import"./dayjs-9faf8871.js";import"./call-bind-0c463fe3.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-06559b09.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-49f0fa2f.js";import"./pinia-265da389.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-b80b041e.js";import"./side-channel-ba7aab8a.js";import"./object-inspect-860361a9.js";import"./vue-clipboard2-f8268db2.js";import"./clipboard-dd0324d2.js";import"./vue-ueditor-wrap-dff311b3.js";import"./file-b7a04c7e.js";/* empty css                                                               */import"./AddCategory-69aab672.js";const D={data:()=>({showAddGroupBtn:!0,showAddGroupForm:!1,addGroupFrom:{specName:"",specValue:""},groupLoading:!1}),inject:["form"],created(){this.form.model.spec_many&&this.form.model.spec_many.spec_list.length>0&&this.buildSkulist()},methods:{onToggleAddGroupForm:function(){this.showAddGroupBtn=!this.showAddGroupBtn,this.showAddGroupForm=!this.showAddGroupForm},onSubmitAddGroup:function(){let l=this;if(""===l.addGroupFrom.specName||""===l.addGroupFrom.specValue)return e("請填寫規則名或規則值"),!1;l.groupLoading=!0;let o={spec_name:l.addGroupFrom.specName,spec_value:l.addGroupFrom.specValue};i.addSpec(o,!0).then((e=>{l.groupLoading=!1,l.form.model.spec_many.spec_attr.push({group_id:e.data.spec_id,group_name:l.addGroupFrom.specName,spec_items:[{item_id:e.data.spec_value_id,spec_value:l.addGroupFrom.specValue}],tempValue:"",loading:!1}),l.addGroupFrom.specName="",l.addGroupFrom.specValue="",l.onToggleAddGroupForm(),l.buildSkulist()})).catch((e=>{l.groupLoading=!1}))},onSubmitAddValue:function(l){let o=this;if(!l.hasOwnProperty("tempValue")||""===l.tempValue)return e("規格值不能為空"),!1;l.loading=!0;let a={spec_id:l.group_id,spec_value:l.tempValue};i.addSpecValue(a,!0).then((e=>{l.loading=!1,l.spec_items.push({item_id:e.data.spec_value_id,spec_value:l.tempValue}),l.tempValue="",o.buildSkulist()})).catch((e=>{l.loading=!1}))},buildSkulist:function(){let e=this,l=e.form.model.spec_many.spec_attr,o=[];for(let s=0;s<l.length;s++)o.push(l[s].spec_items);let a=e.calcDescartes(o),t=[];for(let s=0;s<a.length;s++){let e=[],l=[];Array.isArray(a[s])?e=a[s]:e.push(a[s]);for(let o=0;o<e.length;o++)l.push(e[o].item_id);t.push({product_sku_id:0,spec_sku_id:l.join("_"),rows:e,spec_form:{}})}if(e.form.model.spec_many.spec_list.length>0&&t.length>0)for(let s=0;s<t.length;s++){let l=e.form.model.spec_many.spec_list.filter((function(e){return e.spec_sku_id===t[s].spec_sku_id}));l.length>0&&(t[s].spec_form=l[0].spec_form,t[s].product_sku_id=l[0].product_sku_id)}e.form.model.spec_many.spec_list=t},calcDescartes:function(e){return e.length<2?e[0]||[]:[].reduce.call(e,(function(e,l){let o=[];return e.forEach((function(e){l.forEach((function(l){let a=[].concat(Array.isArray(e)?e:[e]);a.push(l),o.push(a)}))})),o}))},onDeleteGroup:function(e){var o=this;l.confirm("刪除後不可恢復，確認刪除該記錄嗎?","提示",{type:"warning"}).then((()=>{o.form.model.spec_many.spec_attr.splice(e,1),o.buildSkulist()}))},onDeleteValue:function(o,a){let t=this;t.form.isSpecLocked?e({message:"本商品正在搞活動，不能刪除規格！",type:"warning"}):l.confirm("刪除後不可恢復，確認刪除該記錄嗎?","提示",{type:"warning"}).then((()=>{t.form.model.spec_many.spec_attr[o].spec_items.splice(a,1),t.buildSkulist()}))}}},F=e=>(k("data-v-3532ee49"),e=e(),j(),e),S={class:"spec-many-type"},C={class:"spec-wrap"},I={class:"spec-hd"},T={class:"input-box"},B={class:"spec-bd"},L={class:"item"},N={class:"item"},$={key:1},q={class:"add-spec mb16"},E={class:"from-box"},P={class:"item"},M=F((()=>n("span",{class:"key"},"規格名：",-1))),O={class:"item"},R=F((()=>n("span",{class:"key"},"規格值：",-1)));const K={class:"mt16"},Q=["onClick"];const W=z({components:{Type:z(D,[["render",function(e,l,s,p,d,r){var m,i,k;const j=o,x=a,G=t;return c(),u("div",S,[n("div",C,[r.form.model&&r.form.model.spec_many&&r.form.model.spec_many.spec_attr?(c(!0),u(_,{key:0},f(r.form.model.spec_many.spec_attr,((e,l)=>(c(),u("div",{class:"mb16 min-spc",key:e.group_name},[n("div",I,[n("div",T,h(e.group_name),1)]),n("div",B,[(c(!0),u(_,null,f(e.spec_items,((e,o)=>(c(),u("div",{class:"item",key:e.spec_value},[g(j,{closable:"",onClose:e=>r.onDeleteValue(l,o)},{default:y((()=>[b(h(e.spec_value),1)])),_:2},1032,["onClose"])])))),128)),n("div",L,[g(x,{size:"small",modelValue:e.tempValue,"onUpdate:modelValue":l=>e.tempValue=l,style:{width:"160px"}},null,8,["modelValue","onUpdate:modelValue"])]),n("div",N,[g(G,{size:"small",onClick:l=>r.onSubmitAddValue(e),loading:e.loading},{default:y((()=>[b("新增")])),_:2},1032,["onClick","loading"])])])])))),128)):V("",!0),r.form.isSpecLocked||0!==(null==(k=null==(i=null==(m=r.form.model)?void 0:m.spec_many)?void 0:i.spec_attr)?void 0:k.length)?V("",!0):(c(),u("div",$,[w(g(G,{size:"small",class:"el-icon-circle-plus",onClick:r.onToggleAddGroupForm},{default:y((()=>[b("新增規格")])),_:1},8,["onClick"]),[[v,d.showAddGroupBtn]])])),w(n("div",q,[n("div",E,[n("div",P,[M,g(x,{size:"small",modelValue:d.addGroupFrom.specName,"onUpdate:modelValue":l[0]||(l[0]=e=>d.addGroupFrom.specName=e),placeholder:"請輸入規格名稱"},null,8,["modelValue"])]),n("div",O,[R,g(x,{size:"small",modelValue:d.addGroupFrom.specValue,"onUpdate:modelValue":l[1]||(l[1]=e=>d.addGroupFrom.specValue=e),placeholder:"請輸入規格值"},null,8,["modelValue"])]),g(G,{type:"primary",size:"small",loading:d.groupLoading,onClick:r.onSubmitAddGroup,plain:""},{default:y((()=>[b("確定")])),_:1},8,["loading","onClick"]),g(G,{size:"small",onClick:r.onToggleAddGroupForm},{default:y((()=>[b("取消")])),_:1},8,["onClick"])])],512),[[v,!d.showAddGroupBtn]])])])}],["__scopeId","data-v-3532ee49"]]),Table:z({components:{Upload:A},data:()=>({batchData:{detail:"",type:0,product_price:"",line_price:"",low_price:"",stock_num:"",product_weight:""},isupload:!1,spec_index:-1}),inject:["form"],created(){},methods:{objectSpanMethod({row:e,column:l,rowIndex:o,columnIndex:a}){var t=this.form.model.spec_many.spec_attr,s=1;if(a<t.length-1){let e=a+1,l=t.length-1;for(var p=e;p<=l;p++)s*=t[p].spec_items.length;return o%s==0?{rowspan:s,colspan:1}:{rowspan:0,colspan:0}}},onSubmitBatchData:function(){var e=this;e.form.model.spec_many.spec_list.forEach((function(l){for(var o in e.batchData)e.batchData.hasOwnProperty(o)&&e.batchData[o]&&(l.spec_form[o]=e.batchData[o])}))},chooseSpecImage:function(e){this.isupload=!0,this.spec_index=e},returnImgsFunc(e){this.isupload=!1,this.form.model.spec_many.spec_list[this.spec_index].spec_form.image_id=e[0].file_id,this.form.model.spec_many.spec_list[this.spec_index].spec_form.image_path=e[0].file_path}}},[["render",function(e,l,o,i,v,k){const j=a,U=t,z=s,D=p,F=d,S=r,C=m,I=A,T=x("img-url");return c(),u("div",K,[k.form.model.spec_many&&k.form.model.spec_many.spec_list.length>0?(c(),G(D,{key:0,label:"規格明細："},{default:y((()=>[n("div",null,[b(" 批次設定 "),g(j,{size:"small",modelValue:v.batchData.product_price,"onUpdate:modelValue":l[0]||(l[0]=e=>v.batchData.product_price=e),placeholder:"銷售價",style:{width:"160px","padding-left":"4px"}},null,8,["modelValue"]),g(j,{size:"small",modelValue:v.batchData.line_price,"onUpdate:modelValue":l[1]||(l[1]=e=>v.batchData.line_price=e),placeholder:"劃線價",style:{width:"160px","padding-left":"4px"}},null,8,["modelValue"]),g(j,{size:"small",modelValue:v.batchData.low_price,"onUpdate:modelValue":l[2]||(l[2]=e=>v.batchData.low_price=e),placeholder:"成本價",style:{width:"160px","padding-left":"4px"}},null,8,["modelValue"]),g(j,{size:"small",modelValue:v.batchData.stock_num,"onUpdate:modelValue":l[3]||(l[3]=e=>v.batchData.stock_num=e),placeholder:"庫存",style:{width:"160px","padding-left":"4px"}},null,8,["modelValue"]),g(j,{size:"small",modelValue:v.batchData.product_weight,"onUpdate:modelValue":l[4]||(l[4]=e=>v.batchData.product_weight=e),placeholder:"重量",style:{width:"160px","padding-left":"4px"}},null,8,["modelValue"]),g(U,{size:"small",onClick:k.onSubmitBatchData,style:{"margin-left":"4px"}},{default:y((()=>[b("應用")])),_:1},8,["onClick"])]),k.form.model&&k.form.model.spec_many&&k.form.model.spec_many.spec_attr?(c(),G(C,{key:0,size:"small",data:k.form.model.spec_many.spec_list,"span-method":k.objectSpanMethod,border:"",style:{width:"100%","margin-top":"20px"}},{default:y((()=>[(c(!0),u(_,null,f(k.form.model.spec_many.spec_attr,((e,l)=>(c(),G(z,{label:e.group_name,key:e.group_name},{default:y((e=>[b(h(e.row.rows[l].spec_value),1)])),_:2},1032,["label"])))),128)),g(z,{label:"詳情",width:"240"},{default:y((e=>[g(D,{label:"",rules:[{required:!0,message:" "}],style:{"margin-bottom":"0"},prop:"model.spec_many.spec_list."+e.$index+".spec_form.detail"},{default:y((()=>[g(j,{prop:"detail",modelValue:e.row.spec_form.detail,"onUpdate:modelValue":l=>e.row.spec_form.detail=l,autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1}),g(z,{label:"型別"},{default:y((e=>[g(D,{label:"",rules:[{required:!0,message:""}],style:{"margin-bottom":"0"},prop:"model.spec_many.spec_list."+e.$index+".spec_form.type"},{default:y((()=>[g(S,{modelValue:e.row.spec_form.type,"onUpdate:modelValue":l=>e.row.spec_form.type=l,size:"lager"},{default:y((()=>[g(F,{label:0},{default:y((()=>[b("主商品")])),_:1}),g(F,{label:1},{default:y((()=>[b("推薦加購")])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1}),g(z,{label:"規格圖片"},{default:y((e=>[w(n("img",{alt:"",width:35,height:35,onClick:l=>k.chooseSpecImage(e.$index)},null,8,Q),[[T,e.row.spec_form.image_path]])])),_:1}),g(z,{label:"商品條碼"},{default:y((e=>[g(D,{label:"",style:{"margin-bottom":"0"}},{default:y((()=>[g(j,{size:"small",prop:"product_no",modelValue:e.row.spec_form.product_no,"onUpdate:modelValue":l=>e.row.spec_form.product_no=l},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1}),g(z,{label:"銷售價"},{default:y((e=>[g(D,{label:"",rules:[{required:!0,message:" "}],prop:"model.spec_many.spec_list."+e.$index+".spec_form.product_price",style:{"margin-bottom":"0"}},{default:y((()=>[g(j,{size:"small",prop:"product_price",modelValue:e.row.spec_form.product_price,"onUpdate:modelValue":l=>e.row.spec_form.product_price=l},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1}),g(z,{label:"劃線價"},{default:y((e=>[g(D,{label:"",style:{"margin-bottom":"0"}},{default:y((()=>[g(j,{size:"small",prop:"line_price",modelValue:e.row.spec_form.line_price,"onUpdate:modelValue":l=>e.row.spec_form.line_price=l},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1}),g(z,{label:"成本價"},{default:y((e=>[g(D,{label:"",style:{"margin-bottom":"0"}},{default:y((()=>[g(j,{size:"small",prop:"low_price",modelValue:e.row.spec_form.low_price,"onUpdate:modelValue":l=>e.row.spec_form.low_price=l},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1}),g(z,{label:"庫存"},{default:y((e=>[g(D,{label:"",rules:[{required:!0,message:" "}],prop:"model.spec_many.spec_list."+e.$index+".spec_form.stock_num",style:{"margin-bottom":"0"}},{default:y((()=>[g(j,{size:"small",prop:"stock_num",modelValue:e.row.spec_form.stock_num,"onUpdate:modelValue":l=>e.row.spec_form.stock_num=l},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1}),g(z,{label:"重量(kg)"},{default:y((e=>[g(D,{label:"",rules:[{required:!0,message:" "}],prop:"model.spec_many.spec_list."+e.$index+".spec_form.product_weight",style:{"margin-bottom":"0"}},{default:y((()=>[g(j,{size:"small",prop:"product_weight",modelValue:e.row.spec_form.product_weight,"onUpdate:modelValue":l=>e.row.spec_form.product_weight=l},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1})])),_:1},8,["data","span-method"])):V("",!0)])),_:1})):V("",!0),v.isupload?(c(),G(I,{key:1,isupload:v.isupload,onReturnImgs:k.returnImgsFunc},{default:y((()=>[b("上傳圖片")])),_:1},8,["isupload","onReturnImgs"])):V("",!0)])}]])}},[["render",function(e,l,o,a,t,s){const p=U("Type"),d=U("Table");return c(),u("div",null,[g(p),g(d)])}]]);export{W as default};
