import{E as t,c as e,f as s}from"./element-plus-84a27f94.js";import{A as i}from"./assemble-a5e61415.js";import o from"./Basic-e80c97f9.js";import r from"./Datetime-ccf737d6.js";import a from"./Product-eb520c6d.js";import l from"./Other-22f4fa3b.js";import{m}from"./table-d3149ce0.js";import{_ as d}from"./index-5ae5860a.js";import{ae as p,o as c,c as _,a as u,P as n,S as f,W as b}from"./@vue-8fe4574d.js";import"./@vueuse-3cd91d51.js";import"./lodash-es-656e9c2f.js";import"./async-validator-cf877c1f.js";import"./dayjs-9faf8871.js";import"./call-bind-0c463fe3.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-06559b09.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./Upload-71ca9325.js";import"./file-b7a04c7e.js";/* empty css                                                               */import"./AddCategory-69aab672.js";import"./vue-router-49f0fa2f.js";import"./pinia-265da389.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-b80b041e.js";import"./side-channel-ba7aab8a.js";import"./object-inspect-860361a9.js";import"./vue-clipboard2-f8268db2.js";import"./clipboard-dd0324d2.js";import"./vue-ueditor-wrap-dff311b3.js";import"./Specs-58a287cd.js";import"./product-6ff3546d.js";import"./Product-14aa5af4.js";const j={class:"common-button-wrapper"};const h=d({components:{Basic:o,Datetime:r,ProductIndex:a,Other:l},data:()=>({form:{title:"",image_id:0,file_path:"",start_time:"",end_time:"",status:1,fail_type:0,is_single:0,sort:100,together_time:0,tableData:[],product_list:[]},loading:!1}),created(){this.form.assemble_activity_id=this.$route.query.assemble_activity_id,this.getData()},methods:{getData(){let t=this;t.loading=!0,i.editActive({assemble_activity_id:t.form.assemble_activity_id},!0).then((e=>{let s=e.data.detail;if(s.assemble_activity_id=t.form.assemble_activity_id,s.product_del_ids=[],s.tableData=[],e.data.product_list.length>0){let t=[];for(let s=0;s<e.data.product_list.length;s++){let i=e.data.product_list[s];for(let e=0;e<i.assembleSku.length;e++){let s=i.assembleSku[e],o={product_name:i.product.product_name,product_id:i.product.product_id,stock_num:i.product.product_stock,spec_name:s.product_attr,product_price:i.product.product_price,spec_type:i.product.spec_type,is_delete:i.is_delete,product_sku_id:s.product_sku_id,assemble_product_sku_id:s.assemble_product_sku_id,sales_num:i.total_sales,assemble_price:s.assemble_price,assemble_stock:s.assemble_stock,assemble_product_id:s.assemble_product_id,join_num:i.join_num,limit_num:0==e?i.limit_num:2,assemble_num:0==e?i.assemble_num:2,sort:0==e?i.sort:2,sales_initial:0==e?i.sales_initial:2};t.push(o)}}s.tableData=m(t)}t.form=s,t.loading=!1})).catch((e=>{t.loading=!1}))},onSubmit(){let e=this;null!=e.form.end_time&&""!=e.form.end_time?e.$refs.form.validate((s=>{if(s){e.form.product_list=e.tableFormet(e.form.tableData);let s=e.form;delete s.tableData,e.loading=!0,i.saveActive(s,!0).then((s=>{e.loading=!1,t({message:"恭喜你，修改成功",type:"success"}),e.cancelFunc()})).catch((t=>{e.loading=!1}))}})):t({message:"請填寫活動結束時間",type:"error"})},tableFormet(t){let e=[],s=[],i=null;for(let o=0;o<t.length;o++){let r=t[o],a={product_sku_id:r.product_sku_id,assemble_stock:r.assemble_stock,assemble_price:r.assemble_price,product_attr:r.spec_name,assemble_product_sku_id:r.assemble_product_sku_id,product_price:r.product_price,sales_initial:r.sales_initial};null==i&&(i=r),i.product_id!=r.product_id&&(i.spec_list=e,s.push(i),i=r,e=[]),e.push(a)}return i.spec_list=e,s.push(i),s},cancelFunc(){this.$router.back(-1)}}},[["render",function(t,i,o,r,a,l){const m=p("Basic"),d=p("Datetime"),h=p("ProductIndex"),v=p("Other"),y=e,g=s;return c(),_("div",null,[u("div",null,[n(y,{size:"small",ref:"form",model:a.form,"label-width":"150px"},{default:f((()=>[n(m,{form:a.form},null,8,["form"]),n(d,{form:a.form},null,8,["form"]),n(h,{form:a.form,type:"edit"},null,8,["form"]),n(v,{form:a.form},null,8,["form"])])),_:1},8,["model"])]),u("div",j,[n(g,{size:"small",onClick:l.cancelFunc},{default:f((()=>[b("取消")])),_:1},8,["onClick"]),n(g,{size:"small",type:"primary",onClick:l.onSubmit,disabled:a.loading},{default:f((()=>[b("提交")])),_:1},8,["onClick","disabled"])])])}]]);export{h as default};
