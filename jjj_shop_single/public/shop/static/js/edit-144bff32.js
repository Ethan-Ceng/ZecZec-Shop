import{E as e,x as l,y as a,d as o,e as t,m as d,g as r,J as i,f as s,l as u,i as p,K as m,c,v as n}from"./element-plus-84a27f94.js";import{_}from"./category-c676c94f.js";import{P as f}from"./Product-14aa5af4.js";import{C as y}from"./coupon-7cc893e2.js";import{_ as g,f as b}from"./index-5ae5860a.js";import{ap as h,$ as V,o as v,c as j,P as x,S as k,Q as C,W as U,Y as w,T as D,a as q,a9 as z,X as I,bb as F,b9 as P}from"./@vue-8fe4574d.js";import"./@vueuse-3cd91d51.js";import"./lodash-es-656e9c2f.js";import"./async-validator-cf877c1f.js";import"./dayjs-9faf8871.js";import"./call-bind-0c463fe3.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-06559b09.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./product-6ff3546d.js";import"./vue-router-49f0fa2f.js";import"./pinia-265da389.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-b80b041e.js";import"./side-channel-ba7aab8a.js";import"./object-inspect-860361a9.js";import"./vue-clipboard2-f8268db2.js";import"./clipboard-dd0324d2.js";import"./vue-ueditor-wrap-dff311b3.js";const $={components:{Product:f,Category:_},data:()=>({activeName:"1",form:{coupon_id:"",name:"",color:"",coupon_type:"",reduce_price:"",discount:"",min_price:"",expire_type:"",expire_day:"",active_time:"",total_num:"",show_center:1,free_limit:0,sort:1,apply_range:10,max_price:""},list:{},loading:!0,pickerOptions0:{disabledDate:e=>e.getTime()<Date.now()-864e5},is_category:!1,is_product:!1,exclude_ids:[],product_list:[],category_list:{second:[],first:[]},category_ids:[]}),created(){let e=this.$route.query.coupon_id;this.getData(e)},methods:{hasImages:e=>e||"",getData(e){let l=this;y.getEditCoupon({coupon_id:e},!0).then((e=>{let a={};if(a=e.data.detail,a.color=e.data.detail.color.value,a.coupon_type=e.data.detail.coupon_type.value,l.form=b(l.form,a),20==l.form.apply_range){l.exclude_ids=e.data.detail.product_ids;for(let e=0;e<l.exclude_ids.length;e++)l.exclude_ids[e]=parseInt(l.exclude_ids[e]);l.product_list=e.data.detail.product_list}30==l.form.apply_range&&(l.category_list=e.data.detail.category_list),l.loading=!1})).catch((e=>{l.loading=!1}))},onSubmit(){let l=this,a=l.form;a.product_ids=l.exclude_ids,a.category_list=l.category_list,l.$refs.form.validate((o=>{o?(l.loading=!0,y.editCoupon(a,!0).then((a=>{l.loading=!1,e({message:"恭喜你，修改成功",type:"success"}),l.$router.push("/plus/coupon/index")})).catch((e=>{l.loading=!1}))):l.loading=!1}))},closeCategoryFunc(e){let l=this;l.is_category=!1,e&&(l.category_list=e)},closeProductFunc(e){let l=this;l.is_product=e.openDialog,"success"==e.type&&e.params.forEach(((e,a)=>{let o={product_id:e.product_id,product_name:e.product_name,product_image:e.product_image};l.exclude_ids.push(o.product_id),l.product_list.push(o)}))},cancelFunc(){this.$router.push({path:"/plus/coupon/index"})},deleteClick(e){this.exclude_ids.splice(e,1),this.product_list.splice(e,1)}}},N=e=>(F("data-v-b5149206"),e=e(),P(),e),Y=N((()=>q("div",{class:"common-form"},"修改優惠券",-1))),E=N((()=>q("div",{class:"tips"},"例如：滿100減10",-1))),S={key:0},J={key:1},M=N((()=>q("div",{class:"tips"},"折扣率範圍0-10，9.5代表9.5折，0代表不折扣",-1))),O=N((()=>q("div",{class:"tips"},"最大抵扣金額不能超出此金額，0代表不限制",-1))),T={key:2},W={key:3},A=N((()=>q("div",{class:"tips"},"限制領取的優惠券數量，-1為不限制",-1))),K=N((()=>q("div",{class:"tips"},"促銷是指滿減，等級優惠券值商品的會員等級折扣",-1))),Q=N((()=>q("div",{class:"common-form"},"適用商品",-1))),X=N((()=>q("span",null,"指定商品",-1))),B=N((()=>q("span",null,"指定分類",-1))),G={alt:"",width:50},H={class:"common-button-wrapper"};const L=g($,[["render",function(e,y,g,b,F,P){const $=l,N=a,L=o,R=t,Z=d,ee=r,le=i,ae=s,oe=u,te=p,de=m,re=c,ie=f,se=_,ue=h("img-url"),pe=n;return V((v(),j("div",null,[x(re,{size:"small",ref:"form",model:F.form,"label-width":"200px"},{default:k((()=>[x(N,{modelValue:F.activeName,"onUpdate:modelValue":y[0]||(y[0]=e=>F.activeName=e),type:"card"},{default:k((()=>[x($,{label:"基本資訊",name:"1"}),x($,{label:"適用商品",name:"2"})])),_:1},8,["modelValue"]),"1"==F.activeName?(v(),j(C,{key:0},[Y,x(R,{label:"優惠券名稱",prop:"name",rules:[{required:!0,message:" "}]},{default:k((()=>[x(L,{modelValue:F.form.name,"onUpdate:modelValue":y[1]||(y[1]=e=>F.form.name=e),placeholder:"請輸入優惠券名稱"},null,8,["modelValue"]),E])),_:1}),x(R,{label:"優惠券顏色"},{default:k((()=>[x(ee,{modelValue:F.form.color,"onUpdate:modelValue":y[2]||(y[2]=e=>F.form.color=e)},{default:k((()=>[x(Z,{label:10},{default:k((()=>[U("藍色")])),_:1}),x(Z,{label:20},{default:k((()=>[U("紅色")])),_:1}),x(Z,{label:30},{default:k((()=>[U("紫色")])),_:1}),x(Z,{label:40},{default:k((()=>[U("黃色")])),_:1})])),_:1},8,["modelValue"])])),_:1}),x(R,{label:"優惠券型別"},{default:k((()=>[x(ee,{modelValue:F.form.coupon_type,"onUpdate:modelValue":y[3]||(y[3]=e=>F.form.coupon_type=e)},{default:k((()=>[x(Z,{label:10},{default:k((()=>[U("滿減券")])),_:1}),x(Z,{label:20},{default:k((()=>[U("折扣券")])),_:1})])),_:1},8,["modelValue"])])),_:1}),10==F.form.coupon_type?(v(),j("div",S,[x(R,{label:"減免金額",prop:"reduce_price",rules:[{required:!0,message:" "}]},{default:k((()=>[x(L,{modelValue:F.form.reduce_price,"onUpdate:modelValue":y[4]||(y[4]=e=>F.form.reduce_price=e),placeholder:"請輸入減免金額",type:"number"},null,8,["modelValue"])])),_:1})])):(v(),j("div",J,[x(R,{label:"折扣率 ",prop:"discount",rules:[{required:!0,message:" "}]},{default:k((()=>[x(L,{modelValue:F.form.discount,"onUpdate:modelValue":y[5]||(y[5]=e=>F.form.discount=e),placeholder:"請輸入折扣率",type:"number"},null,8,["modelValue"]),M])),_:1}),x(R,{label:"最多優惠金額",prop:"max_price",rules:[{required:!0,message:" "}]},{default:k((()=>[x(L,{modelValue:F.form.max_price,"onUpdate:modelValue":y[6]||(y[6]=e=>F.form.max_price=e),placeholder:"請輸入最多優惠金額",type:"number"},null,8,["modelValue"]),O])),_:1})])),x(R,{label:"最低消費金額",prop:"min_price",rules:[{required:!0,message:" "}]},{default:k((()=>[x(L,{modelValue:F.form.min_price,"onUpdate:modelValue":y[7]||(y[7]=e=>F.form.min_price=e),placeholder:"請輸入最低消費金額",type:"number"},null,8,["modelValue"])])),_:1}),x(R,{label:"到期型別"},{default:k((()=>[x(ee,{modelValue:F.form.expire_type,"onUpdate:modelValue":y[8]||(y[8]=e=>F.form.expire_type=e)},{default:k((()=>[x(Z,{label:10},{default:k((()=>[U("領取後生效")])),_:1}),x(Z,{label:20},{default:k((()=>[U("固定時間")])),_:1})])),_:1},8,["modelValue"])])),_:1}),10==F.form.expire_type?(v(),j("div",T,[x(R,{label:"有效天數"},{default:k((()=>[x(L,{modelValue:F.form.expire_day,"onUpdate:modelValue":y[9]||(y[9]=e=>F.form.expire_day=e),placeholder:"請輸入有效天數",type:"number"},null,8,["modelValue"])])),_:1})])):(v(),j("div",W,[x(R,{label:"有效時間"},{default:k((()=>[x(le,{modelValue:F.form.active_time,"onUpdate:modelValue":y[10]||(y[10]=e=>F.form.active_time=e),type:"daterange",align:"right","unlink-panels":"","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"開始日期","end-placeholder":"結束日期","picker-options":F.pickerOptions0},null,8,["modelValue","picker-options"])])),_:1})])),x(R,{label:"發放總數量 ",prop:"total_num",rules:[{required:!0,message:" "}]},{default:k((()=>[x(L,{modelValue:F.form.total_num,"onUpdate:modelValue":y[11]||(y[11]=e=>F.form.total_num=e),placeholder:"請輸入發放總數量",type:"number"},null,8,["modelValue"]),A])),_:1}),x(R,{label:"是否顯示在領券中心"},{default:k((()=>[x(ee,{modelValue:F.form.show_center,"onUpdate:modelValue":y[12]||(y[12]=e=>F.form.show_center=e)},{default:k((()=>[x(Z,{label:1},{default:k((()=>[U("顯示")])),_:1}),x(Z,{label:0},{default:k((()=>[U("不顯示")])),_:1})])),_:1},8,["modelValue"])])),_:1}),x(R,{label:"使用條件"},{default:k((()=>[x(ee,{modelValue:F.form.free_limit,"onUpdate:modelValue":y[13]||(y[13]=e=>F.form.free_limit=e)},{default:k((()=>[x(Z,{label:0},{default:k((()=>[U("不限制")])),_:1}),x(Z,{label:1},{default:k((()=>[U("不可與促銷同時使用")])),_:1}),x(Z,{label:2},{default:k((()=>[U("不可與等級優惠同時使用")])),_:1}),x(Z,{label:3},{default:k((()=>[U("不可於促銷和等級優惠同時使用")])),_:1})])),_:1},8,["modelValue"]),K])),_:1}),x(R,{label:"排序"},{default:k((()=>[x(L,{type:"number",modelValue:F.form.sort,"onUpdate:modelValue":y[14]||(y[14]=e=>F.form.sort=e),placeholder:"請輸入排序"},null,8,["modelValue"])])),_:1})],64)):w("",!0),"2"==F.activeName?(v(),j(C,{key:1},[Q,x(R,{label:"選擇"},{default:k((()=>[x(ee,{modelValue:F.form.apply_range,"onUpdate:modelValue":y[15]||(y[15]=e=>F.form.apply_range=e)},{default:k((()=>[x(Z,{label:10},{default:k((()=>[U("全部商品")])),_:1}),x(Z,{label:20},{default:k((()=>[X])),_:1}),x(Z,{label:30},{default:k((()=>[B])),_:1})])),_:1},8,["modelValue"])])),_:1}),20==F.form.apply_range?(v(),D(R,{key:0},{default:k((()=>[x(ae,{class:"mb10",onClick:y[16]||(y[16]=e=>F.is_product=!0),type:"primary",plain:""},{default:k((()=>[U("新增商品 ")])),_:1}),F.product_list.length>0?(v(),D(te,{key:0,data:F.product_list,"max-height":"400",border:"",style:{width:"100%"}},{default:k((()=>[x(oe,{prop:"product_id",label:"ID",width:"180"}),x(oe,{prop:"product_name",label:"商品名稱",width:"180"}),x(oe,{prop:"image",label:"圖片"},{default:k((e=>[V(q("img",G,null,512),[[ue,P.hasImages(e.row.product_image)]])])),_:1}),x(oe,{label:"操作"},{default:k((e=>[x(ae,{onClick:l=>P.deleteClick(e.$index),type:"text",size:"small"},{default:k((()=>[U("刪除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):w("",!0)])),_:1})):w("",!0),30==F.form.apply_range?(v(),D(R,{key:1,label:""},{default:k((()=>[x(ae,{class:"mb10",onClick:y[17]||(y[17]=e=>F.is_category=!0),type:"primary",plain:""},{default:k((()=>[U("新增分類 ")])),_:1}),q("div",null,[F.category_list.first.length>0?(v(!0),j(C,{key:0},z(F.category_list.first,((e,l)=>(v(),j("div",{key:e.category_id,class:"mr10 mb10",style:{display:"inline-block"}},[x(de,{size:"large",type:"info"},{default:k((()=>[U(I(e.parent?e.parent+"→"+e.name:e.name),1)])),_:2},1024)])))),128)):w("",!0),F.category_list.second.length>0?(v(!0),j(C,{key:1},z(F.category_list.second,((e,l)=>(v(),j("div",{key:e.category_id,class:"mr10 mb10",style:{display:"inline-block"}},[x(de,{size:"large",class:"mr10 mb10",type:"info"},{default:k((()=>[U(I(e.parent?e.parent+"→"+e.name:e.name),1)])),_:2},1024)])))),128)):w("",!0)])])),_:1})):w("",!0)],64)):w("",!0),q("div",H,[x(ae,{type:"info",size:"small",onClick:P.cancelFunc,loading:F.loading},{default:k((()=>[U("取消")])),_:1},8,["onClick","loading"]),x(ae,{type:"primary",size:"small",onClick:P.onSubmit,loading:F.loading},{default:k((()=>[U("提交")])),_:1},8,["onClick","loading"])])])),_:1},8,["model"]),x(ie,{isproduct:F.is_product,excludeIds:F.exclude_ids,islist:!0,onCloseDialog:P.closeProductFunc},null,8,["isproduct","excludeIds","onCloseDialog"]),x(se,{is_category:F.is_category,category_list:F.category_list,onClose:P.closeCategoryFunc},null,8,["is_category","category_list","onClose"])])),[[pe,F.loading]])}],["__scopeId","data-v-b5149206"]]);export{L as default};
